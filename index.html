<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïö¥Îèô Î∞© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Pretendard', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        'pastel': {
                            'pink': '#FFE1E6',
                            'purple': '#E8D5FF', 
                            'blue': '#D1E7FF',
                            'green': '#D4F1D4',
                            'yellow': '#FFF2CC',
                            'orange': '#FFE4CC',
                            'coral': '#FFD6CC',
                            'mint': '#CCFFF2',
                            'lavender': '#F0E6FF',
                            'peach': '#FFEBCC'
                        },
                        'soft': {
                            'pink': '#FF9FB2',
                            'purple': '#C49AFF',
                            'blue': '#9AC8FF',
                            'green': '#9AE69A',
                            'yellow': '#FFE066',
                            'orange': '#FFB366',
                            'coral': '#FF9A66',
                            'mint': '#66FFE0',
                            'lavender': '#D9B3FF',
                            'peach': '#FFD199'
                        },
                        'primary': {
                            50: '#F0E6FF',
                            100: '#E8D5FF',
                            200: '#D1ABFF',
                            300: '#BA81FF',
                            400: '#A357FF',
                            500: '#8B2DFF',
                            600: '#7024CC',
                            700: '#541B99',
                            800: '#381266',
                            900: '#1C0933'
                        }
                    },
                    borderRadius: {
                        'xl': '1rem',
                        '2xl': '1.5rem',
                        '3xl': '2rem',
                    },
                    boxShadow: {
                        'soft': '0 4px 20px rgba(139, 45, 255, 0.1)',
                        'soft-lg': '0 8px 30px rgba(139, 45, 255, 0.15)',
                        'pastel': '0 4px 15px rgba(255, 159, 178, 0.2)',
                    }
                }
            }
        }
    </script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <style>
        body {
            font-family: 'Pretendard', system-ui, sans-serif;
            background: linear-gradient(135deg, #F0E6FF 0%, #E8D5FF 50%, #D1E7FF 100%);
            min-height: 100vh;
        }
        
        .shadow-card {
            box-shadow: 0 8px 25px rgba(139, 45, 255, 0.08);
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .shadow-card-hover {
            box-shadow: 0 12px 35px rgba(139, 45, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .modal {
            display: none;
            backdrop-filter: blur(8px);
        }
        .modal.active {
            display: flex;
        }
        
        .status-tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 500;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .status-active { 
            background: linear-gradient(135deg, #9AE69A, #66FFE0);
            color: #1a5a1a;
        }
        .status-weekly-warning { 
            background: linear-gradient(135deg, #FFE066, #FFD199);
            color: #8B4513;
        }
        .status-monthly-warning { 
            background: linear-gradient(135deg, #FFB366, #FF9A66);
            color: #8B2500;
        }
        .status-removal { 
            background: linear-gradient(135deg, #FF9FB2, #FFD6CC);
            color: #8B0000;
        }
        .status-inactive { 
            background: linear-gradient(135deg, #E5E7EB, #D1D5DB);
            color: #4B5563;
        }
        
        .calendar-day {
            min-height: 85px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(5px);
        }
        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(139, 45, 255, 0.1);
        }
        .calendar-day.has-activity {
            background: linear-gradient(135deg, #D1E7FF, #CCFFF2);
            border: 2px solid rgba(139, 45, 255, 0.2);
        }
        .calendar-day.has-activity:hover {
            background: linear-gradient(135deg, #9AC8FF, #66FFE0);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 45, 255, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #8B2DFF, #A357FF);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 45, 255, 0.3);
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #7024CC, #8B2DFF);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(139, 45, 255, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #FF9FB2, #FFD6CC);
            color: #8B0000;
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background: linear-gradient(135deg, #FF8FA5, #FFC2B8);
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #9AE69A, #66FFE0);
            color: #1a5a1a;
            transition: all 0.3s ease;
        }
        .btn-success:hover {
            background: linear-gradient(135deg, #7DD87D, #4DFFD4);
            transform: translateY(-1px);
        }
        
        .input-field {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(139, 45, 255, 0.1);
            transition: all 0.3s ease;
        }
        .input-field:focus {
            background: rgba(255, 255, 255, 0.95);
            border-color: rgba(139, 45, 255, 0.3);
            box-shadow: 0 0 0 3px rgba(139, 45, 255, 0.1);
        }
        
        .card-gradient {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            backdrop-filter: blur(15px);
        }
        
        .stats-card {
            transition: all 0.3s ease;
        }
        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        /* Î™®Î∞îÏùº ÌÉ≠ Ïä§ÌÉÄÏùº */
        .tab-active {
            background: linear-gradient(135deg, #8B5DFF 0%, #FF6B9D 100%);
            color: white;
            box-shadow: 0 2px 10px rgba(139, 93, 255, 0.3);
        }

        /* Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
        @media (max-width: 1024px) {
            .mobile-hidden {
                display: none !important;
            }
            
            .mobile-full {
                display: block !important;
            }
            
            /* Î™®Îã¨ Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .modal .card-gradient {
                margin: 0.5rem;
                max-height: 90vh;
                overflow-y: auto;
            }
            
            /* Î≤ÑÌäº ÌÑ∞Ïπò ÏµúÏ†ÅÌôî */
            button, .cursor-pointer {
                min-height: 44px;
            }
            
            /* ÏûÖÎ†• ÌïÑÎìú ÌÑ∞Ïπò ÏµúÏ†ÅÌôî */
            input, select, textarea {
                min-height: 44px;
                font-size: 16px; /* iOS Ï§å Î∞©ÏßÄ */
            }
            
            /* Ìå®Îî© Ï°∞Ï†ï */
            .card-gradient {
                padding: 1rem;
            }
            
            /* Í∑∏Î¶¨Îìú Í∞ÑÍ≤© Ï°∞Ï†ï */
            .space-y-6 > * + * {
                margin-top: 1rem;
            }
        }

        /* ÌÑ∞Ïπò ÎîîÎ∞îÏù¥Ïä§ ÏµúÏ†ÅÌôî */
        @media (hover: none) and (pointer: coarse) {
            .hover\\:scale-\\[1\\.02\\]:hover {
                transform: none;
            }
            
            .hover\\:shadow-soft:hover {
                box-shadow: 0 4px 20px rgba(139, 45, 255, 0.1);
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Î°úÎî© Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ -->
    <div id="loadingScreen" class="fixed inset-0 bg-gradient-to-br from-primary-50 to-primary-100 flex items-center justify-center z-50 hidden">
        <div class="text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-soft-purple to-soft-pink rounded-2xl mx-auto mb-4 flex items-center justify-center animate-pulse">
                <span class="text-2xl">üí™</span>
            </div>
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"></div>
            <p class="text-primary-700 font-medium">Î°úÎî© Ï§ë...</p>
            <p id="loadingStatus" class="text-primary-500 text-sm mt-2">Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Í≥† ÏûàÏäµÎãàÎã§</p>
        </div>
    </div>

    <!-- Î°úÍ∑∏Ïù∏ ÌôîÎ©¥ -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center">
        <div class="card-gradient p-10 rounded-3xl shadow-soft-lg w-full max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-br from-soft-purple to-soft-pink rounded-2xl mx-auto mb-4 flex items-center justify-center">
                    <span class="text-3xl">üí™</span>
                </div>
                <h1 class="text-2xl font-bold text-primary-800 mb-2">Ïö¥Îèô Î∞© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</h1>
                <p class="text-primary-600 text-sm font-medium">Í±¥Í∞ïÌïú Ïö¥Îèô ÏäµÍ¥ÄÏùÑ Ìï®Íªò ÎßåÎì§Ïñ¥Í∞ÄÏöî</p>
            </div>
            <form id="loginForm" class="space-y-5">
                <div>
                    <label class="block text-sm font-semibold text-primary-700 mb-2">ÏïÑÏù¥Îîî</label>
                    <input type="text" id="loginId" class="input-field w-full px-4 py-3 rounded-xl focus:outline-none" placeholder="ÏïÑÏù¥ÎîîÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-primary-700 mb-2">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                    <input type="password" id="loginPassword" class="input-field w-full px-4 py-3 rounded-xl focus:outline-none" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required>
                </div>
                <button type="submit" class="btn-primary w-full text-white py-3 px-4 rounded-xl font-semibold">
                    Î°úÍ∑∏Ïù∏
                </button>
            </form>
            <div id="loginError" class="mt-4 text-red-500 text-sm text-center hidden bg-red-50 p-3 rounded-xl"></div>
            
        </div>
    </div>

    <!-- Î©îÏù∏ ÎåÄÏãúÎ≥¥Îìú -->
    <div id="mainDashboard" class="hidden min-h-screen">
        <!-- Ìó§Îçî -->
        <header class="card-gradient shadow-soft border-b border-white/20 backdrop-blur-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-3 lg:py-5">
                    <div class="flex items-center space-x-2 lg:space-x-3">
                        <div class="w-8 h-8 lg:w-10 lg:h-10 bg-gradient-to-br from-soft-purple to-soft-pink rounded-xl flex items-center justify-center">
                            <span class="text-base lg:text-lg">üí™</span>
                        </div>
                        <div>
                            <h1 class="text-lg lg:text-xl font-bold text-primary-800">Ïö¥Îèô Î∞© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</h1>
                            <p class="text-primary-600 text-xs hidden sm:block">Í±¥Í∞ïÌïú Ïö¥Îèô ÏäµÍ¥ÄÏùÑ Ìï®Íªò ÎßåÎì§Ïñ¥Í∞ÄÏöî</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-1 lg:space-x-3">
                        <div class="bg-pastel-lavender px-2 lg:px-3 py-1 lg:py-2 rounded-lg lg:rounded-xl">
                            <span id="userInfo" class="text-xs lg:text-sm font-semibold text-primary-700"></span>
                        </div>
                        
                        <!-- Îç∞Ïä§ÌÅ¨ÌÜ± Î≤ÑÌäºÎì§ -->
                        <div class="hidden lg:flex items-center space-x-3">
                            <button id="forceInitBtn" class="btn-secondary px-3 py-2 rounded-xl text-sm font-medium hidden">
                                üîÑ Firebase Ï¥àÍ∏∞Ìôî
                            </button>
                            <button id="changePasswordBtn" class="bg-gradient-to-r from-pastel-coral to-pastel-pink text-primary-800 px-4 py-2 rounded-xl font-medium hover:shadow-soft transition-all">
                                üîê ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω
                            </button>
                            <button id="exportBtn" class="bg-gradient-to-r from-pastel-green to-pastel-mint text-primary-800 px-4 py-2 rounded-xl font-medium hover:shadow-soft transition-all hidden">
                                üìÅ Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                            </button>
                            <button id="reportBtn" class="btn-primary text-white px-4 py-2 rounded-xl font-medium">
                                üìä Î¶¨Ìè¨Ìä∏ Î≥¥Í∏∞
                            </button>
                            <button id="logoutBtn" class="bg-gradient-to-r from-gray-400 to-gray-500 text-white px-4 py-2 rounded-xl hover:from-gray-500 hover:to-gray-600 transition-all font-medium">
                                Î°úÍ∑∏ÏïÑÏõÉ
                            </button>
                        </div>
                        
                        <!-- Î™®Î∞îÏùº Î©îÎâ¥ Î≤ÑÌäº -->
                        <div class="lg:hidden">
                            <button id="mobileMenuBtn" class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center text-primary-800">
                                <span class="text-lg">‚ãØ</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Î™®Î∞îÏùº Î©îÎâ¥ -->
                <div id="mobileMenu" class="lg:hidden hidden pb-3">
                    <div class="flex flex-wrap gap-2">
                        <button id="changePasswordBtnMobile" class="flex-1 bg-gradient-to-r from-pastel-coral to-pastel-pink text-primary-800 px-3 py-2 rounded-lg text-xs font-medium">
                            üîê ÎπÑÎ∞ÄÎ≤àÌò∏
                        </button>
                        <button id="exportBtnMobile" class="flex-1 bg-gradient-to-r from-pastel-green to-pastel-mint text-primary-800 px-3 py-2 rounded-lg text-xs font-medium hidden">
                            üìÅ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                        </button>
                        <button id="reportBtnMobile" class="flex-1 btn-primary text-white px-3 py-2 rounded-lg text-xs font-medium">
                            üìä Î¶¨Ìè¨Ìä∏
                        </button>
                        <button id="logoutBtnMobile" class="flex-1 bg-gradient-to-r from-gray-400 to-gray-500 text-white px-3 py-2 rounded-lg text-xs font-medium">
                            Î°úÍ∑∏ÏïÑÏõÉ
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-2 sm:px-4 lg:px-8 py-3 sm:py-6">
            <!-- Î™®Î∞îÏùº ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
            <div class="lg:hidden mb-4">
                <div class="flex bg-white/20 backdrop-blur-sm rounded-xl p-1">
                    <button id="tabMain" class="flex-1 py-2 px-3 text-sm font-medium rounded-lg transition-all tab-active">
                        üìä Î©îÏù∏
                    </button>
                    <button id="tabMembers" class="flex-1 py-2 px-3 text-sm font-medium rounded-lg transition-all">
                        üë• Î©§Î≤Ñ
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-3 lg:gap-6">
                <!-- ÏôºÏ™Ω Ïª¨Îüº (Î©îÏù∏ ÏòÅÏó≠) -->
                <div id="mainContent" class="lg:col-span-3 space-y-3 lg:space-y-6">
                    <!-- Í≥µÏßÄÏÇ¨Ìï≠ -->
                    <div class="card-gradient rounded-2xl shadow-soft p-6">
                        <div class="flex justify-between items-center mb-5">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-gradient-to-br from-soft-yellow to-soft-orange rounded-lg flex items-center justify-center">
                                    <span class="text-sm">üì¢</span>
                                </div>
                                <h2 class="text-lg font-bold text-primary-800">Í≥µÏßÄÏÇ¨Ìï≠</h2>
                            </div>
                            <button id="editNoticeBtn" class="btn-primary text-white px-4 py-2 rounded-xl text-sm font-medium hidden">
                                ‚úèÔ∏è Í≥µÏßÄÏàòÏ†ï
                            </button>
                        </div>
                        <div id="noticeContent" class="text-primary-700">
                            <div class="bg-gradient-to-r from-pastel-blue to-pastel-mint border-l-4 border-soft-blue p-5 rounded-xl">
                                <div class="flex items-start space-x-3">
                                    <span class="text-lg">üí°</span>
                                    <div>
                                        <p class="text-sm font-medium text-primary-800">
                                            <span class="bg-soft-blue text-white px-2 py-1 rounded-lg text-xs font-bold">[ÌïÑÎèÖ]</span> 
                                            <span class="ml-2">Ïö¥Îèô Î∞© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖúÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§!</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÏõîÎ≥Ñ Îã¨Î†• -->
                    <div class="card-gradient rounded-2xl shadow-soft p-6">
                        <div class="flex justify-between items-center mb-5">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-gradient-to-br from-soft-green to-soft-mint rounded-lg flex items-center justify-center">
                                    <span class="text-sm">üìÖ</span>
                                </div>
                                <h2 class="text-lg font-bold text-primary-800">ÌôúÎèô Îã¨Î†•</h2>
                            </div>
                            <div class="flex items-center space-x-3">
                                <button id="prevMonth" class="p-2 hover:bg-pastel-purple rounded-xl transition-all duration-300 hover:scale-105">
                                    <svg class="w-5 h-5 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                    </svg>
                                </button>
                                <div class="bg-pastel-lavender px-4 py-2 rounded-xl">
                                    <span id="currentMonth" class="text-lg font-bold text-primary-800"></span>
                                </div>
                                <button id="nextMonth" class="p-2 hover:bg-pastel-purple rounded-xl transition-all duration-300 hover:scale-105">
                                    <svg class="w-5 h-5 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div id="calendar" class="grid grid-cols-7 gap-2">
                            <!-- Îã¨Î†•Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                        </div>
                    </div>

                    <!-- Ï£ºÍ∞Ñ ÎåÄÏãúÎ≥¥Îìú & ÏõîÍ∞Ñ Î¶¨Ìè¨Ìä∏ -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Ï£ºÍ∞Ñ ÎåÄÏãúÎ≥¥Îìú -->
                        <div class="card-gradient rounded-2xl shadow-soft p-6">
                            <div class="flex justify-between items-center mb-5">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-gradient-to-br from-soft-blue to-soft-mint rounded-lg flex items-center justify-center">
                                        <span class="text-sm">üìä</span>
                                    </div>
                                    <h2 class="text-lg font-bold text-primary-800">Ï£ºÍ∞Ñ ÎåÄÏãúÎ≥¥Îìú</h2>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button id="prevWeek" class="p-2 hover:bg-pastel-blue rounded-lg transition-all duration-300 hover:scale-105">
                                        <svg class="w-4 h-4 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                        </svg>
                                    </button>
                                    <div class="bg-pastel-blue px-3 py-1 rounded-lg">
                                        <span id="currentWeek" class="text-xs font-bold text-primary-800 min-w-[120px] text-center block"></span>
                                    </div>
                                    <button id="nextWeek" class="p-2 hover:bg-pastel-blue rounded-lg transition-all duration-300 hover:scale-105">
                                        <svg class="w-4 h-4 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Ï£ºÍ∞Ñ ÌÜµÍ≥Ñ -->
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="stats-card bg-gradient-to-br from-pastel-blue to-pastel-mint p-4 rounded-xl">
                                        <div class="flex items-center space-x-2 mb-1">
                                            <span class="text-sm">üí™</span>
                                            <div class="text-xs text-primary-700 font-semibold">Ï¥ù Ïö¥Îèô Ï∞∏Ïó¨</div>
                                        </div>
                                        <div id="weeklyWorkoutCount" class="text-xl font-bold text-primary-800">0Ìöå</div>
                                    </div>
                                    <div class="stats-card bg-gradient-to-br from-pastel-green to-pastel-mint p-4 rounded-xl">
                                        <div class="flex items-center space-x-2 mb-1">
                                            <span class="text-sm">üéâ</span>
                                            <div class="text-xs text-primary-700 font-semibold">Ï¥ù Î≤ô Ï∞∏Ïó¨</div>
                                        </div>
                                        <div id="weeklyMeetingCount" class="text-xl font-bold text-primary-800">0Ìöå</div>
                                    </div>
                                </div>
                                
                                <!-- Ï£ºÍ∞Ñ ÎØ∏Îã¨Ïûê -->
                                <div class="bg-pastel-yellow p-4 rounded-xl">
                                    <h4 class="text-sm font-bold text-primary-800 mb-3 flex items-center space-x-2">
                                        <span>‚ö†Ô∏è</span>
                                        <span>Ï£ºÍ∞Ñ Ïö¥Îèô ÎØ∏Îã¨Ïûê (2Ìöå ÎØ∏Îßå)</span>
                                    </h4>
                                    <div id="weeklyUnderperformers" class="space-y-2 max-h-32 overflow-y-auto">
                                        <!-- ÎØ∏Îã¨Ïûê Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ÏõîÍ∞Ñ Î¶¨Ìè¨Ìä∏ -->
                        <div class="card-gradient rounded-2xl shadow-soft p-6">
                            <div class="flex justify-between items-center mb-5">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-gradient-to-br from-soft-purple to-soft-pink rounded-lg flex items-center justify-center">
                                        <span class="text-sm">üìà</span>
                                    </div>
                                    <h2 class="text-lg font-bold text-primary-800">ÏõîÍ∞Ñ Î¶¨Ìè¨Ìä∏</h2>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button id="prevReportMonth" class="p-2 hover:bg-pastel-purple rounded-lg transition-all duration-300 hover:scale-105">
                                        <svg class="w-4 h-4 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                        </svg>
                                    </button>
                                    <div class="bg-pastel-purple px-3 py-1 rounded-lg">
                                        <span id="currentReportMonth" class="text-xs font-bold text-primary-800 min-w-[80px] text-center block"></span>
                                    </div>
                                    <button id="nextReportMonth" class="p-2 hover:bg-pastel-purple rounded-lg transition-all duration-300 hover:scale-105">
                                        <svg class="w-4 h-4 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- ÏõîÍ∞Ñ ÌÜµÍ≥Ñ -->
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="stats-card bg-gradient-to-br from-pastel-purple to-pastel-lavender p-4 rounded-xl">
                                        <div class="flex items-center space-x-2 mb-1">
                                            <span class="text-sm">üèãÔ∏è</span>
                                            <div class="text-xs text-primary-700 font-semibold">ÏõîÍ∞Ñ Ïö¥Îèô</div>
                                        </div>
                                        <div id="monthlyWorkoutCount" class="text-xl font-bold text-primary-800">0Ìöå</div>
                                    </div>
                                    <div class="stats-card bg-gradient-to-br from-pastel-orange to-pastel-peach p-4 rounded-xl">
                                        <div class="flex items-center space-x-2 mb-1">
                                            <span class="text-sm">üçª</span>
                                            <div class="text-xs text-primary-700 font-semibold">ÏõîÍ∞Ñ Î≤ô</div>
                                        </div>
                                        <div id="monthlyMeetingCount" class="text-xl font-bold text-primary-800">0Ìöå</div>
                                    </div>
                                </div>
                                
                                <!-- ÏõîÍ∞Ñ ÎØ∏Îã¨Ïûê -->
                                <div class="bg-pastel-coral p-4 rounded-xl">
                                    <h4 class="text-sm font-bold text-primary-800 mb-3 flex items-center space-x-2">
                                        <span>üö®</span>
                                        <span>ÏõîÍ∞Ñ Î≤ô ÎØ∏Îã¨Ïûê (1Ìöå ÎØ∏Îßå)</span>
                                    </h4>
                                    <div id="monthlyUnderperformers" class="space-y-2 max-h-32 overflow-y-auto">
                                        <!-- ÎØ∏Îã¨Ïûê Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ïò§Î•∏Ï™Ω Ìå®ÎÑê (ÏÇ¨Ïù¥ÎìúÎ∞î) -->
                <div id="memberContent" class="lg:col-span-1 hidden lg:block">
                    <div class="card-gradient rounded-2xl shadow-soft p-6">
                        <div class="flex justify-between items-center mb-5">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-gradient-to-br from-soft-pink to-soft-coral rounded-lg flex items-center justify-center">
                                    <span class="text-sm">üë•</span>
                                </div>
                                <h2 class="text-lg font-bold text-primary-800">Î©§Î≤Ñ Í¥ÄÎ¶¨</h2>
                            </div>
                            <button id="addMemberBtn" class="btn-success text-white px-4 py-2 rounded-xl text-sm font-medium">
                                ‚ûï Ï∂îÍ∞Ä
                            </button>
                        </div>
                        
                        <!-- Í≥†Í∏â ÌïÑÌÑ∞ -->
                        <div class="mb-5 space-y-3">
                            <!-- Í≤ÄÏÉâ -->
                            <div class="relative">
                                <input type="text" id="memberSearch" placeholder="üîç Î©§Î≤Ñ Í≤ÄÏÉâ (Ïù¥Î¶Ñ, ÎãâÎÑ§ÏûÑ)" 
                                       class="input-field w-full px-4 py-3 pl-10 rounded-xl text-sm font-medium focus:outline-none">
                                <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-primary-400">
                                    üîç
                                </div>
                            </div>
                            
                            <!-- ÌïÑÌÑ∞ ÏòµÏÖòÎì§ -->
                            <div class="grid grid-cols-2 gap-2">
                                <select id="statusFilter" class="input-field px-3 py-2 rounded-lg text-xs font-medium focus:outline-none">
                                    <option value="all">üåü Î™®Îì† ÏÉÅÌÉú</option>
                                    <option value="active">üü¢ ÌôúÎèôÏ§ë</option>
                                    <option value="weekly-warning">üü° Ï£ºÍ∞ÑÍ≤ΩÍ≥†</option>
                                    <option value="monthly-warning">üü† ÏõîÍ∞ÑÍ≤ΩÍ≥†</option>
                                    <option value="removal">üî¥ Í∞ïÌá¥ÎåÄÏÉÅ</option>
                                    <option value="inactive">‚ö´ ÎπÑÌôúÏÑ±</option>
                                </select>
                                
                                <select id="roleFilter" class="input-field px-3 py-2 rounded-lg text-xs font-medium focus:outline-none">
                                    <option value="all">üë• Î™®Îì† Ïó≠Ìï†</option>
                                    <option value="super_admin">üëë Î∞©Ïû•</option>
                                    <option value="admin">‚≠ê Î∂ÄÎ∞©Ïû•</option>
                                    <option value="member">üë§ ÏùºÎ∞òÎ©§Î≤Ñ</option>
                                </select>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-2">
                                <select id="sortFilter" class="input-field px-3 py-2 rounded-lg text-xs font-medium focus:outline-none">
                                    <option value="default">üìã Í∏∞Î≥∏Ïàú</option>
                                    <option value="name">üî§ Ïù¥Î¶ÑÏàú</option>
                                    <option value="joinDate">üìÖ Í∞ÄÏûÖÏùºÏàú</option>
                                    <option value="activity">üìä ÌôúÎèôÏàú</option>
                                    <option value="status">‚ö†Ô∏è ÏÉÅÌÉúÏàú</option>
                                </select>
                                
                                <select id="periodFilter" class="input-field px-3 py-2 rounded-lg text-xs font-medium focus:outline-none">
                                    <option value="all">üìÜ Ï†ÑÏ≤¥Í∏∞Í∞Ñ</option>
                                    <option value="thisWeek">üìÖ Ïù¥Î≤àÏ£º</option>
                                    <option value="thisMonth">üìÖ Ïù¥Î≤àÎã¨</option>
                                    <option value="lastWeek">üìÖ ÏßÄÎÇúÏ£º</option>
                                    <option value="lastMonth">üìÖ ÏßÄÎÇúÎã¨</option>
                                </select>
                            </div>
                            
                            <!-- Îπ†Î•∏ ÌïÑÌÑ∞ Î≤ÑÌäºÎì§ -->
                            <div class="flex flex-wrap gap-1">
                                <button id="filterNewMembers" class="bg-pastel-mint text-primary-700 px-2 py-1 rounded-lg text-xs font-medium hover:bg-pastel-green transition-colors">
                                    üå± Ïã†Í∑úÎ©§Î≤Ñ
                                </button>
                                <button id="filterActiveToday" class="bg-pastel-blue text-primary-700 px-2 py-1 rounded-lg text-xs font-medium hover:bg-pastel-purple transition-colors">
                                    üí™ Ïò§ÎäòÌôúÎèô
                                </button>
                                <button id="filterNeedAttention" class="bg-pastel-yellow text-primary-700 px-2 py-1 rounded-lg text-xs font-medium hover:bg-pastel-peach transition-colors">
                                    ‚ö†Ô∏è Ï£ºÏùòÌïÑÏöî
                                </button>
                                <button id="clearFilters" class="bg-pastel-gray text-primary-700 px-2 py-1 rounded-lg text-xs font-medium hover:bg-pastel-pink transition-colors">
                                    üîÑ Ï¥àÍ∏∞Ìôî
                                </button>
                            </div>
                            
                            <!-- ÌïÑÌÑ∞ Í≤∞Í≥º ÌëúÏãú -->
                            <div id="filterResults" class="text-xs text-primary-600 text-center py-2 bg-white/30 rounded-lg">
                                Ï¥ù <span id="totalMembers">0</span>Î™Ö | ÌëúÏãú <span id="filteredMembers">0</span>Î™Ö
                            </div>
                        </div>

                        <!-- Î©§Î≤Ñ Î™©Î°ù -->
                        <div id="memberList" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                            <!-- Î©§Î≤Ñ Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                        </div>

                        <!-- Ï∂úÏÑù Îû≠ÌÇπ (ÏÉàÎ°úÏö¥ Í∏∞Îä•) -->
                        <div class="mt-6 pt-6 border-t border-white/20">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-bold text-primary-800 flex items-center">
                                    <span class="text-base mr-2">üèÜ</span>
                                    Îû≠ÌÇπ ÏãúÏä§ÌÖú
                                </h3>
                                <button id="refreshRanking" class="text-xs bg-pastel-mint text-primary-700 px-2 py-1 rounded-lg hover:bg-pastel-green transition-colors">
                                    üîÑ ÏÉàÎ°úÍ≥†Ïπ®
                                </button>
                            </div>
                            
                            <!-- Îû≠ÌÇπ ÌÉ≠ -->
                            <div class="mb-3">
                                <div class="flex space-x-1 mb-3">
                                    <button id="totalRankingTab" class="ranking-tab-active flex-1 text-xs py-2 px-3 rounded-lg font-medium bg-gradient-to-r from-pastel-blue to-pastel-mint text-primary-800">
                                        üèÜ Ï¢ÖÌï©Îû≠ÌÇπ
                                    </button>
                                    <button id="workoutRankingTab" class="ranking-tab flex-1 text-xs py-2 px-3 rounded-lg font-medium bg-white/30 text-primary-600 hover:bg-white/50">
                                        üí™ Ïö¥ÎèôÎû≠ÌÇπ
                                    </button>
                                    <button id="meetingRankingTab" class="ranking-tab flex-1 text-xs py-2 px-3 rounded-lg font-medium bg-white/30 text-primary-600 hover:bg-white/50">
                                        üçª Î≤ôÎû≠ÌÇπ
                                    </button>
                                </div>
                                
                                <!-- Îû≠ÌÇπ Í∏∞Í∞Ñ ÏÑ†ÌÉù -->
                                <select id="rankingPeriod" class="input-field w-full px-3 py-2 rounded-lg text-xs font-medium focus:outline-none">
                                    <option value="week">üìÖ Ïù¥Î≤àÏ£º</option>
                                    <option value="month">üìÖ Ïù¥Î≤àÎã¨</option>
                                    <option value="all">üìÖ Ï†ÑÏ≤¥Í∏∞Í∞Ñ</option>
                                </select>
                            </div>
                            
                            <!-- Îû≠ÌÇπ Î™©Î°ù -->
                            <div id="attendanceRanking" class="space-y-2 max-h-48 overflow-y-auto">
                                <!-- Îû≠ÌÇπÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Í≥µÏßÄÏÇ¨Ìï≠ ÏàòÏ†ï Î™®Îã¨ -->
    <div id="noticeModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="card-gradient rounded-2xl shadow-soft-lg p-8 w-full max-w-md mx-4">
            <div class="text-center mb-6">
                <div class="w-12 h-12 bg-gradient-to-br from-soft-yellow to-soft-orange rounded-xl mx-auto mb-3 flex items-center justify-center">
                    <span class="text-xl">üì¢</span>
                </div>
                <h3 class="text-xl font-bold text-primary-800">Í≥µÏßÄÏÇ¨Ìï≠ ÏàòÏ†ï</h3>
            </div>
            <form id="noticeForm" class="space-y-5">
                <div>
                    <label class="block text-sm font-semibold text-primary-700 mb-2">Ïπ¥ÌÖåÍ≥†Î¶¨</label>
                    <select id="noticeCategory" class="input-field w-full px-4 py-3 rounded-xl focus:outline-none">
                        <option value="ÌïÑÎèÖ">üìå [ÌïÑÎèÖ]</option>
                        <option value="Ï†ïÎ≥¥">üí° [Ï†ïÎ≥¥]</option>
                        <option value="Í≥µÏßÄ">üì£ [Í≥µÏßÄ]</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-primary-700 mb-2">ÎÇ¥Ïö©</label>
                    <textarea id="noticeText" rows="4" class="input-field w-full px-4 py-3 rounded-xl focus:outline-none resize-none" placeholder="2-3Ï§ÑÏùò Í≥µÏßÄÏÇ¨Ìï≠ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></textarea>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="cancelNotice" class="px-6 py-3 text-primary-600 hover:text-primary-800 font-medium transition-colors rounded-xl hover:bg-pastel-purple">
                        Ï∑®ÏÜå
                    </button>
                    <button type="submit" class="btn-primary text-white px-6 py-3 rounded-xl font-medium">
                        üíæ Ï†ÄÏû•
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Î©§Î≤Ñ Ï∂îÍ∞Ä/ÏàòÏ†ï Î™®Îã¨ -->
    <div id="memberModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="card-gradient rounded-2xl shadow-soft-lg p-8 w-full max-w-md mx-4">
            <div class="text-center mb-6">
                <div class="w-12 h-12 bg-gradient-to-br from-soft-pink to-soft-coral rounded-xl mx-auto mb-3 flex items-center justify-center">
                    <span class="text-xl">üë§</span>
                </div>
                <h3 id="memberModalTitle" class="text-xl font-bold text-primary-800">Î©§Î≤Ñ Ï∂îÍ∞Ä</h3>
            </div>
            <form id="memberForm" class="space-y-5">
                <div>
                    <label class="block text-sm font-semibold text-primary-700 mb-2">ÎãâÎÑ§ÏûÑ</label>
                    <input type="text" id="memberNickname" class="input-field w-full px-4 py-3 rounded-xl focus:outline-none" placeholder="ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-primary-700 mb-2">ÏÑ±Î™Ö</label>
                    <input type="text" id="memberName" class="input-field w-full px-4 py-3 rounded-xl focus:outline-none" placeholder="Ïã§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-primary-700 mb-2">Ïó∞ÎùΩÏ≤ò</label>
                    <input type="tel" id="memberPhone" class="input-field w-full px-4 py-3 rounded-xl focus:outline-none" placeholder="010-0000-0000" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-primary-700 mb-2">Ïó≠Ìï†</label>
                    <select id="memberRole" class="input-field w-full px-4 py-3 rounded-xl focus:outline-none">
                        <option value="member">üë§ ÏùºÎ∞ò Î©§Î≤Ñ</option>
                        <option value="admin">‚≠ê Î∂ÄÎ∞©Ïû•</option>
                        <option value="super_admin">üëë Î∞©Ïû•</option>
                    </select>
                </div>
                <div class="bg-pastel-yellow p-4 rounded-xl">
                    <label class="flex items-center">
                        <input type="checkbox" id="memberInactive" class="mr-3 w-4 h-4 text-primary-600 rounded">
                        <span class="text-sm font-medium text-primary-800">üö´ ÌôúÎèô Ï§ëÏßÄ</span>
                    </label>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="cancelMember" class="px-6 py-3 text-primary-600 hover:text-primary-800 font-medium transition-colors rounded-xl hover:bg-pastel-purple">
                        Ï∑®ÏÜå
                    </button>
                    <button type="button" id="deleteMember" class="btn-secondary px-6 py-3 rounded-xl font-medium hidden">
                        üóëÔ∏è ÏÇ≠Ï†ú
                    </button>
                    <button type="submit" class="btn-primary text-white px-6 py-3 rounded-xl font-medium">
                        üíæ Ï†ÄÏû•
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ÏùºÏùº ÌôúÎèô Í∏∞Î°ù Î™®Îã¨ -->
    <div id="activityModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="card-gradient rounded-2xl shadow-soft-lg p-8 w-full max-w-2xl mx-4 max-h-[80vh] overflow-y-auto">
            <div class="text-center mb-6">
                <div class="w-12 h-12 bg-gradient-to-br from-soft-green to-soft-mint rounded-xl mx-auto mb-3 flex items-center justify-center">
                    <span class="text-xl">üìù</span>
                </div>
                <h3 id="activityModalTitle" class="text-xl font-bold text-primary-800">ÏùºÏùº ÌôúÎèô Í∏∞Î°ù</h3>
            </div>
            <form id="activityForm">
                <!-- Í≥†Í∏â Ï∂úÏÑù Ï≤¥ÌÅ¨ Í∏∞Îä• -->
                <div class="space-y-4 mb-6">
                    <!-- ÎÇ†Ïßú Î∞è ÏãúÍ∞Ñ ÏÑ§Ï†ï -->
                    <div class="bg-gradient-to-r from-pastel-mint to-pastel-blue p-4 rounded-xl">
                        <h4 class="text-sm font-bold text-primary-800 mb-3">üìÖ ÎÇ†Ïßú & ÏãúÍ∞Ñ ÏÑ§Ï†ï</h4>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-primary-700 mb-1">ÎÇ†Ïßú</label>
                                <input type="date" id="activityDate" class="w-full text-xs px-2 py-1 rounded-lg border border-white/30 bg-white/50">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-primary-700 mb-1">ÏãúÍ∞ÑÎåÄ</label>
                                <select id="timeSlot" class="w-full text-xs px-2 py-1 rounded-lg border border-white/30 bg-white/50">
                                    <option value="all">üåÖ Ï†ÑÏ≤¥</option>
                                    <option value="morning">üåÑ Ïò§Ï†Ñ (6-12Ïãú)</option>
                                    <option value="afternoon">‚òÄÔ∏è Ïò§ÌõÑ (12-18Ïãú)</option>
                                    <option value="evening">üåÜ Ï†ÄÎÖÅ (18-24Ïãú)</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-2 flex gap-2">
                            <button type="button" id="copyToWeek" class="flex-1 bg-white/60 text-primary-800 text-xs py-1 px-2 rounded-lg font-medium hover:bg-white/80 transition-all">
                                üìÖ Ïù¥Î≤àÏ£º Ï†ÑÏ≤¥ Î≥µÏÇ¨
                            </button>
                            <button type="button" id="scheduleReminder" class="flex-1 bg-white/60 text-primary-800 text-xs py-1 px-2 rounded-lg font-medium hover:bg-white/80 transition-all">
                                üîî ÏïåÎ¶º ÏòàÏïΩ
                            </button>
                        </div>
                    </div>

                    <!-- Îπ†Î•∏ Ïï°ÏÖò Î≤ÑÌäºÎì§ -->
                    <div class="bg-gradient-to-r from-pastel-blue to-pastel-purple p-4 rounded-xl">
                        <h4 class="text-sm font-bold text-primary-800 mb-3">‚ö° Îπ†Î•∏ Ï≤¥ÌÅ¨</h4>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="space-y-2">
                                <button type="button" id="selectAllWorkout" class="w-full btn-secondary text-xs py-2 px-3 rounded-lg">
                                    üí™ Ïö¥Îèô Ï†ÑÏ≤¥ÏÑ†ÌÉù
                                </button>
                                <button type="button" id="clearAllWorkout" class="w-full bg-pastel-gray text-primary-700 text-xs py-2 px-3 rounded-lg hover:bg-pastel-pink transition-colors">
                                    ‚ùå Ïö¥Îèô Ï†ÑÏ≤¥Ìï¥Ï†ú
                                </button>
                            </div>
                            <div class="space-y-2">
                                <button type="button" id="selectAllMeeting" class="w-full btn-success text-xs py-2 px-3 rounded-lg">
                                    üçª Î≤ô Ï†ÑÏ≤¥ÏÑ†ÌÉù
                                </button>
                                <button type="button" id="clearAllMeeting" class="w-full bg-pastel-gray text-primary-700 text-xs py-2 px-3 rounded-lg hover:bg-pastel-pink transition-colors">
                                    ‚ùå Î≤ô Ï†ÑÏ≤¥Ìï¥Ï†ú
                                </button>
                            </div>
                        </div>
                        <div class="mt-3 pt-3 border-t border-white/20 space-y-2">
                            <button type="button" id="autoSelectLastWeek" class="w-full bg-gradient-to-r from-pastel-yellow to-pastel-peach text-primary-800 text-xs py-2 px-3 rounded-lg font-medium hover:shadow-soft transition-all">
                                üîÆ ÏßÄÎÇúÏ£º Ï∞∏Ïó¨Ïûê ÏûêÎèôÏÑ†ÌÉù
                            </button>
                            <div class="grid grid-cols-2 gap-2">
                                <button type="button" id="selectHighAttendance" class="w-full bg-gradient-to-r from-pastel-green to-pastel-mint text-primary-800 text-xs py-1 px-2 rounded-lg font-medium">
                                    üèÜ Í≥†Ï∞∏Ïó¨Ïûê ÏÑ†ÌÉù
                                </button>
                                <button type="button" id="selectNeedMotivation" class="w-full bg-gradient-to-r from-pastel-coral to-pastel-pink text-primary-800 text-xs py-1 px-2 rounded-lg font-medium">
                                    üéØ ÎèôÍ∏∞Î∂ÄÏó¨ ÌïÑÏöî
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Ï∞∏Ïó¨Ïú® Î∂ÑÏÑù -->
                    <div class="bg-gradient-to-r from-pastel-yellow to-pastel-orange p-4 rounded-xl">
                        <h4 class="text-sm font-bold text-primary-800 mb-3">üìä Ïã§ÏãúÍ∞Ñ Ï∞∏Ïó¨Ïú® Î∂ÑÏÑù</h4>
                        <div class="grid grid-cols-3 gap-2 text-xs">
                            <div class="bg-white/50 p-2 rounded-lg text-center">
                                <div class="font-bold text-primary-800" id="attendanceRate">0%</div>
                                <div class="text-primary-600">Ï†ÑÏ≤¥ Ï∞∏Ïó¨Ïú®</div>
                            </div>
                            <div class="bg-white/50 p-2 rounded-lg text-center">
                                <div class="font-bold text-primary-800" id="workoutRate">0%</div>
                                <div class="text-primary-600">Ïö¥Îèô Ï∞∏Ïó¨Ïú®</div>
                            </div>
                            <div class="bg-white/50 p-2 rounded-lg text-center">
                                <div class="font-bold text-primary-800" id="meetingRate">0%</div>
                                <div class="text-primary-600">Î≤ô Ï∞∏Ïó¨Ïú®</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Î©§Î≤Ñ Î™©Î°ù -->
                <div class="mb-4">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-bold text-primary-800">üë• Î©§Î≤Ñ Î™©Î°ù</h4>
                        <div class="text-xs text-primary-600">
                            <span id="workoutCount">0</span>Î™Ö Ïö¥Îèô | <span id="meetingCount">0</span>Î™Ö Î≤ô<br>
                            <span id="workoutVoteCount">0</span>Î™Ö Ïö¥ÎèôÌà¨Ìëú | <span id="meetingVoteCount">0</span>Î™Ö Î≤ôÌà¨Ìëú
                        </div>
                    </div>
                </div>
                
                <div id="activityMemberList" class="space-y-3 mb-6 max-h-60 overflow-y-auto pr-2">
                    <!-- Î©§Î≤ÑÎ≥Ñ Ï≤¥ÌÅ¨Î∞ïÏä§Í∞Ä Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>
                
                <div class="flex justify-between items-center pt-4 border-t border-white/20">
                    <div class="text-xs text-primary-600">
                        üí° ÌåÅ: ÏßÄÎÇúÏ£º Ï∞∏Ïó¨ÏûêÎ•º Í∏∞Ï§ÄÏúºÎ°ú ÏûêÎèôÏÑ†ÌÉùÌï† Ïàò ÏûàÏñ¥Ïöî
                    </div>
                    <div class="flex space-x-3">
                        <button type="button" id="cancelActivity" class="px-6 py-3 text-primary-600 hover:text-primary-800 font-medium transition-colors rounded-xl hover:bg-pastel-purple">
                            Ï∑®ÏÜå
                        </button>
                        <button type="button" id="resetActivity" class="bg-gradient-to-r from-orange-400 to-red-400 text-white px-6 py-3 rounded-xl font-medium hover:from-orange-500 hover:to-red-500 transition-all">
                            üóëÔ∏è Ï¥àÍ∏∞Ìôî
                        </button>
                        <button type="submit" class="btn-primary text-white px-6 py-3 rounded-xl font-medium">
                            üíæ Ï†ÄÏû•
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Î™®Îã¨ -->
    <div id="changePasswordModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="card-gradient rounded-2xl shadow-soft-lg p-8 w-full max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="w-12 h-12 bg-gradient-to-br from-pastel-coral to-pastel-pink rounded-xl mx-auto mb-3 flex items-center justify-center">
                    <span class="text-xl">üîê</span>
                </div>
                <h3 class="text-2xl font-bold text-primary-800">ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω</h3>
                <p class="text-primary-600 text-sm mt-2">Î≥¥ÏïàÏùÑ ÏúÑÌï¥ ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Î®ºÏ†Ä ÌôïÏù∏Ìï©ÎãàÎã§</p>
            </div>
            
            <form id="changePasswordForm" class="space-y-6">
                <!-- ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏ -->
                <div>
                    <label class="block text-sm font-semibold text-primary-700 mb-2">ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                    <div class="relative">
                        <input type="password" id="currentPassword" required 
                               class="input-field w-full px-4 py-3 pr-12 rounded-xl focus:outline-none"
                               placeholder="ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                        <button type="button" id="toggleCurrentPassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-primary-500 hover:text-primary-700">
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>

                <!-- ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏ -->
                <div>
                    <label class="block text-sm font-semibold text-primary-700 mb-2">ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                    <div class="relative">
                        <input type="password" id="newPassword" required 
                               class="input-field w-full px-4 py-3 pr-12 rounded-xl focus:outline-none"
                               placeholder="ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" minlength="4">
                        <button type="button" id="toggleNewPassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-primary-500 hover:text-primary-700">
                            üëÅÔ∏è
                        </button>
                    </div>
                    <div class="mt-1 text-xs text-primary-500">ÏµúÏÜå 4Ïûê Ïù¥ÏÉÅ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
                </div>

                <!-- ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏ -->
                <div>
                    <label class="block text-sm font-semibold text-primary-700 mb-2">ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏</label>
                    <div class="relative">
                        <input type="password" id="confirmPassword" required 
                               class="input-field w-full px-4 py-3 pr-12 rounded-xl focus:outline-none"
                               placeholder="ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Îã§Ïãú ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                        <button type="button" id="toggleConfirmPassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-primary-500 hover:text-primary-700">
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>

                <!-- ÎπÑÎ∞ÄÎ≤àÌò∏ Í∞ïÎèÑ ÌëúÏãú -->
                <div class="bg-pastel-blue p-3 rounded-xl">
                    <div class="text-xs font-medium text-primary-700 mb-2">ÎπÑÎ∞ÄÎ≤àÌò∏ Í∞ïÎèÑ</div>
                    <div class="flex space-x-1">
                        <div id="strength1" class="flex-1 h-2 bg-gray-200 rounded"></div>
                        <div id="strength2" class="flex-1 h-2 bg-gray-200 rounded"></div>
                        <div id="strength3" class="flex-1 h-2 bg-gray-200 rounded"></div>
                        <div id="strength4" class="flex-1 h-2 bg-gray-200 rounded"></div>
                    </div>
                    <div id="strengthText" class="text-xs text-primary-600 mt-1">ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</div>
                </div>

                <!-- ÏóêÎü¨ Î©îÏãúÏßÄ -->
                <div id="passwordChangeError" class="text-red-500 text-sm text-center hidden"></div>

                <!-- Î≤ÑÌäºÎì§ -->
                <div class="flex space-x-3 pt-4">
                    <button type="button" id="cancelPasswordChange" class="flex-1 px-6 py-3 text-primary-600 hover:text-primary-800 font-medium transition-colors rounded-xl hover:bg-pastel-purple">
                        Ï∑®ÏÜå
                    </button>
                    <button type="submit" class="flex-1 btn-primary text-white px-6 py-3 rounded-xl font-medium">
                        üîê Î≥ÄÍ≤ΩÌïòÍ∏∞
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Î™®Îã¨ -->
    <div id="exportModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="card-gradient rounded-2xl shadow-soft-lg p-8 w-full max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="w-12 h-12 bg-gradient-to-br from-pastel-green to-pastel-mint rounded-xl mx-auto mb-3 flex items-center justify-center">
                    <span class="text-xl">üìÅ</span>
                </div>
                <h3 class="text-2xl font-bold text-primary-800">Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</h3>
                <p class="text-primary-600 text-sm mt-2">ÌïÑÏöîÌïú Îç∞Ïù¥ÌÑ∞Î•º ÏÑ†ÌÉùÌï¥ÏÑú ÎÇ¥Î≥¥ÎÇ¥ÏÑ∏Ïöî</p>
            </div>
            
            <div class="space-y-4">
                <!-- Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞ -->
                <div class="bg-gradient-to-r from-pastel-blue to-pastel-purple p-4 rounded-xl">
                    <h4 class="font-bold text-primary-800 mb-3 flex items-center">
                        <span class="text-lg mr-2">üìä</span>
                        Excel ÌååÏùº ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                    </h4>
                    <div class="space-y-2">
                        <button id="exportMembersExcel" class="w-full bg-white/60 backdrop-blur-sm text-primary-800 py-2 px-3 rounded-lg text-sm font-medium hover:bg-white/80 transition-all">
                            üë• Î©§Î≤Ñ Î™©Î°ù (Excel)
                        </button>
                        <button id="exportActivitiesExcel" class="w-full bg-white/60 backdrop-blur-sm text-primary-800 py-2 px-3 rounded-lg text-sm font-medium hover:bg-white/80 transition-all">
                            üìù ÌôúÎèô Í∏∞Î°ù (Excel)
                        </button>
                        <button id="exportAllExcel" class="w-full bg-white/60 backdrop-blur-sm text-primary-800 py-2 px-3 rounded-lg text-sm font-medium hover:bg-white/80 transition-all">
                            üìã Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ (Excel)
                        </button>
                    </div>
                </div>

                <!-- JSON Î∞±ÏóÖ -->
                <div class="bg-gradient-to-r from-pastel-yellow to-pastel-peach p-4 rounded-xl">
                    <h4 class="font-bold text-primary-800 mb-3 flex items-center">
                        <span class="text-lg mr-2">üíæ</span>
                        Î∞±ÏóÖ & Î≥µÏõê
                    </h4>
                    <div class="space-y-2">
                        <button id="exportBackup" class="w-full bg-white/60 backdrop-blur-sm text-primary-800 py-2 px-3 rounded-lg text-sm font-medium hover:bg-white/80 transition-all">
                            üì¶ Ï†ÑÏ≤¥ Î∞±ÏóÖ (JSON)
                        </button>
                        <div class="relative">
                            <input type="file" id="importBackup" accept=".json" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                            <button class="w-full bg-white/60 backdrop-blur-sm text-primary-800 py-2 px-3 rounded-lg text-sm font-medium hover:bg-white/80 transition-all">
                                üì• Î∞±ÏóÖ Î≥µÏõêÌïòÍ∏∞
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ÏõîÍ∞Ñ Î¶¨Ìè¨Ìä∏ -->
                <div class="bg-gradient-to-r from-pastel-coral to-pastel-pink p-4 rounded-xl">
                    <h4 class="font-bold text-primary-800 mb-3 flex items-center">
                        <span class="text-lg mr-2">üìÑ</span>
                        ÏõîÍ∞Ñ Î¶¨Ìè¨Ìä∏
                    </h4>
                    <div class="flex space-x-2">
                        <select id="reportMonth" class="flex-1 bg-white/60 backdrop-blur-sm text-primary-800 py-2 px-3 rounded-lg text-sm">
                            <!-- Ïõî ÏòµÏÖòÎì§Ïù¥ ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                        </select>
                        <button id="exportMonthlyReport" class="bg-white/60 backdrop-blur-sm text-primary-800 py-2 px-3 rounded-lg text-sm font-medium hover:bg-white/80 transition-all">
                            üìÑ ÏÉùÏÑ±
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-center mt-8">
                <button id="closeExport" class="btn-primary text-white px-8 py-3 rounded-xl font-medium">
                    ‚úÖ Îã´Í∏∞
                </button>
            </div>
        </div>
    </div>

    <!-- Î¶¨Ìè¨Ìä∏ Î™®Îã¨ -->
    <div id="reportModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="card-gradient rounded-2xl shadow-soft-lg p-8 w-full max-w-4xl mx-4 max-h-[80vh] overflow-y-auto">
            <div class="text-center mb-8">
                <div class="w-12 h-12 bg-gradient-to-br from-soft-purple to-soft-pink rounded-xl mx-auto mb-3 flex items-center justify-center">
                    <span class="text-xl">üìä</span>
                </div>
                <h3 class="text-2xl font-bold text-primary-800">ÌôúÎèô Î¶¨Ìè¨Ìä∏</h3>
                <p class="text-primary-600 text-sm mt-2">Î©§Î≤ÑÎì§Ïùò ÌôúÎèô ÌòÑÌô©ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-gradient-to-br from-pastel-yellow to-pastel-peach p-6 rounded-2xl">
                    <div class="flex items-center space-x-3 mb-4">
                        <span class="text-2xl">‚ö†Ô∏è</span>
                        <h4 class="font-bold text-primary-800 text-lg">Ï£ºÍ∞Ñ Î¶¨Ìè¨Ìä∏</h4>
                    </div>
                    <p class="text-primary-700 text-sm mb-3 font-medium">ÏßÄÎÇúÏ£º Ïö¥Îèô Í∑úÏπô ÎØ∏Ï§ÄÏàòÏûê</p>
                    <div id="weeklyReport" class="bg-white/50 backdrop-blur-sm rounded-xl p-4 text-sm">
                        <!-- Ï£ºÍ∞Ñ Î¶¨Ìè¨Ìä∏ ÎÇ¥Ïö© -->
                    </div>
                </div>
                <div class="bg-gradient-to-br from-pastel-coral to-pastel-pink p-6 rounded-2xl">
                    <div class="flex items-center space-x-3 mb-4">
                        <span class="text-2xl">üö®</span>
                        <h4 class="font-bold text-primary-800 text-lg">ÏõîÍ∞Ñ Î¶¨Ìè¨Ìä∏</h4>
                    </div>
                    <p class="text-primary-700 text-sm mb-3 font-medium">ÏßÄÎÇúÎã¨ Î≤ô Í∑úÏπô ÎØ∏Ï§ÄÏàòÏûê</p>
                    <div id="monthlyReport" class="bg-white/50 backdrop-blur-sm rounded-xl p-4 text-sm">
                        <!-- ÏõîÍ∞Ñ Î¶¨Ìè¨Ìä∏ ÎÇ¥Ïö© -->
                    </div>
                </div>
            </div>
            <div class="flex justify-center mt-8">
                <button id="closeReport" class="btn-primary text-white px-8 py-3 rounded-xl font-medium">
                    ‚úÖ ÌôïÏù∏
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase ÏÑ§Ï†ï
        const firebaseConfig = {
            apiKey: "AIzaSyCfJyGLYkyrUZmh_Hm_JheQfiuYa7ebzqc",
            authDomain: "gym-manager-app-b4e95.firebaseapp.com",
            projectId: "gym-manager-app-b4e95",
            storageBucket: "gym-manager-app-b4e95.appspot.com",
            messagingSenderId: "156759434691",
            appId: "1:156759434691:web:86080f103811be3bca8976",
            measurementId: "G-V1MQ4SM85V"
        };

        // Firebase Ï¥àÍ∏∞Ìôî (ÏïàÏ†ÑÌïú Ï¥àÍ∏∞Ìôî)
        let db = null;
        try {
            if (firebaseConfig.apiKey !== "your-api-key") {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                console.log('Firebase Ïó∞Í≤∞ ÏÑ±Í≥µ');
            } else {
                console.log('Firebase ÏÑ§Ï†ïÏù¥ Í∏∞Î≥∏Í∞íÏûÖÎãàÎã§. Î°úÏª¨ Î™®ÎìúÎ°ú Ïã§ÌñâÎê©ÎãàÎã§.');
            }
        } catch (error) {
            console.log('Firebase Ï¥àÍ∏∞Ìôî Ïã§Ìå®, Î°úÏª¨ Î™®ÎìúÎ°ú Ïã§Ìñâ:', error);
        }

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentUser = null;
        let currentDate = new Date();
        let currentWeekDate = new Date();
        let currentReportMonth = new Date();
        let members = [];
        let activities = {};
        let editingMemberId = null;

        // DOM ÏöîÏÜå
        const loginScreen = document.getElementById('loginScreen');
        const mainDashboard = document.getElementById('mainDashboard');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        const userInfo = document.getElementById('userInfo');
        const logoutBtn = document.getElementById('logoutBtn');

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
        });

        function initializeApp() {
            // Firebase Ï¥àÍ∏∞Ìôî ÌîåÎûòÍ∑∏ Î¶¨ÏÖã (ÏÉàÎ°úÏö¥ Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•ÏùÑ ÏúÑÌï¥)
            localStorage.removeItem('firebaseInitialized');
            
            // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥ ÌôïÏù∏
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
            } else {
                showLogin();
            }
        }

        function setupEventListeners() {
            // Î°úÍ∑∏Ïù∏ Ìèº
            loginForm.addEventListener('submit', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);

            // Îã¨Î†• ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });
            document.getElementById('nextMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });

            // Ï£ºÍ∞Ñ ÎåÄÏãúÎ≥¥Îìú ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
            document.getElementById('prevWeek').addEventListener('click', () => {
                currentWeekDate.setDate(currentWeekDate.getDate() - 7);
                renderWeeklyDashboard();
            });
            document.getElementById('nextWeek').addEventListener('click', () => {
                currentWeekDate.setDate(currentWeekDate.getDate() + 7);
                renderWeeklyDashboard();
            });

            // ÏõîÍ∞Ñ Î¶¨Ìè¨Ìä∏ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
            document.getElementById('prevReportMonth').addEventListener('click', () => {
                currentReportMonth.setMonth(currentReportMonth.getMonth() - 1);
                renderMonthlyReport();
            });
            document.getElementById('nextReportMonth').addEventListener('click', () => {
                currentReportMonth.setMonth(currentReportMonth.getMonth() + 1);
                renderMonthlyReport();
            });

            // Î™®Îã¨ Í¥ÄÎ†®
            setupModalEventListeners();

            // Î©§Î≤Ñ Í¥ÄÎ¶¨
            document.getElementById('addMemberBtn').addEventListener('click', () => openMemberModal());
            
            // Í≥†Í∏â ÌïÑÌÑ∞ÎßÅ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà (ÎîîÎ∞îÏö¥Ïä§ Ï†ÅÏö©)
            const debouncedRenderMemberList = debounce(renderMemberList, 300);
            document.getElementById('memberSearch').addEventListener('input', debouncedRenderMemberList);
            document.getElementById('statusFilter').addEventListener('change', renderMemberList);
            document.getElementById('roleFilter').addEventListener('change', renderMemberList);
            document.getElementById('sortFilter').addEventListener('change', renderMemberList);
            document.getElementById('periodFilter').addEventListener('change', renderMemberList);
            
            // Îπ†Î•∏ ÌïÑÌÑ∞ Î≤ÑÌäºÎì§
            document.getElementById('filterNewMembers').addEventListener('click', () => applyQuickFilter('new'));
            document.getElementById('filterActiveToday').addEventListener('click', () => applyQuickFilter('today'));
            document.getElementById('filterNeedAttention').addEventListener('click', () => applyQuickFilter('attention'));
            document.getElementById('clearFilters').addEventListener('click', clearAllFilters);
            
            // Ï∂úÏÑù Îû≠ÌÇπ Í∏∞Îä•
            document.getElementById('refreshRanking').addEventListener('click', renderAttendanceRanking);
            document.getElementById('rankingPeriod').addEventListener('change', renderAttendanceRanking);
            
            // Îû≠ÌÇπ ÌÉ≠ Í∏∞Îä•
            document.getElementById('totalRankingTab').addEventListener('click', () => switchRankingTab('total'));
            document.getElementById('workoutRankingTab').addEventListener('click', () => switchRankingTab('workout'));
            document.getElementById('meetingRankingTab').addEventListener('click', () => switchRankingTab('meeting'));
            
            // Î™®Î∞îÏùº ÌÉ≠ Í∏∞Îä•
            setupMobileTabs();
            
            // ÌÑ∞Ïπò Ï†úÏä§Ï≤ò ÏÑ§Ï†ï
            setupTouchGestures();
            
            // Î™®Î∞îÏùº Î©îÎâ¥ ÏÑ§Ï†ï
            setupMobileMenu();
            
            // ÏÑ±Îä• ÏµúÏ†ÅÌôî ÏÑ§Ï†ï
            setupPerformanceOptimizations();

            // Î¶¨Ìè¨Ìä∏
            document.getElementById('reportBtn').addEventListener('click', openReportModal);
            
            // ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω
            document.getElementById('changePasswordBtn').addEventListener('click', openChangePasswordModal);
            
            // Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
            document.getElementById('exportBtn').addEventListener('click', openExportModal);
            
            // Í∞ïÏ†ú Ï¥àÍ∏∞Ìôî (Î∞©Ïû•Îßå)
            document.getElementById('forceInitBtn').addEventListener('click', forceFirebaseInit);
        }

        function setupModalEventListeners() {
            // Í≥µÏßÄÏÇ¨Ìï≠ Î™®Îã¨
            document.getElementById('editNoticeBtn').addEventListener('click', openNoticeModal);
            document.getElementById('cancelNotice').addEventListener('click', closeNoticeModal);
            document.getElementById('noticeForm').addEventListener('submit', saveNotice);

            // Î©§Î≤Ñ Î™®Îã¨
            document.getElementById('cancelMember').addEventListener('click', closeMemberModal);
            document.getElementById('deleteMember').addEventListener('click', deleteMemberConfirm);
            document.getElementById('memberForm').addEventListener('submit', saveMember);

            // ÌôúÎèô Î™®Îã¨
            document.getElementById('cancelActivity').addEventListener('click', closeActivityModal);
            document.getElementById('resetActivity').addEventListener('click', resetActivityRecord);
            document.getElementById('activityForm').addEventListener('submit', saveActivity);

            // Î¶¨Ìè¨Ìä∏ Î™®Îã¨
            document.getElementById('closeReport').addEventListener('click', closeReportModal);
            
            // ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Î™®Îã¨
            document.getElementById('cancelPasswordChange').addEventListener('click', closeChangePasswordModal);
            document.getElementById('changePasswordForm').addEventListener('submit', handlePasswordChange);
            document.getElementById('toggleCurrentPassword').addEventListener('click', () => togglePasswordVisibility('currentPassword'));
            document.getElementById('toggleNewPassword').addEventListener('click', () => togglePasswordVisibility('newPassword'));
            document.getElementById('toggleConfirmPassword').addEventListener('click', () => togglePasswordVisibility('confirmPassword'));
            document.getElementById('newPassword').addEventListener('input', checkPasswordStrength);
            document.getElementById('confirmPassword').addEventListener('input', checkPasswordMatch);

            // Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Î™®Îã¨
            document.getElementById('closeExport').addEventListener('click', closeExportModal);
            document.getElementById('exportMembersExcel').addEventListener('click', () => exportToExcel('members'));
            document.getElementById('exportActivitiesExcel').addEventListener('click', () => exportToExcel('activities'));
            document.getElementById('exportAllExcel').addEventListener('click', () => exportToExcel('all'));
            document.getElementById('exportBackup').addEventListener('click', exportBackup);
            document.getElementById('importBackup').addEventListener('change', importBackup);
            document.getElementById('exportMonthlyReport').addEventListener('click', exportMonthlyReport);
        }

        async function handleLogin(e) {
            e.preventDefault();
            const id = document.getElementById('loginId').value;
            const password = document.getElementById('loginPassword').value;

            try {
                // Í∏∞Î≥∏ Í¥ÄÎ¶¨Ïûê Í≥ÑÏ†ïÎì§ (Firebase Ïó∞Í≤∞ Ï†ÑÏóêÎèÑ ÏûëÎèô)
                const defaultAccounts = {
                    'ÏÑúÏïÑ': { password: '1234', name: 'ÏÑúÏïÑ', role: 'super_admin' },
                    'admin': { password: 'admin123', name: 'Í¥ÄÎ¶¨Ïûê', role: 'admin' }
                };

                // Í∏∞Î≥∏ Í≥ÑÏ†ï ÌôïÏù∏
                if (defaultAccounts[id] && defaultAccounts[id].password === password) {
                    currentUser = { 
                        id: id, 
                        name: defaultAccounts[id].name, 
                        role: defaultAccounts[id].role 
                    };
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // FirebaseÍ∞Ä Ïó∞Í≤∞ÎêòÏñ¥ ÏûàÎã§Î©¥ Î™®Îì† Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞Î•º FirebaseÏóê Ï†ÄÏû• (Ìïú Î≤àÎßå)
                    try {
                        if (typeof firebase !== 'undefined' && firebase.apps.length > 0 && id === 'ÏÑúÏïÑ') {
                            // Ïù¥ÎØ∏ Ï¥àÍ∏∞ÌôîÎêòÏóàÎäîÏßÄ ÌôïÏù∏
                            const initCheck = localStorage.getItem('firebaseInitialized');
                            if (!initCheck) {
                                console.log('FirebaseÏóê Î™®Îì† Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ï§ë...');
                                
                                // Î™®Îì† Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞ Ï†ïÏùò
                                const allMembers = [
                                    { id: 'ÏÑúÏïÑ', name: 'ÏÑúÏïÑ', nickname: 'ÏÑúÏïÑ', role: 'super_admin', phone: '010-0000-0000' },
                                    { id: 'member_ÏπòÏ¶à', name: 'ÏπòÏ¶à', nickname: 'ÏπòÏ¶à', role: 'member', phone: '010-0000-0001' },
                                    { id: 'member_Ïª§ÌîÑ', name: 'Ïª§ÌîÑ', nickname: 'Ïª§ÌîÑ', role: 'member', phone: '010-0000-0002' },
                                    { id: 'member_ÌïòÏö∞ÏßÄ', name: 'ÌïòÏö∞ÏßÄ', nickname: 'ÌïòÏö∞ÏßÄ', role: 'member', phone: '010-0000-0003' },
                                    { id: 'member_Ìó¨Î¶∞', name: 'Ìó¨Î¶∞', nickname: 'Ìó¨Î¶∞', role: 'member', phone: '010-0000-0004' },
                                    { id: 'member_Ìô©Í∏∞Ï†Å', name: 'Ìô©Í∏∞Ï†Å', nickname: 'Ìô©Í∏∞Ï†Å', role: 'member', phone: '010-0000-0005' },
                                    { id: 'member_Î∏îÎûô', name: 'Î∏îÎûô', nickname: 'Î∏îÎûô', role: 'member', phone: '010-0000-0006' },
                                    { id: 'member_ÏãúÏõê', name: 'ÏãúÏõê', nickname: 'ÏãúÏõê', role: 'member', phone: '010-0000-0007' },
                                    { id: 'member_Ïñ¥ÏßÄ', name: 'Ïñ¥ÏßÄ', nickname: 'Ïñ¥ÏßÄ', role: 'member', phone: '010-0000-0008' },
                                    { id: 'member_Ï§ÑÏãúÏûë', name: 'Ï§ÑÏãúÏûë', nickname: 'Ï§ÑÏãúÏûë', role: 'member', phone: '010-0000-0009' },
                                    { id: 'member_Ï°∞Ìè≠', name: 'Ï°∞Ìè≠', nickname: 'Ï°∞Ìè≠', role: 'member', phone: '010-0000-0010' },
                                    { id: 'member_Î∞•Î∞•', name: 'Î∞•Î∞•', nickname: 'Î∞•Î∞•', role: 'member', phone: '010-0000-0011' },
                                    { id: 'member_Î±ÉÏÇ¥ÎßàÏôï', name: 'Î±ÉÏÇ¥ÎßàÏôï', nickname: 'Î±ÉÏÇ¥ÎßàÏôï', role: 'member', phone: '010-0000-0012' },
                                    { id: 'member_Î¥âÎèô', name: 'Î¥âÎèô', nickname: 'Î¥âÎèô', role: 'member', phone: '010-0000-0013' },
                                    { id: 'member_Î∂ÄÏπò', name: 'Î∂ÄÏπò', nickname: 'Î∂ÄÏπò', role: 'member', phone: '010-0000-0014' },
                                    { id: 'member_Íµ¨Î¶Ñ', name: 'Íµ¨Î¶Ñ', nickname: 'Íµ¨Î¶Ñ', role: 'member', phone: '010-0000-0015' },
                                    { id: 'member_ÍøÄÎ∞§', name: 'ÍøÄÎ∞§', nickname: 'ÍøÄÎ∞§', role: 'member', phone: '010-0000-0016' },
                                    { id: 'member_ÎÇòÏòÅ', name: 'ÎÇòÏòÅ', nickname: 'ÎÇòÏòÅ', role: 'member', phone: '010-0000-0017' },
                                    { id: 'member_Î¨¥ÏßÄ', name: 'Î¨¥ÏßÄ', nickname: 'Î¨¥ÏßÄ', role: 'member', phone: '010-0000-0018' },
                                    { id: 'member_ÎØºÏòÅ', name: 'ÎØºÏòÅ', nickname: 'ÎØºÏòÅ', role: 'member', phone: '010-0000-0019' },
                                    { id: 'member_Í∞§Îü≠Ïãú', name: 'Í∞§Îü≠Ïãú', nickname: 'Í∞§Îü≠Ïãú', role: 'member', phone: '010-0000-0020' },
                                    { id: 'member_Í±∞Î∂Å', name: 'Í±∞Î∂Å', nickname: 'Í±∞Î∂Å', role: 'member', phone: '010-0000-0021' },
                                    { 
                                        id: 'member_Í∏∞Î£¨', 
                                        name: 'Í∏∞Î£¨', 
                                        nickname: 'Í∏∞Î£¨', 
                                        role: 'admin', 
                                        phone: '010-0000-0022',
                                        loginId: 'girun',
                                        password: 'ADMIN123',
                                        accountCreated: true,
                                        accountCreatedAt: new Date().toISOString()
                                    },
                                    { id: 'member_Ïò§Ïäà', name: 'Ïò§Ïäà', nickname: 'Ïò§Ïäà', role: 'member', phone: '010-0000-0023' },
                                    { id: 'member_Ï¥àÎ≥¥', name: 'Ï¥àÎ≥¥', nickname: 'Ï¥àÎ≥¥', role: 'member', phone: '010-0000-0024' }
                                ];
                                
                                // FirebaseÏóê Î™®Îì† Î©§Î≤Ñ Ï†ÄÏû• (Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú ÌõÑ ÏÉàÎ°ú Ï†ÄÏû•)
                                setTimeout(async () => {
                                    try {
                                        console.log('üóëÔ∏è Í∏∞Ï°¥ Firebase Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú Ï§ë...');
                                        
                                        // Í∏∞Ï°¥ Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞ Î™®Îëê ÏÇ≠Ï†ú
                                        const existingSnapshot = await db.collection('v2_members').get();
                                        console.log(`ÏÇ≠Ï†úÌï† Í∏∞Ï°¥ Î©§Î≤Ñ Ïàò: ${existingSnapshot.size}`);
                                        
                                        const deletePromises = [];
                                        existingSnapshot.forEach(doc => {
                                            deletePromises.push(doc.ref.delete());
                                        });
                                        
                                        if (deletePromises.length > 0) {
                                            await Promise.all(deletePromises);
                                            console.log('‚úÖ Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú ÏôÑÎ£å');
                                        }
                                        
                                        // 1Ï¥à ÎåÄÍ∏∞ ÌõÑ ÏÉà Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                                        await new Promise(resolve => setTimeout(resolve, 1000));
                                        
                                        console.log(`üìù FirebaseÏóê ${allMembers.length}Î™ÖÏùò Î©§Î≤Ñ ÏÉàÎ°ú Ï†ÄÏû• ÏãúÏûë...`);
                                        
                                        for (let i = 0; i < allMembers.length; i++) {
                                            const member = allMembers[i];
                                            try {
                                                console.log(`Ï†ÄÏû• Ï§ë ${i + 1}/${allMembers.length}: ${member.name}`);
                                                
                                                await db.collection('v2_members').doc(member.id).set({
                                                    id: member.id,
                                                    name: member.name,
                                                    nickname: member.nickname,
                                                    role: member.role,
                                                    phone: member.phone,
                                                    joinDate: new Date(`2024-01-${String(i + 1).padStart(2, '0')}`).toISOString(),
                                                    isActive: true,
                                                    password: member.role === 'super_admin' ? '1234' : '',
                                                    createdAt: new Date().toISOString(),
                                                    updatedAt: new Date().toISOString()
                                                });
                                                
                                                console.log(`‚úÖ Ï†ÄÏû• ÏôÑÎ£å: ${member.name}`);
                                                
                                                // Í∞Å Ï†ÄÏû• ÏÇ¨Ïù¥Ïóê ÏßßÏùÄ ÏßÄÏó∞
                                                await new Promise(resolve => setTimeout(resolve, 100));
                                                
                                            } catch (memberError) {
                                                console.error(`‚ùå Î©§Î≤Ñ ${member.name} Ï†ÄÏû• Ïã§Ìå®:`, memberError);
                                                
                                                // Ïã§Ìå® Ïãú Ïû¨ÏãúÎèÑ
                                                try {
                                                    console.log(`Ïû¨ÏãúÎèÑ: ${member.name}`);
                                                    await new Promise(resolve => setTimeout(resolve, 500));
                                                    await db.collection('v2_members').doc(member.id).set({
                                                        id: member.id,
                                                        name: member.name,
                                                        nickname: member.nickname,
                                                        role: member.role,
                                                        phone: member.phone,
                                                        joinDate: new Date(`2024-01-${String(i + 1).padStart(2, '0')}`).toISOString(),
                                                        isActive: true,
                                                        password: member.role === 'super_admin' ? '1234' : '',
                                                        createdAt: new Date().toISOString(),
                                                        updatedAt: new Date().toISOString()
                                                    });
                                                    console.log(`‚úÖ Ïû¨ÏãúÎèÑ ÏÑ±Í≥µ: ${member.name}`);
                                                } catch (retryError) {
                                                    console.error(`‚ùå Ïû¨ÏãúÎèÑÎèÑ Ïã§Ìå®: ${member.name}`, retryError);
                                                }
                                            }
                                        }
                                        
                                        localStorage.setItem('firebaseInitialized', 'true');
                                        console.log('üéâ Î™®Îì† Î©§Î≤Ñ Ï†ÄÏû• Í≥ºÏ†ï ÏôÑÎ£å!');
                                        
                                        // Ï†ÄÏû• ÏôÑÎ£å ÌõÑ ÌôïÏù∏
                                        setTimeout(async () => {
                                            console.log('Firebase Ï†ÄÏû• Í≤∞Í≥º ÌôïÏù∏ Ï§ë...');
                                            const checkSnapshot = await db.collection('v2_members').get();
                                            console.log(`FirebaseÏóê Ïã§Ï†ú Ï†ÄÏû•Îêú Î©§Î≤Ñ Ïàò: ${checkSnapshot.size}`);
                                            
                                            // Î©§Î≤Ñ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                                            await loadMembers();
                                            renderMemberList();
                                            console.log('Î©§Î≤Ñ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ® ÏôÑÎ£å');
                                        }, 2000);
                                        
                                    } catch (error) {
                                        console.error('Firebase Ï†ÄÏû• Ï†ÑÏ≤¥ Ïò§Î•ò:', error);
                                    }
                                }, 1000);
                            }
                        }
                    } catch (firebaseError) {
                        console.log('Firebase Ï†ÄÏû• Ïã§Ìå® (Î°úÏª¨ Î™®ÎìúÎ°ú Í≥ÑÏÜç):', firebaseError);
                    }
                    
                    showDashboard();
                    return;
                }

                // Î∂ÄÎ∞©Ïû• Í≥ÑÏ†ï ÌôïÏù∏ (Î°úÏª¨ Î©§Î≤Ñ Î™©Î°ùÏóêÏÑú)
                const subAdminMember = members.find(member => 
                    member.loginId === id && 
                    member.password === password && 
                    member.role === 'admin' &&
                    member.accountCreated === true &&
                    member.isActive !== false
                );
                
                if (subAdminMember) {
                    currentUser = {
                        id: subAdminMember.loginId,
                        name: subAdminMember.name,
                        nickname: subAdminMember.nickname,
                        role: 'admin',
                        memberId: subAdminMember.id,
                        password: password,
                        phone: subAdminMember.phone
                    };
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    showMessage(`üéâ ${subAdminMember.name}Îãò, ÌôòÏòÅÌï©ÎãàÎã§!`, 'success');
                    showDashboard();
                    return;
                }

                // FirebaseÏóêÏÑú ÏÇ¨Ïö©Ïûê ÌôïÏù∏ (FirebaseÍ∞Ä Ïó∞Í≤∞Îêú Í≤ΩÏö∞ÏóêÎßå)
                if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                    const userDoc = await db.collection('v2_members').doc(id).get();
                    
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        if (userData.password === password && (userData.role === 'super_admin' || userData.role === 'admin')) {
                            currentUser = { id: id, ...userData };
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));
                            showDashboard();
                            return;
                        }
                    }
                    
                    // FirebaseÏóêÏÑú loginIdÎ°úÎèÑ Í≤ÄÏÉâ
                    const memberQuery = await db.collection('v2_members').where('loginId', '==', id).get();
                    if (!memberQuery.empty) {
                        const memberDoc = memberQuery.docs[0];
                        const userData = memberDoc.data();
                        if (userData.password === password && userData.role === 'admin' && userData.accountCreated) {
                            currentUser = {
                                id: userData.loginId,
                                name: userData.name,
                                nickname: userData.nickname,
                                role: 'admin',
                                memberId: memberDoc.id,
                                password: password,
                                phone: userData.phone
                            };
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));
                            showMessage(`üéâ ${userData.name}Îãò, ÌôòÏòÅÌï©ÎãàÎã§!`, 'success');
                            showDashboard();
                            return;
                        }
                    }
                }

                showLoginError('ÏïÑÏù¥Îîî ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
            } catch (error) {
                console.error('Î°úÍ∑∏Ïù∏ Ïò§Î•ò:', error);
                // Firebase Ïó∞Í≤∞ Ïò§Î•òÏù∏ Í≤ΩÏö∞ Í∏∞Î≥∏ Í≥ÑÏ†ïÏúºÎ°ú Ïû¨ÏãúÎèÑ
                if (error.code === 'unavailable' || error.message.includes('Firebase')) {
                    console.log('Firebase Ïó∞Í≤∞ Ïã§Ìå®, Î°úÏª¨ Î™®ÎìúÎ°ú Ï†ÑÌôò');
                    if (id === 'ÏÑúÏïÑ' && password === '1234') {
                        currentUser = { id: 'ÏÑúÏïÑ', name: 'ÏÑúÏïÑ', role: 'super_admin' };
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        showDashboard();
                        return;
                    }
                }
                showLoginError('Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Í∏∞Î≥∏ Í≥ÑÏ†ï(ÏÑúÏïÑ/1234)ÏùÑ ÏÇ¨Ïö©Ìï¥Î≥¥ÏÑ∏Ïöî.');
            }
        }

        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 3000);
        }

        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showLogin();
        }

        function showLogin() {
            loginScreen.classList.remove('hidden');
            mainDashboard.classList.add('hidden');
        }

        function showDashboard() {
            loginScreen.classList.add('hidden');
            mainDashboard.classList.remove('hidden');
            
            // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÌëúÏãú
            const roleText = currentUser.role === 'super_admin' ? 'Î∞©Ïû•' : 'Î∂ÄÎ∞©Ïû•';
            userInfo.textContent = `${currentUser.name} (${roleText})`;
            
            // Î∞©Ïû•Îßå Í≥µÏßÄÏàòÏ†ï Î≤ÑÌäºÍ≥º Í∞ïÏ†ú Ï¥àÍ∏∞Ìôî Î≤ÑÌäº ÌëúÏãú
            if (currentUser.role === 'super_admin') {
                document.getElementById('editNoticeBtn').classList.remove('hidden');
                document.getElementById('forceInitBtn').classList.remove('hidden');
            }

            // Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            loadData();
        }

        async function loadData() {
            try {
                await Promise.all([
                    loadMembers(),
                    loadNotice(),
                    loadActivities()
                ]);
                
                renderCalendar();
                renderMemberList();
                renderWeeklyDashboard();
                renderMonthlyReport();
                renderAttendanceRanking(); // Ï∂úÏÑù Îû≠ÌÇπ Ï∂îÍ∞Ä
            } catch (error) {
                console.error('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïò§Î•ò:', error);
            }
        }

        async function loadMembers() {
            try {
                if (db) {
                    console.log('FirebaseÏóêÏÑú Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ë...');
                    const snapshot = await db.collection('v2_members').get();
                    members = [];
                    snapshot.forEach(doc => {
                        members.push({ id: doc.id, ...doc.data() });
                        console.log('FirebaseÏóêÏÑú Î°úÎìúÎêú Î©§Î≤Ñ:', doc.id, doc.data().name);
                    });
                    console.log('FirebaseÏóêÏÑú Ï¥ù Î°úÎìúÎêú Î©§Î≤Ñ Ïàò:', members.length);
                } else {
                    // Î°úÏª¨ Î™®Îìú: Í∏∞Î≥∏ Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞ (Ìï≠ÏÉÅ ÏÉàÎ°ú Î°úÎìú)
                    // const savedMembers = localStorage.getItem('localMembers');
                    // if (savedMembers) {
                    //     members = JSON.parse(savedMembers);
                    // } else {
                        members = [
                            {
                                id: 'ÏÑúÏïÑ',
                                name: 'ÏÑúÏïÑ',
                                nickname: 'ÏÑúÏïÑ',
                                role: 'super_admin',
                                phone: '010-0000-0000',
                                joinDate: new Date().toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_ÏπòÏ¶à',
                                name: 'ÏπòÏ¶à',
                                nickname: 'ÏπòÏ¶à',
                                role: 'member',
                                phone: '010-0000-0001',
                                joinDate: new Date('2024-01-01').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Ïª§ÌîÑ',
                                name: 'Ïª§ÌîÑ',
                                nickname: 'Ïª§ÌîÑ',
                                role: 'member',
                                phone: '010-0000-0002',
                                joinDate: new Date('2024-01-02').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_ÌïòÏö∞ÏßÄ',
                                name: 'ÌïòÏö∞ÏßÄ',
                                nickname: 'ÌïòÏö∞ÏßÄ',
                                role: 'member',
                                phone: '010-0000-0003',
                                joinDate: new Date('2024-01-03').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Ìó¨Î¶∞',
                                name: 'Ìó¨Î¶∞',
                                nickname: 'Ìó¨Î¶∞',
                                role: 'member',
                                phone: '010-0000-0004',
                                joinDate: new Date('2024-01-04').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Ìô©Í∏∞Ï†Å',
                                name: 'Ìô©Í∏∞Ï†Å',
                                nickname: 'Ìô©Í∏∞Ï†Å',
                                role: 'member',
                                phone: '010-0000-0005',
                                joinDate: new Date('2024-01-05').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Î∏îÎûô',
                                name: 'Î∏îÎûô',
                                nickname: 'Î∏îÎûô',
                                role: 'member',
                                phone: '010-0000-0006',
                                joinDate: new Date('2024-01-06').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_ÏãúÏõê',
                                name: 'ÏãúÏõê',
                                nickname: 'ÏãúÏõê',
                                role: 'member',
                                phone: '010-0000-0007',
                                joinDate: new Date('2024-01-07').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Ïñ¥ÏßÄ',
                                name: 'Ïñ¥ÏßÄ',
                                nickname: 'Ïñ¥ÏßÄ',
                                role: 'member',
                                phone: '010-0000-0008',
                                joinDate: new Date('2024-01-08').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Ï§ÑÏãúÏûë',
                                name: 'Ï§ÑÏãúÏûë',
                                nickname: 'Ï§ÑÏãúÏûë',
                                role: 'member',
                                phone: '010-0000-0009',
                                joinDate: new Date('2024-01-09').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Ï°∞Ìè≠',
                                name: 'Ï°∞Ìè≠',
                                nickname: 'Ï°∞Ìè≠',
                                role: 'member',
                                phone: '010-0000-0010',
                                joinDate: new Date('2024-01-10').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Î∞•Î∞•',
                                name: 'Î∞•Î∞•',
                                nickname: 'Î∞•Î∞•',
                                role: 'member',
                                phone: '010-0000-0011',
                                joinDate: new Date('2024-01-11').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Î±ÉÏÇ¥ÎßàÏôï',
                                name: 'Î±ÉÏÇ¥ÎßàÏôï',
                                nickname: 'Î±ÉÏÇ¥ÎßàÏôï',
                                role: 'member',
                                phone: '010-0000-0012',
                                joinDate: new Date('2024-01-12').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Î¥âÎèô',
                                name: 'Î¥âÎèô',
                                nickname: 'Î¥âÎèô',
                                role: 'member',
                                phone: '010-0000-0013',
                                joinDate: new Date('2024-01-13').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Î∂ÄÏπò',
                                name: 'Î∂ÄÏπò',
                                nickname: 'Î∂ÄÏπò',
                                role: 'member',
                                phone: '010-0000-0014',
                                joinDate: new Date('2024-01-14').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Íµ¨Î¶Ñ',
                                name: 'Íµ¨Î¶Ñ',
                                nickname: 'Íµ¨Î¶Ñ',
                                role: 'member',
                                phone: '010-0000-0015',
                                joinDate: new Date('2024-01-15').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_ÍøÄÎ∞§',
                                name: 'ÍøÄÎ∞§',
                                nickname: 'ÍøÄÎ∞§',
                                role: 'member',
                                phone: '010-0000-0016',
                                joinDate: new Date('2024-01-16').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_ÎÇòÏòÅ',
                                name: 'ÎÇòÏòÅ',
                                nickname: 'ÎÇòÏòÅ',
                                role: 'member',
                                phone: '010-0000-0017',
                                joinDate: new Date('2024-01-17').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Î¨¥ÏßÄ',
                                name: 'Î¨¥ÏßÄ',
                                nickname: 'Î¨¥ÏßÄ',
                                role: 'member',
                                phone: '010-0000-0018',
                                joinDate: new Date('2024-01-18').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_ÎØºÏòÅ',
                                name: 'ÎØºÏòÅ',
                                nickname: 'ÎØºÏòÅ',
                                role: 'member',
                                phone: '010-0000-0019',
                                joinDate: new Date('2024-01-19').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Í∞§Îü≠Ïãú',
                                name: 'Í∞§Îü≠Ïãú',
                                nickname: 'Í∞§Îü≠Ïãú',
                                role: 'member',
                                phone: '010-0000-0020',
                                joinDate: new Date('2024-01-20').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Í±∞Î∂Å',
                                name: 'Í±∞Î∂Å',
                                nickname: 'Í±∞Î∂Å',
                                role: 'member',
                                phone: '010-0000-0021',
                                joinDate: new Date('2024-01-21').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Í∏∞Î£¨',
                                name: 'Í∏∞Î£¨',
                                nickname: 'Í∏∞Î£¨',
                                role: 'admin',
                                phone: '010-0000-0022',
                                joinDate: new Date('2024-01-22').toISOString(),
                                isActive: true
                            },
                            {
                                id: 'member_Ïò§Ïäà',
                                name: 'Ïò§Ïäà',
                                nickname: 'Ïò§Ïäà',
                                role: 'member',
                                phone: '010-0000-0023',
                                joinDate: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(), // 5Ïùº Ï†Ñ Í∞ÄÏûÖ
                                isActive: true
                            },
                            {
                                id: 'member_Ï¥àÎ≥¥',
                                name: 'Ï¥àÎ≥¥',
                                nickname: 'Ï¥àÎ≥¥',
                                role: 'member',
                                phone: '010-0000-0024',
                                joinDate: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(), // 2Ïùº Ï†Ñ Í∞ÄÏûÖ
                                isActive: true
                            }
                        ];
                        localStorage.setItem('localMembers', JSON.stringify(members));
                    // }
                }
            } catch (error) {
                console.error('Î©§Î≤Ñ Î°úÎìú Ïò§Î•ò:', error);
                members = [];
            }
        }

        async function loadNotice() {
            try {
                if (db) {
                    const doc = await db.collection('v2_config').doc('notice').get();
                    if (doc.exists) {
                        const noticeData = doc.data();
                        updateNoticeDisplay(noticeData.category, noticeData.content);
                    }
                } else {
                    // Î°úÏª¨ Î™®Îìú: Í∏∞Î≥∏ Í≥µÏßÄÏÇ¨Ìï≠
                    const savedNotice = localStorage.getItem('localNotice');
                    if (savedNotice) {
                        const noticeData = JSON.parse(savedNotice);
                        updateNoticeDisplay(noticeData.category, noticeData.content);
                    }
                }
            } catch (error) {
                console.error('Í≥µÏßÄÏÇ¨Ìï≠ Î°úÎìú Ïò§Î•ò:', error);
            }
        }

        async function loadActivities() {
            try {
                if (db) {
                    const snapshot = await db.collection('v2_activities').get();
                    activities = {};
                    snapshot.forEach(doc => {
                        activities[doc.id] = doc.data();
                    });
                } else {
                    // Î°úÏª¨ Î™®Îìú: Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú ÌôúÎèô Í∏∞Î°ù Î°úÎìú
                    const savedActivities = localStorage.getItem('localActivities');
                    if (savedActivities) {
                        activities = JSON.parse(savedActivities);
                    } else {
                        activities = {};
                    }
                }
            } catch (error) {
                console.error('ÌôúÎèô Í∏∞Î°ù Î°úÎìú Ïò§Î•ò:', error);
                activities = {};
            }
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const monthYear = document.getElementById('currentMonth');
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            monthYear.textContent = `${year}ÎÖÑ ${month + 1}Ïõî`;
            
            // Îã¨Î†• Ï¥àÍ∏∞Ìôî
            calendar.innerHTML = '';
            
            // ÏöîÏùº Ìó§Îçî
            const weekdays = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'text-center font-medium text-gray-600 py-2';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            // Îã¨Î†• ÎÇ†Ïßú
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day border border-gray-200 p-2 text-center';
                
                const dateStr = formatDate(date);
                const isCurrentMonth = date.getMonth() === month;
                const hasActivity = activities[dateStr];
                
                if (!isCurrentMonth) {
                    dayElement.classList.add('text-gray-400');
                }
                
                if (hasActivity) {
                    dayElement.classList.add('has-activity');
                }
                
                dayElement.innerHTML = `
                    <div class="font-medium">${date.getDate()}</div>
                    ${hasActivity ? '<div class="text-xs text-blue-600 mt-1">ÌôúÎèô</div>' : ''}
                `;
                
                dayElement.addEventListener('click', () => openActivityModal(dateStr));
                calendar.appendChild(dayElement);
            }
        }

        function renderMemberList() {
            console.log('renderMemberList Ìò∏Ï∂úÎê®');
            console.log('members Î∞∞Ïó¥:', members);
            console.log('members Í∏∏Ïù¥:', members.length);
            
            const memberList = document.getElementById('memberList');
            if (!memberList) {
                console.error('memberList ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§!');
                return;
            }
            
            let filteredMembers = [...members];
            
            // Í≥†Í∏â ÌïÑÌÑ∞ÎßÅ Ï†ÅÏö©
            filteredMembers = applyAdvancedFilters(filteredMembers);
            
            console.log('ÌïÑÌÑ∞ÎßÅÎêú Î©§Î≤Ñ Ïàò:', filteredMembers.length);
            
            memberList.innerHTML = '';
            
            if (filteredMembers.length === 0) {
                memberList.innerHTML = '<div class="text-gray-500 text-center py-4">Î©§Î≤ÑÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }
            
            filteredMembers.forEach((member, index) => {
                console.log(`Î©§Î≤Ñ ${index + 1}:`, member.nickname || member.name);
                
                const memberElement = document.createElement('div');
                const status = getMemberStatus(member);
                const statusText = getStatusText(status);
                const roleIcon = getRoleIcon(member.role);
                const isNew = isNewMember(member);
                
                memberElement.className = `card-gradient p-4 rounded-xl cursor-pointer hover:shadow-soft transition-all duration-300 hover:scale-[1.02] ${member.isActive === false ? 'opacity-60' : ''}`;
                
                const newMemberText = getNewMemberText(member);
                
                memberElement.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="text-lg">${roleIcon}</span>
                                <span class="font-semibold text-primary-800">${member.nickname || member.name}</span>
                                ${newMemberText ? `<span class="bg-gradient-to-r from-pastel-mint to-pastel-green text-primary-700 text-xs px-2 py-1 rounded-lg font-medium">${newMemberText}</span>` : ''}
                            </div>
                            <div class="text-sm text-primary-600 font-medium">${member.name}</div>
                            <div class="text-xs text-primary-500">${member.phone || 'Ïó∞ÎùΩÏ≤ò ÏóÜÏùå'}</div>
                        </div>
                        <div class="status-tag status-${status} ml-2">${statusText}</div>
                    </div>
                `;
                
                memberElement.addEventListener('click', () => openMemberModal(member));
                memberList.appendChild(memberElement);
            });
            
            // ÌïÑÌÑ∞ Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏
            updateFilterResults(members.length, filteredMembers.length);
            
            console.log('Î©§Î≤Ñ Î™©Î°ù Î†åÎçîÎßÅ ÏôÑÎ£å');
        }

        // Í≥†Í∏â ÌïÑÌÑ∞ÎßÅ Ï†ÅÏö© Ìï®Ïàò
        function applyAdvancedFilters(membersList) {
            let filtered = [...membersList];
            
            // Í≤ÄÏÉâ ÌïÑÌÑ∞
            const searchTerm = document.getElementById('memberSearch')?.value.toLowerCase().trim();
            if (searchTerm) {
                filtered = filtered.filter(member => 
                    (member.name && member.name.toLowerCase().includes(searchTerm)) ||
                    (member.nickname && member.nickname.toLowerCase().includes(searchTerm))
                );
            }
            
            // ÏÉÅÌÉú ÌïÑÌÑ∞
            const statusFilter = document.getElementById('statusFilter')?.value;
            if (statusFilter && statusFilter !== 'all') {
                filtered = filtered.filter(member => getMemberStatus(member) === statusFilter);
            }
            
            // Ïó≠Ìï† ÌïÑÌÑ∞
            const roleFilter = document.getElementById('roleFilter')?.value;
            if (roleFilter && roleFilter !== 'all') {
                filtered = filtered.filter(member => member.role === roleFilter);
            }
            
            // Í∏∞Í∞Ñ ÌïÑÌÑ∞ (ÌôúÎèô Í∏∞Î∞ò)
            const periodFilter = document.getElementById('periodFilter')?.value;
            if (periodFilter && periodFilter !== 'all') {
                filtered = applyPeriodFilter(filtered, periodFilter);
            }
            
            // Ï†ïÎ†¨ Ï†ÅÏö©
            const sortFilter = document.getElementById('sortFilter')?.value;
            if (sortFilter && sortFilter !== 'default') {
                filtered = applySorting(filtered, sortFilter);
            }
            
            return filtered;
        }

        // Í∏∞Í∞Ñ ÌïÑÌÑ∞ Ï†ÅÏö©
        function applyPeriodFilter(membersList, period) {
            const now = new Date();
            let startDate, endDate;
            
            switch (period) {
                case 'thisWeek':
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - now.getDay());
                    endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + 6);
                    break;
                case 'thisMonth':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                    break;
                case 'lastWeek':
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - now.getDay() - 7);
                    endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + 6);
                    break;
                case 'lastMonth':
                    startDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                    endDate = new Date(now.getFullYear(), now.getMonth(), 0);
                    break;
                default:
                    return membersList;
            }
            
            return membersList.filter(member => {
                const activityCount = countMemberActivity(member.id, startDate, endDate, 'workout') + 
                                   countMemberActivity(member.id, startDate, endDate, 'meeting');
                return activityCount > 0;
            });
        }

        // Ï†ïÎ†¨ Ï†ÅÏö©
        function applySorting(membersList, sortType) {
            const sorted = [...membersList];
            
            switch (sortType) {
                case 'name':
                    return sorted.sort((a, b) => (a.name || '').localeCompare(b.name || ''));
                case 'joinDate':
                    return sorted.sort((a, b) => {
                        const dateA = a.joinDate ? new Date(a.joinDate) : new Date(0);
                        const dateB = b.joinDate ? new Date(b.joinDate) : new Date(0);
                        return dateB - dateA; // ÏµúÏã†Ïàú
                    });
                case 'activity':
                    return sorted.sort((a, b) => {
                        const activityA = countMemberActivity(a.id, new Date(2024, 0, 1), new Date(), 'workout') + 
                                        countMemberActivity(a.id, new Date(2024, 0, 1), new Date(), 'meeting');
                        const activityB = countMemberActivity(b.id, new Date(2024, 0, 1), new Date(), 'workout') + 
                                        countMemberActivity(b.id, new Date(2024, 0, 1), new Date(), 'meeting');
                        return activityB - activityA; // ÌôúÎèô ÎßéÏùÄ Ïàú
                    });
                case 'status':
                    const statusOrder = { 'removal': 0, 'monthly-warning': 1, 'weekly-warning': 2, 'active': 3, 'inactive': 4 };
                    return sorted.sort((a, b) => {
                        const statusA = getMemberStatus(a);
                        const statusB = getMemberStatus(b);
                        return statusOrder[statusA] - statusOrder[statusB];
                    });
                default:
                    return sorted;
            }
        }

        // Îπ†Î•∏ ÌïÑÌÑ∞ Ï†ÅÏö©
        function applyQuickFilter(type) {
            // Î™®Îì† ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
            clearAllFilters();
            
            switch (type) {
                case 'new':
                    // Ïã†Í∑ú Î©§Î≤ÑÎßå ÌëúÏãú
                    document.getElementById('memberSearch').value = '';
                    // Í∞ÄÏûÖÏùº Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÎ†¨ÌïòÍ≥† Ïã†Í∑ú Î©§Î≤Ñ ÌïÑÌÑ∞ÎßÅÏùÄ Î†åÎçîÎßÅÏóêÏÑú Ï≤òÎ¶¨
                    document.getElementById('sortFilter').value = 'joinDate';
                    break;
                case 'today':
                    // Ïò§Îäò ÌôúÎèôÌïú Î©§Î≤ÑÎßå ÌëúÏãú
                    const today = formatDate(new Date());
                    const todayActivity = activities[today];
                    if (todayActivity) {
                        const activeIds = [...(todayActivity.workout || []), ...(todayActivity.meeting || [])];
                        // Í≤ÄÏÉâÏúºÎ°ú ÌïÑÌÑ∞ÎßÅ (ÏûÑÏãú Î∞©Î≤ï)
                        document.getElementById('periodFilter').value = 'thisWeek';
                    }
                    break;
                case 'attention':
                    // Ï£ºÏùòÍ∞Ä ÌïÑÏöîÌïú Î©§Î≤Ñ (Í≤ΩÍ≥†/Í∞ïÌá¥ ÎåÄÏÉÅ)
                    document.getElementById('statusFilter').value = 'weekly-warning';
                    break;
            }
            
            renderMemberList();
        }

        // Î™®Îì† ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
        function clearAllFilters() {
            document.getElementById('memberSearch').value = '';
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('roleFilter').value = 'all';
            document.getElementById('sortFilter').value = 'default';
            document.getElementById('periodFilter').value = 'all';
            renderMemberList();
        }

        // ÌïÑÌÑ∞ Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏
        function updateFilterResults(total, filtered) {
            document.getElementById('totalMembers').textContent = total;
            document.getElementById('filteredMembers').textContent = filtered;
        }

        // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Îû≠ÌÇπ ÌÉÄÏûÖ
        let currentRankingType = 'total';
        
        // Îû≠ÌÇπ ÌÉ≠ Ï†ÑÌôò
        function switchRankingTab(type) {
            currentRankingType = type;
            
            // ÌÉ≠ Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.ranking-tab, .ranking-tab-active').forEach(tab => {
                tab.className = 'ranking-tab flex-1 text-xs py-2 px-3 rounded-lg font-medium bg-white/30 text-primary-600 hover:bg-white/50';
            });
            
            const activeTab = type === 'total' ? 'totalRankingTab' : 
                             type === 'workout' ? 'workoutRankingTab' : 'meetingRankingTab';
            
            document.getElementById(activeTab).className = 'ranking-tab-active flex-1 text-xs py-2 px-3 rounded-lg font-medium bg-gradient-to-r from-pastel-blue to-pastel-mint text-primary-800';
            
            // Îû≠ÌÇπ Îã§Ïãú Î†åÎçîÎßÅ
            renderAttendanceRanking();
        }

        // Ï∂úÏÑù Îû≠ÌÇπ Î†åÎçîÎßÅ (ÏÉàÎ°úÏö¥ Í∏∞Îä•)
        function renderAttendanceRanking() {
            const rankingContainer = document.getElementById('attendanceRanking');
            const period = document.getElementById('rankingPeriod')?.value || 'week';
            
            if (!rankingContainer) return;
            
            const rankings = calculateAttendanceRanking(period, currentRankingType);
            
            rankingContainer.innerHTML = '';
            
            if (rankings.length === 0) {
                rankingContainer.innerHTML = `
                    <div class="text-center py-4 text-primary-500 text-xs">
                        üìä ÏïÑÏßÅ ÌôúÎèô Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§
                    </div>
                `;
                return;
            }
            
            rankings.forEach((member, index) => {
                const rankElement = document.createElement('div');
                const isTop3 = index < 3;
                const medalEmoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}`;
                
                rankElement.className = `${isTop3 ? 'bg-gradient-to-r from-pastel-yellow to-pastel-peach' : 'bg-white/30'} p-2 rounded-lg transition-all hover:shadow-soft`;
                
                // Îû≠ÌÇπ ÌÉÄÏûÖÏóê Îî∞Î•∏ Ï†ïÎ≥¥ ÌëúÏãú
                let detailInfo = '';
                let mainStat = '';
                let subStat = '';
                
                if (currentRankingType === 'total') {
                    detailInfo = `Ïö¥Îèô ${member.workoutCount}Ìöå | Î≤ô ${member.meetingCount}Ìöå`;
                    mainStat = `${member.totalActivities}Ìöå`;
                    subStat = `${member.rate}%`;
                } else if (currentRankingType === 'workout') {
                    detailInfo = `Ï¥ù Ïö¥Îèô Ï∞∏Ïó¨`;
                    mainStat = `${member.workoutCount}Ìöå`;
                    subStat = `${member.workoutRate || 0}%`;
                } else if (currentRankingType === 'meeting') {
                    detailInfo = `Ï¥ù Î≤ô Ï∞∏Ïó¨`;
                    mainStat = `${member.meetingCount}Ìöå`;
                    subStat = `${member.meetingRate || 0}%`;
                }
                
                rankElement.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-bold ${isTop3 ? 'text-primary-800' : 'text-primary-600'}">${medalEmoji}</span>
                            <div>
                                <div class="text-xs font-semibold text-primary-800">${member.name}</div>
                                <div class="text-xs text-primary-600">
                                    ${detailInfo}
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs font-bold text-primary-800">${mainStat}</div>
                            <div class="text-xs text-primary-600">${subStat}</div>
                        </div>
                    </div>
                `;
                
                // ÌÅ¥Î¶≠ Ïãú Ìï¥Îãπ Î©§Î≤Ñ Ï†ïÎ≥¥ ÌëúÏãú
                rankElement.addEventListener('click', () => {
                    const memberData = members.find(m => m.id === member.id);
                    if (memberData) {
                        openMemberModal(memberData);
                    }
                });
                
                rankingContainer.appendChild(rankElement);
            });
        }

        // Ï∂úÏÑù Îû≠ÌÇπ Í≥ÑÏÇ∞
        function calculateAttendanceRanking(period, rankingType = 'total') {
            const now = new Date();
            let startDate, endDate;
            
            switch (period) {
                case 'week':
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - now.getDay());
                    endDate = new Date(now);
                    break;
                case 'month':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now);
                    break;
                case 'all':
                default:
                    startDate = new Date(2024, 0, 1); // 2024ÎÖÑ 1Ïõî 1ÏùºÎ∂ÄÌÑ∞
                    endDate = new Date(now);
                    break;
            }
            
            const rankings = members
                .filter(member => member.isActive !== false)
                .map(member => {
                    const workoutCount = countMemberActivity(member.id, startDate, endDate, 'workout');
                    const meetingCount = countMemberActivity(member.id, startDate, endDate, 'meeting');
                    const totalActivities = workoutCount + meetingCount;
                    
                    // Í∏∞Í∞ÑÎ≥Ñ ÏµúÎåÄ Í∞ÄÎä• ÌôúÎèô Ïàò Í≥ÑÏÇ∞
                    const daysDiff = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
                    const maxPossibleActivities = period === 'week' ? 14 : // Ï£ºÍ∞Ñ: Ïö¥Îèô 7Ìöå + Î≤ô 7Ìöå
                                                 period === 'month' ? daysDiff * 2 : // ÏõîÍ∞Ñ: ÏùºÏàò * 2
                                                 daysDiff; // Ï†ÑÏ≤¥: ÏùºÏàò
                    
                    const rate = maxPossibleActivities > 0 ? 
                                Math.round((totalActivities / maxPossibleActivities) * 100) : 0;
                    
                    // Í∞úÎ≥Ñ ÌôúÎèô Ï∞∏Ïó¨Ïú® Í≥ÑÏÇ∞
                    const workoutRate = possibleDays > 0 ? Math.round((workoutCount / possibleDays) * 100) : 0;
                    const meetingRate = possibleDays > 0 ? Math.round((meetingCount / possibleDays) * 100) : 0;
                    
                    return {
                        id: member.id,
                        name: member.nickname || member.name,
                        workoutCount,
                        meetingCount,
                        totalActivities,
                        rate: Math.min(rate, 100), // 100% Ï¥àÍ≥º Î∞©ÏßÄ
                        workoutRate: Math.min(workoutRate, 100),
                        meetingRate: Math.min(meetingRate, 100)
                    };
                })
                .sort((a, b) => {
                    // Îû≠ÌÇπ ÌÉÄÏûÖÏóê Îî∞Î•∏ Ï†ïÎ†¨
                    if (rankingType === 'workout') {
                        // Ïö¥Îèô Îû≠ÌÇπ: Ïö¥Îèô ÌöüÏàòÎ°ú Ï†ïÎ†¨
                        if (b.workoutCount !== a.workoutCount) {
                            return b.workoutCount - a.workoutCount;
                        }
                        return b.workoutRate - a.workoutRate;
                    } else if (rankingType === 'meeting') {
                        // Î≤ô Îû≠ÌÇπ: Î≤ô ÌöüÏàòÎ°ú Ï†ïÎ†¨
                        if (b.meetingCount !== a.meetingCount) {
                            return b.meetingCount - a.meetingCount;
                        }
                        return b.meetingRate - a.meetingRate;
                    } else {
                        // Ï¢ÖÌï© Îû≠ÌÇπ: Ï¥ù ÌôúÎèô ÏàòÎ°ú 1Ï∞® Ï†ïÎ†¨, Ï∞∏Ïó¨Ïú®Î°ú 2Ï∞® Ï†ïÎ†¨
                        if (b.totalActivities !== a.totalActivities) {
                            return b.totalActivities - a.totalActivities;
                        }
                        return b.rate - a.rate;
                    }
                })
                .slice(0, 10); // ÏÉÅÏúÑ 10Î™ÖÎßå
            
            return rankings;
        }

        // Î™®Î∞îÏùº ÌÉ≠ Í∏∞Îä• ÏÑ§Ï†ï
        function setupMobileTabs() {
            const tabMain = document.getElementById('tabMain');
            const tabMembers = document.getElementById('tabMembers');
            const mainContent = document.getElementById('mainContent');
            const memberContent = document.getElementById('memberContent');
            
            if (!tabMain || !tabMembers || !mainContent || !memberContent) return;
            
            // Ï¥àÍ∏∞ ÏÉÅÌÉú ÏÑ§Ï†ï
            showMainTab();
            
            tabMain.addEventListener('click', showMainTab);
            tabMembers.addEventListener('click', showMembersTab);
            
            function showMainTab() {
                // ÌÉ≠ Ïä§ÌÉÄÏùº Î≥ÄÍ≤Ω
                tabMain.classList.add('tab-active');
                tabMain.classList.remove('text-primary-600');
                tabMembers.classList.remove('tab-active');
                tabMembers.classList.add('text-primary-600');
                
                // ÏΩòÌÖêÏ∏† ÌëúÏãú/Ïà®ÍπÄ
                if (window.innerWidth < 1024) {
                    mainContent.classList.remove('hidden');
                    mainContent.classList.add('block');
                    memberContent.classList.add('hidden');
                    memberContent.classList.remove('block');
                }
            }
            
            function showMembersTab() {
                // ÌÉ≠ Ïä§ÌÉÄÏùº Î≥ÄÍ≤Ω
                tabMembers.classList.add('tab-active');
                tabMembers.classList.remove('text-primary-600');
                tabMain.classList.remove('tab-active');
                tabMain.classList.add('text-primary-600');
                
                // ÏΩòÌÖêÏ∏† ÌëúÏãú/Ïà®ÍπÄ
                if (window.innerWidth < 1024) {
                    memberContent.classList.remove('hidden');
                    memberContent.classList.add('block');
                    mainContent.classList.add('hidden');
                    mainContent.classList.remove('block');
                }
            }
            
            // ÌôîÎ©¥ ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω Ïãú ÎåÄÏùë
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 1024) {
                    // Îç∞Ïä§ÌÅ¨ÌÜ±ÏóêÏÑúÎäî Î™®Îì† ÏΩòÌÖêÏ∏† ÌëúÏãú
                    mainContent.classList.remove('hidden');
                    mainContent.classList.add('block');
                    memberContent.classList.remove('hidden');
                    memberContent.classList.add('block');
                } else {
                    // Î™®Î∞îÏùºÏóêÏÑúÎäî ÌòÑÏû¨ ÌôúÏÑ± ÌÉ≠Îßå ÌëúÏãú
                    if (tabMain.classList.contains('tab-active')) {
                        showMainTab();
                    } else {
                        showMembersTab();
                    }
                }
            });
        }

        // ÌÑ∞Ïπò Ï†úÏä§Ï≤ò ÏßÄÏõê (Ïä§ÏôÄÏù¥ÌîÑ)
        function setupTouchGestures() {
            let startX = 0;
            let startY = 0;
            
            document.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            });
            
            document.addEventListener('touchend', (e) => {
                if (!startX || !startY) return;
                
                const endX = e.changedTouches[0].clientX;
                const endY = e.changedTouches[0].clientY;
                
                const diffX = startX - endX;
                const diffY = startY - endY;
                
                // ÏàòÌèâ Ïä§ÏôÄÏù¥ÌîÑÍ∞Ä ÏàòÏßÅ Ïä§ÏôÄÏù¥ÌîÑÎ≥¥Îã§ ÌÅ¥ ÎïåÎßå Ï≤òÎ¶¨
                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                    if (window.innerWidth < 1024) { // Î™®Î∞îÏùºÏóêÏÑúÎßå
                        if (diffX > 0) {
                            // ÏôºÏ™ΩÏúºÎ°ú Ïä§ÏôÄÏù¥ÌîÑ - Î©§Î≤Ñ ÌÉ≠ÏúºÎ°ú
                            document.getElementById('tabMembers')?.click();
                        } else {
                            // Ïò§Î•∏Ï™ΩÏúºÎ°ú Ïä§ÏôÄÏù¥ÌîÑ - Î©îÏù∏ ÌÉ≠ÏúºÎ°ú
                            document.getElementById('tabMain')?.click();
                        }
                    }
                }
                
                startX = 0;
                startY = 0;
            });
        }

        // Î™®Î∞îÏùº Î©îÎâ¥ ÏÑ§Ï†ï
        function setupMobileMenu() {
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (!mobileMenuBtn || !mobileMenu) return;
            
            // Î™®Î∞îÏùº Î©îÎâ¥ ÌÜ†Í∏Ä
            mobileMenuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            
            // Î™®Î∞îÏùº Î≤ÑÌäºÎì§ÏùÑ Îç∞Ïä§ÌÅ¨ÌÜ± Î≤ÑÌäºÎì§Í≥º Ïó∞Í≤∞
            document.getElementById('changePasswordBtnMobile')?.addEventListener('click', () => {
                document.getElementById('changePasswordBtn')?.click();
                mobileMenu.classList.add('hidden');
            });
            
            document.getElementById('exportBtnMobile')?.addEventListener('click', () => {
                document.getElementById('exportBtn')?.click();
                mobileMenu.classList.add('hidden');
            });
            
            document.getElementById('reportBtnMobile')?.addEventListener('click', () => {
                document.getElementById('reportBtn')?.click();
                mobileMenu.classList.add('hidden');
            });
            
            document.getElementById('logoutBtnMobile')?.addEventListener('click', () => {
                document.getElementById('logoutBtn')?.click();
                mobileMenu.classList.add('hidden');
            });
            
            // Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Î©îÎâ¥ Îã´Í∏∞
            document.addEventListener('click', (e) => {
                if (!mobileMenuBtn.contains(e.target) && !mobileMenu.contains(e.target)) {
                    mobileMenu.classList.add('hidden');
                }
            });
        }

        function getMemberStatus(member) {
            if (member.isActive === false) return 'inactive';
            
            const now = new Date();
            
            // ÌòÑÏû¨ Ï£ºÏùò ÏãúÏûëÏùºÍ≥º Ï¢ÖÎ£åÏùº Í≥ÑÏÇ∞ (ÏùºÏöîÏùº ÏãúÏûë)
            const startOfWeek = new Date(now);
            const day = startOfWeek.getDay();
            const diff = startOfWeek.getDate() - day;
            startOfWeek.setDate(diff);
            startOfWeek.setHours(0, 0, 0, 0);
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            endOfWeek.setHours(23, 59, 59, 999);
            
            // ÌòÑÏû¨ ÏõîÏùò ÏãúÏûëÏùºÍ≥º Ï¢ÖÎ£åÏùº Í≥ÑÏÇ∞
            const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
            const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            
            // ÏßÄÎÇúÏ£º Í≥ÑÏÇ∞ (ÌòÑÏû¨ Ï£ºÍ∞Ä Í∏àÏöîÏùº Ïù¥ÌõÑÏù∏ Í≤ΩÏö∞ Ï≤¥ÌÅ¨)
            const lastWeekStart = new Date(startOfWeek);
            lastWeekStart.setDate(lastWeekStart.getDate() - 7);
            const lastWeekEnd = new Date(endOfWeek);
            lastWeekEnd.setDate(lastWeekEnd.getDate() - 7);
            
            // ÏßÄÎÇúÎã¨ Í≥ÑÏÇ∞
            const lastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);
            const lastMonthEnd = new Date(now.getFullYear(), now.getMonth(), 0);
            
            // Î©§Î≤ÑÏùò ÌôúÎèô Ïπ¥Ïö¥Ìä∏ Í≥ÑÏÇ∞
            const currentWeekWorkouts = countMemberActivity(member.id, startOfWeek, endOfWeek, 'workout');
            const currentMonthMeetings = countMemberActivity(member.id, startOfMonth, endOfMonth, 'meeting');
            const lastWeekWorkouts = countMemberActivity(member.id, lastWeekStart, lastWeekEnd, 'workout');
            const lastMonthMeetings = countMemberActivity(member.id, lastMonth, lastMonthEnd, 'meeting');
            
            // ÏÉÅÌÉú Í≤∞Ï†ï Î°úÏßÅ
            const today = now.getDay(); // 0: ÏùºÏöîÏùº, 5: Í∏àÏöîÏùº
            const isAfterFriday = today >= 5; // Í∏àÏöîÏùº Ïù¥ÌõÑ
            const isAfter25th = now.getDate() >= 25; // 25Ïùº Ïù¥ÌõÑ
            
            // üî¥ Í∞ïÌá¥ÎåÄÏÉÅ: ÏßÄÎÇúÏ£º Ïö¥Îèô Í∑úÏπô ÎòêÎäî ÏßÄÎÇúÎã¨ Î≤ô Í∑úÏπô ÏµúÏ¢Ö ÎØ∏Îã¨
            if (lastWeekWorkouts < 2 || lastMonthMeetings < 1) {
                return 'removal';
            }
            
            // üü† ÏõîÍ∞ÑÍ≤ΩÍ≥†: Ìï¥Îãπ Ïõî 25Ïùº Ïù¥ÌõÑ ÏõîÍ∞Ñ Î≤ô 1Ìöå ÎØ∏Îã¨ Ïãú
            if (isAfter25th && currentMonthMeetings < 1) {
                return 'monthly-warning';
            }
            
            // üü° Ï£ºÍ∞ÑÍ≤ΩÍ≥†: Ìï¥Îãπ Ï£º Í∏àÏöîÏùº Ïù¥ÌõÑ Ï£ºÍ∞Ñ Ïö¥Îèô 2Ìöå ÎØ∏Îã¨ Ïãú
            if (isAfterFriday && currentWeekWorkouts < 2) {
                return 'weekly-warning';
            }
            
            // üü¢ ÌôúÎèôÏ§ë: Î™®Îì† Í∑úÏπô Ï§ÄÏàò
            return 'active';
        }
        
        // Î©§Î≤ÑÏùò ÌäπÏ†ï Í∏∞Í∞Ñ ÌôúÎèô Ïπ¥Ïö¥Ìä∏ Í≥ÑÏÇ∞ Ìï®Ïàò
        function countMemberActivity(memberId, startDate, endDate, activityType) {
            let count = 0;
            
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateStr = formatDate(d);
                const dayActivity = activities[dateStr];
                
                if (dayActivity && dayActivity[activityType] && dayActivity[activityType].includes(memberId)) {
                    count++;
                }
            }
            
            return count;
        }

        function getStatusText(status) {
            const statusMap = {
                'active': 'üü¢ ÌôúÎèôÏ§ë',
                'weekly-warning': 'üü° Ï£ºÍ∞ÑÍ≤ΩÍ≥†',
                'monthly-warning': 'üü† ÏõîÍ∞ÑÍ≤ΩÍ≥†',
                'removal': 'üî¥ Í∞ïÌá¥ÎåÄÏÉÅ',
                'inactive': '‚ö´ ÎπÑÌôúÏÑ±'
            };
            return statusMap[status] || 'üü¢ ÌôúÎèôÏ§ë';
        }

        function getRoleIcon(role) {
            switch (role) {
                case 'super_admin': return 'üëë';
                case 'admin': return '‚≠ê';
                default: return '';
            }
        }

        function isNewMember(member) {
            if (!member.joinDate) return false;
            
            // Ï≤´ Î≤ô Ï∞∏Ïó¨ Ïó¨Î∂Ä ÌôïÏù∏
            const hasFirstMeeting = hasParticipatedInMeeting(member.id);
            if (hasFirstMeeting) return false;
            
            // Í∞ÄÏûÖÏùºÎ°úÎ∂ÄÌÑ∞ 30Ïùº Ïù¥ÎÇ¥Ïù∏ÏßÄ ÌôïÏù∏
            const joinDate = new Date(member.joinDate);
            const now = new Date();
            const diffTime = Math.abs(now - joinDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays <= 30;
        }
        
        // Î©§Î≤ÑÍ∞Ä Î≤ôÏóê Ï∞∏Ïó¨Ìïú Ï†ÅÏù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
        function hasParticipatedInMeeting(memberId) {
            for (const dateStr in activities) {
                const dayActivity = activities[dateStr];
                if (dayActivity && dayActivity.meeting && dayActivity.meeting.includes(memberId)) {
                    return true;
                }
            }
            return false;
        }
        
        // Ïã†Í∑ú Î©§Î≤Ñ ÌëúÏãú ÌÖçÏä§Ìä∏ ÏÉùÏÑ±
        function getNewMemberText(member) {
            if (!isNewMember(member)) return '';
            
            const joinDate = new Date(member.joinDate);
            const formattedDate = `${joinDate.getMonth() + 1}/${joinDate.getDate()}`;
            return `üå± Ïã†Í∑ú (${formattedDate})`;
        }

        // Î™®Îã¨ Í¥ÄÎ†® Ìï®ÏàòÎì§
        function openNoticeModal() {
            document.getElementById('noticeModal').classList.add('active');
        }

        function closeNoticeModal() {
            document.getElementById('noticeModal').classList.remove('active');
        }

        async function saveNotice(e) {
            e.preventDefault();
            const category = document.getElementById('noticeCategory').value;
            const content = document.getElementById('noticeText').value;
            
            try {
                const noticeData = {
                    category: category,
                    content: content,
                    updatedAt: new Date().toISOString(),
                    updatedBy: currentUser.id
                };
                
                if (db) {
                    await db.collection('v2_config').doc('notice').set(noticeData);
                } else {
                    // Î°úÏª¨ Î™®Îìú: Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
                    localStorage.setItem('localNotice', JSON.stringify(noticeData));
                }
                
                updateNoticeDisplay(category, content);
                closeNoticeModal();
            } catch (error) {
                console.error('Í≥µÏßÄÏÇ¨Ìï≠ Ï†ÄÏû• Ïò§Î•ò:', error);
                alert('Í≥µÏßÄÏÇ¨Ìï≠ Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        function updateNoticeDisplay(category, content) {
            const noticeContent = document.getElementById('noticeContent');
            noticeContent.innerHTML = `
                <div class="bg-blue-50 border-l-4 border-blue-400 p-4">
                    <div class="flex">
                        <div class="ml-3">
                            <p class="text-sm text-blue-700">
                                <span class="font-medium">[${category}]</span> ${content}
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function openMemberModal(member = null) {
            const modal = document.getElementById('memberModal');
            const title = document.getElementById('memberModalTitle');
            const deleteBtn = document.getElementById('deleteMember');
            
            if (member) {
                title.textContent = 'Î©§Î≤Ñ ÏàòÏ†ï';
                document.getElementById('memberNickname').value = member.nickname || '';
                document.getElementById('memberName').value = member.name || '';
                document.getElementById('memberPhone').value = member.phone || '';
                document.getElementById('memberRole').value = member.role || 'member';
                document.getElementById('memberInactive').checked = member.isActive === false;
                deleteBtn.classList.remove('hidden');
                editingMemberId = member.id;
            } else {
                title.textContent = 'Î©§Î≤Ñ Ï∂îÍ∞Ä';
                document.getElementById('memberForm').reset();
                deleteBtn.classList.add('hidden');
                editingMemberId = null;
            }
            
            modal.classList.add('active');
        }

        function closeMemberModal() {
            document.getElementById('memberModal').classList.remove('active');
            editingMemberId = null;
        }

        async function saveMember(e) {
            e.preventDefault();
            const nickname = document.getElementById('memberNickname').value;
            const name = document.getElementById('memberName').value;
            const phone = document.getElementById('memberPhone').value;
            const role = document.getElementById('memberRole').value;
            const isActive = !document.getElementById('memberInactive').checked;
            
            // Í∏∞Ï°¥ Î©§Î≤Ñ Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ (Ïó≠Ìï† Î≥ÄÍ≤Ω Í∞êÏßÄÏö©)
            const existingMember = editingMemberId ? members.find(m => m.id === editingMemberId) : null;
            const wasAdmin = existingMember && existingMember.role === 'admin';
            const isNowAdmin = role === 'admin';
            
            const memberData = {
                nickname: nickname,
                name: name,
                phone: phone,
                role: role,
                isActive: isActive,
                updatedAt: new Date().toISOString(),
                updatedBy: currentUser.id
            };
            
            if (!editingMemberId) {
                memberData.joinDate = new Date().toISOString();
            }
            
            // Î∂ÄÎ∞©Ïû•(admin)ÏúºÎ°ú ÏÑ§Ï†ïÎê† Îïå Í≥ÑÏ†ï Ï†ïÎ≥¥ Ï∂îÍ∞Ä
            if (isNowAdmin && !wasAdmin) {
                const accountInfo = await createSubAdminAccount(nickname, name);
                memberData.loginId = accountInfo.loginId;
                memberData.password = accountInfo.password;
                memberData.accountCreated = true;
                memberData.accountCreatedAt = new Date().toISOString();
            }
            
            // Î∂ÄÎ∞©Ïû•ÏóêÏÑú ÏùºÎ∞ò Î©§Î≤ÑÎ°ú Î≥ÄÍ≤ΩÎê† Îïå Í≥ÑÏ†ï Ï†ïÎ≥¥ Ï†úÍ±∞
            if (!isNowAdmin && wasAdmin) {
                memberData.loginId = null;
                memberData.password = null;
                memberData.accountCreated = false;
                memberData.accountRemovedAt = new Date().toISOString();
            }
            
            try {
                const memberId = editingMemberId || `member_${Date.now()}`;
                
                if (db) {
                    await db.collection('v2_members').doc(memberId).set(memberData, { merge: true });
                } else {
                    // Î°úÏª¨ Î™®Îìú: Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
                    const existingIndex = members.findIndex(m => m.id === memberId);
                    if (existingIndex >= 0) {
                        members[existingIndex] = { id: memberId, ...memberData };
                    } else {
                        members.push({ id: memberId, ...memberData });
                    }
                    localStorage.setItem('localMembers', JSON.stringify(members));
                }
                
                // Í≥ÑÏ†ï ÏÉùÏÑ±/ÏÇ≠Ï†ú ÏïåÎ¶º
                if (isNowAdmin && !wasAdmin) {
                    showAccountCreatedNotification(memberData.loginId, memberData.password, name);
                } else if (!isNowAdmin && wasAdmin) {
                    showMessage(`${name}ÎãòÏùò Î∂ÄÎ∞©Ïû• Í≥ÑÏ†ïÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`, 'info');
                }
                
                await loadMembers();
                renderMemberList();
                closeMemberModal();
            } catch (error) {
                console.error('Î©§Î≤Ñ Ï†ÄÏû• Ïò§Î•ò:', error);
                alert('Î©§Î≤Ñ Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        async function deleteMemberConfirm() {
            if (!editingMemberId) return;
            
            if (confirm('Ï†ïÎßêÎ°ú Ïù¥ Î©§Î≤ÑÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                try {
                    if (db) {
                        await db.collection('v2_members').doc(editingMemberId).delete();
                    } else {
                        // Î°úÏª¨ Î™®Îìú: Î∞∞Ïó¥ÏóêÏÑú Ï†úÍ±∞
                        members = members.filter(m => m.id !== editingMemberId);
                        localStorage.setItem('localMembers', JSON.stringify(members));
                    }
                    await loadMembers();
                    renderMemberList();
                    closeMemberModal();
                } catch (error) {
                    console.error('Î©§Î≤Ñ ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                    alert('Î©§Î≤Ñ ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }
        }

        function openActivityModal(dateStr) {
            const modal = document.getElementById('activityModal');
            const title = document.getElementById('activityModalTitle');
            const memberList = document.getElementById('activityMemberList');
            
            title.textContent = `${dateStr} ÌôúÎèô Í∏∞Î°ù`;
            
            memberList.innerHTML = '';
            const activeMembers = members.filter(m => m.isActive !== false);
            
            activeMembers.forEach(member => {
                const memberDiv = document.createElement('div');
                memberDiv.className = 'card-gradient p-4 rounded-xl border border-white/20';
                
                const currentActivity = activities[dateStr] || {};
                const hasWorkout = currentActivity.workout && currentActivity.workout.includes(member.id);
                const hasMeeting = currentActivity.meeting && currentActivity.meeting.includes(member.id);
                const hasWorkoutVote = currentActivity.workoutVote && currentActivity.workoutVote.includes(member.id);
                const hasMeetingVote = currentActivity.meetingVote && currentActivity.meetingVote.includes(member.id);
                
                const roleIcon = getRoleIcon(member.role);
                
                memberDiv.innerHTML = `
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <span class="text-lg">${roleIcon}</span>
                                <span class="font-semibold text-primary-800">${member.nickname || member.name}</span>
                            </div>
                        </div>
                        
                        <!-- ÌôúÎèô Ï∞∏Ïó¨ -->
                        <div class="bg-white/30 p-2 rounded-lg">
                            <div class="text-xs font-bold text-primary-700 mb-2">‚úÖ ÌôúÎèô Ï∞∏Ïó¨</div>
                            <div class="flex space-x-3">
                                <label class="flex items-center space-x-1 cursor-pointer">
                                    <input type="checkbox" name="workout" value="${member.id}" ${hasWorkout ? 'checked' : ''} class="w-3 h-3 text-primary-600 rounded workout-checkbox">
                                    <span class="text-xs font-medium text-primary-700 bg-pastel-blue px-2 py-1 rounded">üí™ Ïö¥Îèô</span>
                                </label>
                                <label class="flex items-center space-x-1 cursor-pointer">
                                    <input type="checkbox" name="meeting" value="${member.id}" ${hasMeeting ? 'checked' : ''} class="w-3 h-3 text-primary-600 rounded meeting-checkbox">
                                    <span class="text-xs font-medium text-primary-700 bg-pastel-green px-2 py-1 rounded">üçª Î≤ô</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Ìà¨Ìëú Ï∞∏Ïó¨ -->
                        <div class="bg-white/30 p-2 rounded-lg">
                            <div class="text-xs font-bold text-primary-700 mb-2">üó≥Ô∏è Ìà¨Ìëú Ï∞∏Ïó¨</div>
                            <div class="flex space-x-3">
                                <label class="flex items-center space-x-1 cursor-pointer">
                                    <input type="checkbox" name="workoutVote" value="${member.id}" ${hasWorkoutVote ? 'checked' : ''} class="w-3 h-3 text-purple-600 rounded workout-vote-checkbox">
                                    <span class="text-xs font-medium text-primary-700 bg-pastel-purple px-2 py-1 rounded">üó≥Ô∏è Ïö¥ÎèôÌà¨Ìëú</span>
                                </label>
                                <label class="flex items-center space-x-1 cursor-pointer">
                                    <input type="checkbox" name="meetingVote" value="${member.id}" ${hasMeetingVote ? 'checked' : ''} class="w-3 h-3 text-purple-600 rounded meeting-vote-checkbox">
                                    <span class="text-xs font-medium text-primary-700 bg-pastel-coral px-2 py-1 rounded">üó≥Ô∏è Î≤ôÌà¨Ìëú</span>
                                </label>
                            </div>
                        </div>
                    </div>
                `;
                
                memberList.appendChild(memberDiv);
            });
            
            // Îπ†Î•∏ Ïï°ÏÖò Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
            setupQuickActionButtons();
            
            // Ï≤¥ÌÅ¨Î∞ïÏä§ Î≥ÄÍ≤Ω Ïãú Ïπ¥Ïö¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            setupCheckboxListeners();
            
            // ÎÇ†Ïßú ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
            document.getElementById('activityDate').value = dateStr;
            
            // Ï¥àÍ∏∞ Ïπ¥Ïö¥Ìä∏ Î∞è Ï∞∏Ïó¨Ïú® ÏóÖÎç∞Ïù¥Ìä∏
            updateActivityCounts();
            updateAttendanceRates();
            
            modal.dataset.date = dateStr;
            modal.classList.add('active');
        }
        
        // Îπ†Î•∏ Ïï°ÏÖò Î≤ÑÌäº ÏÑ§Ï†ï (ÌôïÏû•)
        function setupQuickActionButtons() {
            // Í∏∞Ï°¥ Í∏∞Î≥∏ Í∏∞Îä•Îì§
            document.getElementById('selectAllWorkout').onclick = () => {
                document.querySelectorAll('.workout-checkbox').forEach(cb => {
                    cb.checked = true;
                });
                updateActivityCounts();
                updateAttendanceRates();
            };
            
            document.getElementById('clearAllWorkout').onclick = () => {
                document.querySelectorAll('.workout-checkbox').forEach(cb => {
                    cb.checked = false;
                });
                updateActivityCounts();
                updateAttendanceRates();
            };
            
            document.getElementById('selectAllMeeting').onclick = () => {
                document.querySelectorAll('.meeting-checkbox').forEach(cb => {
                    cb.checked = true;
                });
                updateActivityCounts();
                updateAttendanceRates();
            };
            
            document.getElementById('clearAllMeeting').onclick = () => {
                document.querySelectorAll('.meeting-checkbox').forEach(cb => {
                    cb.checked = false;
                });
                updateActivityCounts();
                updateAttendanceRates();
            };
            
            document.getElementById('autoSelectLastWeek').onclick = () => {
                autoSelectLastWeekParticipants();
            };

            // ÏÉàÎ°úÏö¥ Í≥†Í∏â Í∏∞Îä•Îì§
            document.getElementById('selectHighAttendance').onclick = () => {
                selectByAttendanceRate('high');
            };
            
            document.getElementById('selectNeedMotivation').onclick = () => {
                selectByAttendanceRate('low');
            };
            
            document.getElementById('copyToWeek').onclick = () => {
                copyToWeekSchedule();
            };
            
            document.getElementById('scheduleReminder').onclick = () => {
                scheduleAttendanceReminder();
            };

            // ÎÇ†Ïßú Î≥ÄÍ≤Ω Ïãú Ï≤òÎ¶¨
            document.getElementById('activityDate').onchange = (e) => {
                updateModalForDate(e.target.value);
            };
        }
        
        // Ï≤¥ÌÅ¨Î∞ïÏä§ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        function setupCheckboxListeners() {
            document.querySelectorAll('.workout-checkbox, .meeting-checkbox, .workout-vote-checkbox, .meeting-vote-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    updateActivityCounts();
                    updateAttendanceRates();
                });
            });
        }
        
        // ÌôúÎèô Ïπ¥Ïö¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateActivityCounts() {
            const workoutCount = document.querySelectorAll('.workout-checkbox:checked').length;
            const meetingCount = document.querySelectorAll('.meeting-checkbox:checked').length;
            const workoutVoteCount = document.querySelectorAll('.workout-vote-checkbox:checked').length;
            const meetingVoteCount = document.querySelectorAll('.meeting-vote-checkbox:checked').length;
            
            document.getElementById('workoutCount').textContent = workoutCount;
            document.getElementById('meetingCount').textContent = meetingCount;
            document.getElementById('workoutVoteCount').textContent = workoutVoteCount;
            document.getElementById('meetingVoteCount').textContent = meetingVoteCount;
        }

        // Ï∞∏Ïó¨Ïú® ÏóÖÎç∞Ïù¥Ìä∏ (ÏÉàÎ°úÏö¥ Í∏∞Îä•)
        function updateAttendanceRates() {
            const totalMembers = document.querySelectorAll('.workout-checkbox').length;
            const workoutCount = document.querySelectorAll('.workout-checkbox:checked').length;
            const meetingCount = document.querySelectorAll('.meeting-checkbox:checked').length;
            const totalParticipants = new Set([
                ...Array.from(document.querySelectorAll('.workout-checkbox:checked')).map(cb => cb.value),
                ...Array.from(document.querySelectorAll('.meeting-checkbox:checked')).map(cb => cb.value)
            ]).size;
            
            if (totalMembers > 0) {
                const attendanceRate = Math.round((totalParticipants / totalMembers) * 100);
                const workoutRate = Math.round((workoutCount / totalMembers) * 100);
                const meetingRate = Math.round((meetingCount / totalMembers) * 100);
                
                document.getElementById('attendanceRate').textContent = `${attendanceRate}%`;
                document.getElementById('workoutRate').textContent = `${workoutRate}%`;
                document.getElementById('meetingRate').textContent = `${meetingRate}%`;
            }
        }

        // Ï∞∏Ïó¨Ïú® Í∏∞Ï§Ä ÏÑ†ÌÉù (ÏÉàÎ°úÏö¥ Í∏∞Îä•)
        function selectByAttendanceRate(type) {
            const memberAttendanceRates = calculateMemberAttendanceRates();
            
            if (type === 'high') {
                // Ï∞∏Ïó¨Ïú® ÏÉÅÏúÑ 70% Î©§Î≤ÑÎì§ ÏÑ†ÌÉù
                const highAttendanceMembers = memberAttendanceRates
                    .filter(m => m.rate >= 70)
                    .map(m => m.id);
                
                selectMembersByIds(highAttendanceMembers);
                showMessage('üèÜ Í≥†Ï∞∏Ïó¨ÏûêÎì§Ïù¥ ÏÑ†ÌÉùÎêòÏóàÏäµÎãàÎã§!', 'success');
            } else {
                // Ï∞∏Ïó¨Ïú® ÌïòÏúÑ 50% Î©§Î≤ÑÎì§ ÏÑ†ÌÉù (ÎèôÍ∏∞Î∂ÄÏó¨ ÌïÑÏöî)
                const lowAttendanceMembers = memberAttendanceRates
                    .filter(m => m.rate < 50)
                    .map(m => m.id);
                
                selectMembersByIds(lowAttendanceMembers);
                showMessage('üéØ ÎèôÍ∏∞Î∂ÄÏó¨Í∞Ä ÌïÑÏöîÌïú Î©§Î≤ÑÎì§Ïù¥ ÏÑ†ÌÉùÎêòÏóàÏäµÎãàÎã§!', 'warning');
            }
        }

        // Î©§Î≤ÑÎ≥Ñ Ï∞∏Ïó¨Ïú® Í≥ÑÏÇ∞
        function calculateMemberAttendanceRates() {
            const now = new Date();
            const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
            
            return members.filter(m => m.isActive !== false).map(member => {
                const workoutCount = countMemberActivity(member.id, thirtyDaysAgo, now, 'workout');
                const meetingCount = countMemberActivity(member.id, thirtyDaysAgo, now, 'meeting');
                const totalActivities = workoutCount + meetingCount;
                const maxPossibleActivities = 30; // 30ÏùºÍ∞Ñ ÏµúÎåÄ Í∞ÄÎä• ÌôúÎèô
                const rate = Math.round((totalActivities / maxPossibleActivities) * 100);
                
                return {
                    id: member.id,
                    name: member.nickname || member.name,
                    rate: rate,
                    workoutCount,
                    meetingCount
                };
            }).sort((a, b) => b.rate - a.rate);
        }

        // ID Í∏∞Ï§Ä Î©§Î≤Ñ ÏÑ†ÌÉù
        function selectMembersByIds(memberIds) {
            // Î™®Îì† Ï≤¥ÌÅ¨Î∞ïÏä§ Ìï¥Ï†ú
            document.querySelectorAll('.workout-checkbox, .meeting-checkbox').forEach(cb => {
                cb.checked = false;
            });
            
            // ÏÑ†ÌÉùÎêú Î©§Î≤ÑÎì§Îßå Ï≤¥ÌÅ¨
            memberIds.forEach(memberId => {
                const workoutCheckbox = document.querySelector(`.workout-checkbox[value="${memberId}"]`);
                const meetingCheckbox = document.querySelector(`.meeting-checkbox[value="${memberId}"]`);
                
                if (workoutCheckbox) workoutCheckbox.checked = true;
                if (meetingCheckbox) meetingCheckbox.checked = true;
            });
            
            updateActivityCounts();
            updateAttendanceRates();
        }

        // Ïù¥Î≤àÏ£º Ï†ÑÏ≤¥ Î≥µÏÇ¨ (ÏÉàÎ°úÏö¥ Í∏∞Îä•)
        function copyToWeekSchedule() {
            const modal = document.getElementById('activityModal');
            const currentDateStr = modal.dataset.date;
            const currentDate = new Date(currentDateStr);
            
            // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Î©§Î≤ÑÎì§ Í∞ÄÏ†∏Ïò§Í∏∞
            const selectedWorkout = Array.from(document.querySelectorAll('.workout-checkbox:checked')).map(cb => cb.value);
            const selectedMeeting = Array.from(document.querySelectorAll('.meeting-checkbox:checked')).map(cb => cb.value);
            
            if (selectedWorkout.length === 0 && selectedMeeting.length === 0) {
                showMessage('‚ùå Î®ºÏ†Ä Î≥µÏÇ¨Ìï† Î©§Î≤ÑÎì§ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!', 'error');
                return;
            }
            
            if (confirm('Ïù¥Î≤àÏ£º Ï†ÑÏ≤¥Ïóê ÌòÑÏû¨ ÏÑ†ÌÉùÏùÑ Î≥µÏÇ¨ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                const promises = [];
                
                // Ïù¥Î≤àÏ£º 7ÏùºÍ∞Ñ Î≥µÏÇ¨
                for (let i = 0; i < 7; i++) {
                    const targetDate = new Date(currentDate);
                    targetDate.setDate(currentDate.getDate() - currentDate.getDay() + i);
                    const targetDateStr = formatDate(targetDate);
                    
                    const activityData = {
                        date: targetDateStr,
                        workout: selectedWorkout,
                        meeting: selectedMeeting,
                        updatedAt: new Date().toISOString(),
                        updatedBy: currentUser.id,
                        copiedFrom: currentDateStr
                    };
                    
                    activities[targetDateStr] = activityData;
                    
                    if (db) {
                        promises.push(db.collection('v2_activities').doc(targetDateStr).set(activityData));
                    }
                }
                
                Promise.all(promises).then(() => {
                    renderCalendar();
                    renderWeeklyDashboard();
                    renderMonthlyReport();
                    showMessage('üìÖ Ïù¥Î≤àÏ£º Ï†ÑÏ≤¥Ïóê Î≥µÏÇ¨Í∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!', 'success');
                }).catch(error => {
                    console.error('Î≥µÏÇ¨ Ïò§Î•ò:', error);
                    showMessage('‚ùå Î≥µÏÇ¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
                });
                
                // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
                localStorage.setItem('localActivities', JSON.stringify(activities));
            }
        }

        // ÏïåÎ¶º ÏòàÏïΩ (ÏÉàÎ°úÏö¥ Í∏∞Îä•)
        function scheduleAttendanceReminder() {
            const modal = document.getElementById('activityModal');
            const currentDateStr = modal.dataset.date;
            
            // ÎØ∏Îã¨Ïûê Ï∞æÍ∏∞
            const underperformers = findUnderperformers();
            
            if (underperformers.length === 0) {
                showMessage('üéâ Î™®Îì† Î©§Î≤ÑÍ∞Ä Î™©ÌëúÎ•º Îã¨ÏÑ±ÌñàÏäµÎãàÎã§!', 'success');
                return;
            }
            
            // ÏïåÎ¶º Î©îÏãúÏßÄ ÏÉùÏÑ±
            const reminderMessage = `üì¢ Ïö¥Îèô Ï∞∏Ïó¨ ÏïåÎ¶º\n\nÎã§Ïùå Î©§Î≤ÑÎì§Ïùò Ï∞∏Ïó¨Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§:\n${underperformers.map(m => `‚Ä¢ ${m.name} (${m.reason})`).join('\n')}\n\nÎÇ†Ïßú: ${currentDateStr}`;
            
            // Î∏åÎùºÏö∞Ï†Ä ÏïåÎ¶º Í∂åÌïú ÏöîÏ≤≠
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        // 1ÏãúÍ∞Ñ ÌõÑ ÏïåÎ¶º ÏòàÏïΩ (Ïã§Ï†úÎ°úÎäî ÏÑúÎ≤Ñ ÌïÑÏöî, Ïó¨Í∏∞ÏÑúÎäî ÏãúÏó∞Ïö©)
                        setTimeout(() => {
                            new Notification('Ïö¥Îèô Î∞© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú', {
                                body: `${underperformers.length}Î™ÖÏùò Î©§Î≤ÑÍ∞Ä Ï∞∏Ïó¨Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.`,
                                icon: 'üí™'
                            });
                        }, 5000); // 5Ï¥à ÌõÑ ÏãúÏó∞
                        
                        showMessage('üîî ÏïåÎ¶ºÏù¥ ÏòàÏïΩÎêòÏóàÏäµÎãàÎã§! (5Ï¥à ÌõÑ ÏãúÏó∞)', 'success');
                    }
                });
            }
            
            // ÏΩòÏÜîÏóêÎèÑ Ï∂úÎ†•
            console.log('ÏòàÏïΩÎêú ÏïåÎ¶º:', reminderMessage);
        }

        // ÎØ∏Îã¨Ïûê Ï∞æÍ∏∞
        function findUnderperformers() {
            const now = new Date();
            const thisWeekStart = new Date(now);
            thisWeekStart.setDate(now.getDate() - now.getDay());
            
            return members.filter(member => {
                if (member.isActive === false) return false;
                
                const workoutCount = countMemberActivity(member.id, thisWeekStart, now, 'workout');
                const meetingCount = countMemberActivity(member.id, new Date(now.getFullYear(), now.getMonth(), 1), now, 'meeting');
                
                const reasons = [];
                if (workoutCount < 2) reasons.push('Ï£ºÍ∞Ñ Ïö¥Îèô ÎØ∏Îã¨');
                if (meetingCount < 1) reasons.push('ÏõîÍ∞Ñ Î≤ô ÎØ∏Îã¨');
                
                if (reasons.length > 0) {
                    return {
                        id: member.id,
                        name: member.nickname || member.name,
                        reason: reasons.join(', ')
                    };
                }
                return false;
            }).filter(Boolean);
        }

        // ÎÇ†Ïßú Î≥ÄÍ≤Ω Ïãú Î™®Îã¨ ÏóÖÎç∞Ïù¥Ìä∏
        function updateModalForDate(dateStr) {
            const modal = document.getElementById('activityModal');
            modal.dataset.date = dateStr;
            
            // Ï†úÎ™© ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('activityModalTitle').textContent = `${dateStr} ÌôúÎèô Í∏∞Î°ù`;
            
            // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            const existingActivity = activities[dateStr] || {};
            
            // Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.workout-checkbox').forEach(cb => {
                cb.checked = existingActivity.workout && existingActivity.workout.includes(cb.value);
            });
            
            document.querySelectorAll('.meeting-checkbox').forEach(cb => {
                cb.checked = existingActivity.meeting && existingActivity.meeting.includes(cb.value);
            });
            
            updateActivityCounts();
            updateAttendanceRates();
        }

        // Î©îÏãúÏßÄ ÌëúÏãú Ïú†Ìã∏Î¶¨Ìã∞
        function showMessage(message, type = 'info') {
            // Í∞ÑÎã®Ìïú ÌÜ†Ïä§Ìä∏ Î©îÏãúÏßÄ (Ïã§Ï†úÎ°úÎäî Îçî ÏòàÏÅú UI Íµ¨ÌòÑ Í∞ÄÎä•)
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-xl shadow-soft-lg z-50 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'warning' ? 'bg-yellow-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            } text-white font-medium`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // ÏßÄÎÇúÏ£º Ï∞∏Ïó¨Ïûê ÏûêÎèô ÏÑ†ÌÉù
        function autoSelectLastWeekParticipants() {
            const modal = document.getElementById('activityModal');
            const currentDateStr = modal.dataset.date;
            const currentDate = new Date(currentDateStr);
            
            // ÏßÄÎÇúÏ£º Í∞ôÏùÄ ÏöîÏùº Í≥ÑÏÇ∞
            const lastWeekDate = new Date(currentDate);
            lastWeekDate.setDate(lastWeekDate.getDate() - 7);
            const lastWeekDateStr = formatDate(lastWeekDate);
            
            const lastWeekActivity = activities[lastWeekDateStr];
            
            if (lastWeekActivity) {
                // Ïö¥Îèô Ï∞∏Ïó¨Ïûê ÏÑ†ÌÉù
                if (lastWeekActivity.workout) {
                    lastWeekActivity.workout.forEach(memberId => {
                        const checkbox = document.querySelector(`.workout-checkbox[value="${memberId}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
                
                // Î≤ô Ï∞∏Ïó¨Ïûê ÏÑ†ÌÉù
                if (lastWeekActivity.meeting) {
                    lastWeekActivity.meeting.forEach(memberId => {
                        const checkbox = document.querySelector(`.meeting-checkbox[value="${memberId}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
                
                updateActivityCounts();
                
                // ÏÑ±Í≥µ Î©îÏãúÏßÄ
                const button = document.getElementById('autoSelectLastWeek');
                const originalText = button.textContent;
                button.textContent = '‚úÖ Ï†ÅÏö©ÏôÑÎ£å!';
                button.style.background = 'linear-gradient(to right, #10b981, #059669)';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
            } else {
                // Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå Î©îÏãúÏßÄ
                const button = document.getElementById('autoSelectLastWeek');
                const originalText = button.textContent;
                button.textContent = '‚ùå ÏßÄÎÇúÏ£º Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå';
                button.style.background = 'linear-gradient(to right, #f87171, #ef4444)';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
            }
        }

        function closeActivityModal() {
            document.getElementById('activityModal').classList.remove('active');
        }

        // ÌôúÎèô Í∏∞Î°ù Ï¥àÍ∏∞Ìôî
        function resetActivityRecord() {
            const modal = document.getElementById('activityModal');
            const dateStr = modal.dataset.date;
            
            if (!dateStr) return;
            
            if (confirm('‚ö†Ô∏è Ïù¥ ÎÇ†ÏßúÏùò Î™®Îì† ÌôúÎèô Í∏∞Î°ùÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏÇ≠Ï†úÎêú Îç∞Ïù¥ÌÑ∞Îäî Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.')) {
                try {
                    // Ìï¥Îãπ ÎÇ†ÏßúÏùò ÌôúÎèô Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
                    if (activities[dateStr]) {
                        delete activities[dateStr];
                    }
                    
                    // FirebaseÏóêÏÑú ÏÇ≠Ï†ú (Ïó∞Í≤∞Îêú Í≤ΩÏö∞)
                    if (db) {
                        db.collection('v2_activities').doc(dateStr).delete()
                            .then(() => {
                                console.log('FirebaseÏóêÏÑú ÌôúÎèô Í∏∞Î°ù ÏÇ≠Ï†ú ÏôÑÎ£å:', dateStr);
                            })
                            .catch(error => {
                                console.error('Firebase ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                            });
                    }
                    
                    // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
                    localStorage.setItem('localActivities', JSON.stringify(activities));
                    
                    // ÌôîÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏
                    renderCalendar();
                    renderWeeklyDashboard();
                    renderMonthlyReport();
                    renderMemberList(); // Î©§Î≤Ñ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                    renderAttendanceRanking(); // Îû≠ÌÇπ ÏóÖÎç∞Ïù¥Ìä∏
                    
                    // Î™®Îã¨ ÎÇ¥ Ï≤¥ÌÅ¨Î∞ïÏä§ Î™®Îëê Ìï¥Ï†ú
                    const checkboxes = modal.querySelectorAll('input[type="checkbox"]');
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    
                    // Ï∞∏Ïó¨Ïú® ÏóÖÎç∞Ïù¥Ìä∏
                    updateAttendanceRates();
                    
                    showMessage(`üóëÔ∏è ${dateStr} ÌôúÎèô Í∏∞Î°ùÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`, 'success');
                    
                } catch (error) {
                    console.error('ÌôúÎèô Í∏∞Î°ù ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                    showMessage('‚ùå ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
                }
            }
        }

        async function saveActivity(e) {
            e.preventDefault();
            const modal = document.getElementById('activityModal');
            const dateStr = modal.dataset.date;
            
            const workoutCheckboxes = modal.querySelectorAll('input[name="workout"]:checked');
            const meetingCheckboxes = modal.querySelectorAll('input[name="meeting"]:checked');
            const workoutVoteCheckboxes = modal.querySelectorAll('input[name="workoutVote"]:checked');
            const meetingVoteCheckboxes = modal.querySelectorAll('input[name="meetingVote"]:checked');
            
            const workoutMembers = Array.from(workoutCheckboxes).map(cb => cb.value);
            const meetingMembers = Array.from(meetingCheckboxes).map(cb => cb.value);
            const workoutVoteMembers = Array.from(workoutVoteCheckboxes).map(cb => cb.value);
            const meetingVoteMembers = Array.from(meetingVoteCheckboxes).map(cb => cb.value);
            
            const activityData = {
                date: dateStr,
                workout: workoutMembers,
                meeting: meetingMembers,
                workoutVote: workoutVoteMembers,
                meetingVote: meetingVoteMembers,
                updatedAt: new Date().toISOString(),
                updatedBy: currentUser.id
            };
            
            try {
                if (db) {
                    await db.collection('v2_activities').doc(dateStr).set(activityData);
                } else {
                    // Î°úÏª¨ Î™®Îìú: Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
                    localStorage.setItem('localActivities', JSON.stringify({...activities, [dateStr]: activityData}));
                }
                activities[dateStr] = activityData;
                renderCalendar();
                renderWeeklyDashboard();
                renderMonthlyReport();
                renderMemberList(); // Î©§Î≤Ñ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏Î•º ÏúÑÌï¥ Î™©Î°ù Îã§Ïãú Î†åÎçîÎßÅ
                closeActivityModal();
            } catch (error) {
                console.error('ÌôúÎèô Í∏∞Î°ù Ï†ÄÏû• Ïò§Î•ò:', error);
                alert('ÌôúÎèô Í∏∞Î°ù Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        function openReportModal() {
            const modal = document.getElementById('reportModal');
            generateReports();
            modal.classList.add('active');
        }

        function closeReportModal() {
            document.getElementById('reportModal').classList.remove('active');
        }

        function generateReports() {
            // Ï£ºÍ∞Ñ Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± (ÏòàÏãú)
            const weeklyReport = document.getElementById('weeklyReport');
            weeklyReport.innerHTML = '<p class="text-gray-600">ÏßÄÎÇúÏ£º Ïö¥Îèô Í∑úÏπô ÎØ∏Ï§ÄÏàòÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
            
            // ÏõîÍ∞Ñ Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± (ÏòàÏãú)
            const monthlyReport = document.getElementById('monthlyReport');
            monthlyReport.innerHTML = '<p class="text-gray-600">ÏßÄÎÇúÎã¨ Î≤ô Í∑úÏπô ÎØ∏Ï§ÄÏàòÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
        }

        // Ï£ºÍ∞Ñ ÎåÄÏãúÎ≥¥Îìú Î†åÎçîÎßÅ
        function renderWeeklyDashboard() {
            const currentWeekElement = document.getElementById('currentWeek');
            const weeklyWorkoutCount = document.getElementById('weeklyWorkoutCount');
            const weeklyMeetingCount = document.getElementById('weeklyMeetingCount');
            const weeklyUnderperformers = document.getElementById('weeklyUnderperformers');
            
            // ÌòÑÏû¨ Ï£ºÏùò ÏãúÏûëÏùºÍ≥º Ï¢ÖÎ£åÏùº Í≥ÑÏÇ∞ (ÏõîÏöîÏùº ÏãúÏûë)
            const startOfWeek = new Date(currentWeekDate);
            const day = startOfWeek.getDay();
            const diff = startOfWeek.getDate() - day + (day === 0 ? -6 : 1); // ÏõîÏöîÏùºÏùÑ Ï£ºÏùò ÏãúÏûëÏúºÎ°ú
            startOfWeek.setDate(diff);
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            // Ï£ºÍ∞Ñ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            const startStr = `${startOfWeek.getMonth() + 1}/${startOfWeek.getDate()}`;
            const endStr = `${endOfWeek.getMonth() + 1}/${endOfWeek.getDate()}`;
            currentWeekElement.textContent = `${startStr} - ${endStr}`;
            
            // Ìï¥Îãπ Ï£ºÏùò ÌôúÎèô Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            let totalWorkouts = 0;
            let totalMeetings = 0;
            const memberWorkoutCounts = {};
            const memberMeetingCounts = {};
            
            // Î©§Î≤ÑÎ≥Ñ Ïπ¥Ïö¥Ìä∏ Ï¥àÍ∏∞Ìôî
            members.forEach(member => {
                if (member.isActive !== false) {
                    memberWorkoutCounts[member.id] = 0;
                    memberMeetingCounts[member.id] = 0;
                }
            });
            
            // Ìï¥Îãπ Ï£ºÏùò Í∞Å ÎÇ†Ïßú ÌôïÏù∏
            for (let d = new Date(startOfWeek); d <= endOfWeek; d.setDate(d.getDate() + 1)) {
                const dateStr = formatDate(d);
                const dayActivity = activities[dateStr];
                
                if (dayActivity) {
                    if (dayActivity.workout) {
                        totalWorkouts += dayActivity.workout.length;
                        dayActivity.workout.forEach(memberId => {
                            if (memberWorkoutCounts[memberId] !== undefined) {
                                memberWorkoutCounts[memberId]++;
                            }
                        });
                    }
                    if (dayActivity.meeting) {
                        totalMeetings += dayActivity.meeting.length;
                        dayActivity.meeting.forEach(memberId => {
                            if (memberMeetingCounts[memberId] !== undefined) {
                                memberMeetingCounts[memberId]++;
                            }
                        });
                    }
                }
            }
            
            // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            weeklyWorkoutCount.textContent = `${totalWorkouts}Ìöå`;
            weeklyMeetingCount.textContent = `${totalMeetings}Ìöå`;
            
            // Ï£ºÍ∞Ñ Ïö¥Îèô ÎØ∏Îã¨Ïûê (2Ìöå ÎØ∏Îßå)
            const underperformers = [];
            Object.keys(memberWorkoutCounts).forEach(memberId => {
                if (memberWorkoutCounts[memberId] < 2) {
                    const member = members.find(m => m.id === memberId);
                    if (member) {
                        underperformers.push({
                            name: member.nickname || member.name,
                            count: memberWorkoutCounts[memberId]
                        });
                    }
                }
            });
            
            // ÎØ∏Îã¨Ïûê Î™©Î°ù ÌëúÏãú
            weeklyUnderperformers.innerHTML = '';
            if (underperformers.length === 0) {
                weeklyUnderperformers.innerHTML = '<div class="text-center py-6"><div class="text-4xl mb-2">üéâ</div><div class="text-sm font-medium text-primary-600">Î™®Îì† Î©§Î≤ÑÍ∞Ä Î™©ÌëúÎ•º Îã¨ÏÑ±ÌñàÏäµÎãàÎã§!</div></div>';
            } else {
                underperformers.forEach(member => {
                    const memberDiv = document.createElement('div');
                    memberDiv.className = 'bg-gradient-to-r from-pastel-yellow to-pastel-peach p-3 rounded-xl mb-2 shadow-sm border border-white/30';
                    memberDiv.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <span class="text-lg">‚ö†Ô∏è</span>
                                <span class="font-semibold text-primary-800">${member.name}</span>
                            </div>
                            <div class="bg-white/60 backdrop-blur-sm px-3 py-1 rounded-lg">
                                <span class="text-sm font-bold text-primary-700">${member.count}Ìöå</span>
                            </div>
                        </div>
                    `;
                    weeklyUnderperformers.appendChild(memberDiv);
                });
            }
        }
        
        // ÏõîÍ∞Ñ Î¶¨Ìè¨Ìä∏ Î†åÎçîÎßÅ
        function renderMonthlyReport() {
            const currentReportMonthElement = document.getElementById('currentReportMonth');
            const monthlyWorkoutCount = document.getElementById('monthlyWorkoutCount');
            const monthlyMeetingCount = document.getElementById('monthlyMeetingCount');
            const monthlyUnderperformers = document.getElementById('monthlyUnderperformers');
            
            // ÌòÑÏû¨ Ïõî ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            const monthStr = `${currentReportMonth.getFullYear()}ÎÖÑ ${currentReportMonth.getMonth() + 1}Ïõî`;
            currentReportMonthElement.textContent = monthStr;
            
            // Ìï¥Îãπ ÏõîÏùò Ï≤´ÎÇ†Í≥º ÎßàÏßÄÎßâÎÇ†
            const startOfMonth = new Date(currentReportMonth.getFullYear(), currentReportMonth.getMonth(), 1);
            const endOfMonth = new Date(currentReportMonth.getFullYear(), currentReportMonth.getMonth() + 1, 0);
            
            // Ìï¥Îãπ ÏõîÏùò ÌôúÎèô Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            let totalWorkouts = 0;
            let totalMeetings = 0;
            const memberWorkoutCounts = {};
            const memberMeetingCounts = {};
            
            // Î©§Î≤ÑÎ≥Ñ Ïπ¥Ïö¥Ìä∏ Ï¥àÍ∏∞Ìôî
            members.forEach(member => {
                if (member.isActive !== false) {
                    memberWorkoutCounts[member.id] = 0;
                    memberMeetingCounts[member.id] = 0;
                }
            });
            
            // Ìï¥Îãπ ÏõîÏùò Í∞Å ÎÇ†Ïßú ÌôïÏù∏
            for (let d = new Date(startOfMonth); d <= endOfMonth; d.setDate(d.getDate() + 1)) {
                const dateStr = formatDate(d);
                const dayActivity = activities[dateStr];
                
                if (dayActivity) {
                    if (dayActivity.workout) {
                        totalWorkouts += dayActivity.workout.length;
                        dayActivity.workout.forEach(memberId => {
                            if (memberWorkoutCounts[memberId] !== undefined) {
                                memberWorkoutCounts[memberId]++;
                            }
                        });
                    }
                    if (dayActivity.meeting) {
                        totalMeetings += dayActivity.meeting.length;
                        dayActivity.meeting.forEach(memberId => {
                            if (memberMeetingCounts[memberId] !== undefined) {
                                memberMeetingCounts[memberId]++;
                            }
                        });
                    }
                }
            }
            
            // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            monthlyWorkoutCount.textContent = `${totalWorkouts}Ìöå`;
            monthlyMeetingCount.textContent = `${totalMeetings}Ìöå`;
            
            // ÏõîÍ∞Ñ Î≤ô ÎØ∏Îã¨Ïûê (1Ìöå ÎØ∏Îßå)
            const underperformers = [];
            Object.keys(memberMeetingCounts).forEach(memberId => {
                if (memberMeetingCounts[memberId] < 1) {
                    const member = members.find(m => m.id === memberId);
                    if (member) {
                        underperformers.push({
                            name: member.nickname || member.name,
                            count: memberMeetingCounts[memberId]
                        });
                    }
                }
            });
            
            // ÎØ∏Îã¨Ïûê Î™©Î°ù ÌëúÏãú
            monthlyUnderperformers.innerHTML = '';
            if (underperformers.length === 0) {
                monthlyUnderperformers.innerHTML = '<div class="text-center py-6"><div class="text-4xl mb-2">üéâ</div><div class="text-sm font-medium text-primary-600">Î™®Îì† Î©§Î≤ÑÍ∞Ä Î™©ÌëúÎ•º Îã¨ÏÑ±ÌñàÏäµÎãàÎã§!</div></div>';
            } else {
                underperformers.forEach(member => {
                    const memberDiv = document.createElement('div');
                    memberDiv.className = 'bg-gradient-to-r from-pastel-coral to-pastel-pink p-3 rounded-xl mb-2 shadow-sm border border-white/30';
                    memberDiv.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <span class="text-lg">üö®</span>
                                <span class="font-semibold text-primary-800">${member.name}</span>
                            </div>
                            <div class="bg-white/60 backdrop-blur-sm px-3 py-1 rounded-lg">
                                <span class="text-sm font-bold text-primary-700">${member.count}Ìöå</span>
                            </div>
                        </div>
                    `;
                    monthlyUnderperformers.appendChild(memberDiv);
                });
            }
        }

        // Í∞ïÏ†ú Firebase Ï¥àÍ∏∞Ìôî Ìï®Ïàò
        async function forceFirebaseInit() {
            if (!confirm('FirebaseÏóê Î™®Îì† Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞Î•º Í∞ïÏ†úÎ°ú Îã§Ïãú Ï†ÄÏû•ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n(Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Îäî ÏÇ≠Ï†úÎê©ÎãàÎã§)')) {
                return;
            }
            
            try {
                console.log('üîÑ Firebase Í∞ïÏ†ú Ï¥àÍ∏∞Ìôî ÏãúÏûë...');
                
                // Ï¥àÍ∏∞Ìôî ÌîåÎûòÍ∑∏ Ï†úÍ±∞
                localStorage.removeItem('firebaseInitialized');
                
                // Î™®Îì† Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞ Ï†ïÏùò
                const allMembers = [
                    { id: 'ÏÑúÏïÑ', name: 'ÏÑúÏïÑ', nickname: 'ÏÑúÏïÑ', role: 'super_admin', phone: '010-0000-0000' },
                    { id: 'member_ÏπòÏ¶à', name: 'ÏπòÏ¶à', nickname: 'ÏπòÏ¶à', role: 'member', phone: '010-0000-0001' },
                    { id: 'member_Ïª§ÌîÑ', name: 'Ïª§ÌîÑ', nickname: 'Ïª§ÌîÑ', role: 'member', phone: '010-0000-0002' },
                    { id: 'member_ÌïòÏö∞ÏßÄ', name: 'ÌïòÏö∞ÏßÄ', nickname: 'ÌïòÏö∞ÏßÄ', role: 'member', phone: '010-0000-0003' },
                    { id: 'member_Ìó¨Î¶∞', name: 'Ìó¨Î¶∞', nickname: 'Ìó¨Î¶∞', role: 'member', phone: '010-0000-0004' },
                    { id: 'member_Ìô©Í∏∞Ï†Å', name: 'Ìô©Í∏∞Ï†Å', nickname: 'Ìô©Í∏∞Ï†Å', role: 'member', phone: '010-0000-0005' },
                    { id: 'member_Î∏îÎûô', name: 'Î∏îÎûô', nickname: 'Î∏îÎûô', role: 'member', phone: '010-0000-0006' },
                    { id: 'member_ÏãúÏõê', name: 'ÏãúÏõê', nickname: 'ÏãúÏõê', role: 'member', phone: '010-0000-0007' },
                    { id: 'member_Ïñ¥ÏßÄ', name: 'Ïñ¥ÏßÄ', nickname: 'Ïñ¥ÏßÄ', role: 'member', phone: '010-0000-0008' },
                    { id: 'member_Ï§ÑÏãúÏûë', name: 'Ï§ÑÏãúÏûë', nickname: 'Ï§ÑÏãúÏûë', role: 'member', phone: '010-0000-0009' },
                    { id: 'member_Ï°∞Ìè≠', name: 'Ï°∞Ìè≠', nickname: 'Ï°∞Ìè≠', role: 'member', phone: '010-0000-0010' },
                    { id: 'member_Î∞•Î∞•', name: 'Î∞•Î∞•', nickname: 'Î∞•Î∞•', role: 'member', phone: '010-0000-0011' },
                    { id: 'member_Î±ÉÏÇ¥ÎßàÏôï', name: 'Î±ÉÏÇ¥ÎßàÏôï', nickname: 'Î±ÉÏÇ¥ÎßàÏôï', role: 'member', phone: '010-0000-0012' },
                    { id: 'member_Î¥âÎèô', name: 'Î¥âÎèô', nickname: 'Î¥âÎèô', role: 'member', phone: '010-0000-0013' },
                    { id: 'member_Î∂ÄÏπò', name: 'Î∂ÄÏπò', nickname: 'Î∂ÄÏπò', role: 'member', phone: '010-0000-0014' },
                    { id: 'member_Íµ¨Î¶Ñ', name: 'Íµ¨Î¶Ñ', nickname: 'Íµ¨Î¶Ñ', role: 'member', phone: '010-0000-0015' },
                    { id: 'member_ÍøÄÎ∞§', name: 'ÍøÄÎ∞§', nickname: 'ÍøÄÎ∞§', role: 'member', phone: '010-0000-0016' },
                    { id: 'member_ÎÇòÏòÅ', name: 'ÎÇòÏòÅ', nickname: 'ÎÇòÏòÅ', role: 'member', phone: '010-0000-0017' },
                    { id: 'member_Î¨¥ÏßÄ', name: 'Î¨¥ÏßÄ', nickname: 'Î¨¥ÏßÄ', role: 'member', phone: '010-0000-0018' },
                    { id: 'member_ÎØºÏòÅ', name: 'ÎØºÏòÅ', nickname: 'ÎØºÏòÅ', role: 'member', phone: '010-0000-0019' },
                    { id: 'member_Í∞§Îü≠Ïãú', name: 'Í∞§Îü≠Ïãú', nickname: 'Í∞§Îü≠Ïãú', role: 'member', phone: '010-0000-0020' },
                    { id: 'member_Í±∞Î∂Å', name: 'Í±∞Î∂Å', nickname: 'Í±∞Î∂Å', role: 'member', phone: '010-0000-0021' },
                    { id: 'member_Í∏∞Î£¨', name: 'Í∏∞Î£¨', nickname: 'Í∏∞Î£¨', role: 'admin', phone: '010-0000-0022' },
                    { id: 'member_Ïò§Ïäà', name: 'Ïò§Ïäà', nickname: 'Ïò§Ïäà', role: 'member', phone: '010-0000-0023' },
                    { id: 'member_Ï¥àÎ≥¥', name: 'Ï¥àÎ≥¥', nickname: 'Ï¥àÎ≥¥', role: 'member', phone: '010-0000-0024' }
                ];
                
                // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
                console.log('üóëÔ∏è Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú Ï§ë...');
                const existingSnapshot = await db.collection('v2_members').get();
                const deletePromises = [];
                existingSnapshot.forEach(doc => {
                    deletePromises.push(doc.ref.delete());
                });
                if (deletePromises.length > 0) {
                    await Promise.all(deletePromises);
                }
                
                // ÏÉà Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                console.log('üìù ÏÉà Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ï§ë...');
                for (let i = 0; i < allMembers.length; i++) {
                    const member = allMembers[i];
                    console.log(`Ï†ÄÏû• Ï§ë ${i + 1}/${allMembers.length}: ${member.name}`);
                    
                    await db.collection('v2_members').doc(member.id).set({
                        id: member.id,
                        name: member.name,
                        nickname: member.nickname,
                        role: member.role,
                        phone: member.phone,
                        joinDate: new Date(`2024-01-${String(i + 1).padStart(2, '0')}`).toISOString(),
                        isActive: true,
                        password: member.role === 'super_admin' ? '1234' : '',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                    
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                localStorage.setItem('firebaseInitialized', 'true');
                console.log('‚úÖ Í∞ïÏ†ú Ï¥àÍ∏∞Ìôî ÏôÑÎ£å!');
                
                // ÌôïÏù∏ Î∞è ÏÉàÎ°úÍ≥†Ïπ®
                const checkSnapshot = await db.collection('v2_members').get();
                console.log(`FirebaseÏóê Ï†ÄÏû•Îêú Î©§Î≤Ñ Ïàò: ${checkSnapshot.size}`);
                
                await loadMembers();
                renderMemberList();
                
                alert(`Firebase Ï¥àÍ∏∞Ìôî ÏôÑÎ£å!\nÏ†ÄÏû•Îêú Î©§Î≤Ñ Ïàò: ${checkSnapshot.size}Î™Ö`);
                
            } catch (error) {
                console.error('Í∞ïÏ†ú Ï¥àÍ∏∞Ìôî Ïò§Î•ò:', error);
                alert('Ï¥àÍ∏∞Ìôî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
            }
        }

        // ÏÑ±Îä• ÏµúÏ†ÅÌôî ÏÑ§Ï†ï
        function setupPerformanceOptimizations() {
            // ÏßÄÏó∞ Î°úÎî© ÏÑ§Ï†ï
            setupLazyLoading();
            
            // Í∞ÄÏÉÅ Ïä§ÌÅ¨Î°§ÎßÅ ÏÑ§Ï†ï (Î©§Î≤Ñ Î™©Î°ùÏù¥ ÎßéÏùÑ Îïå)
            if (members.length > 50) {
                setupVirtualScrolling('memberList');
            }
            
            // Ï£ºÍ∏∞Ï†Å Î©îÎ™®Î¶¨ Ï†ïÎ¶¨ (5Î∂ÑÎßàÎã§)
            setInterval(cleanupMemory, 300000);
            
            // ÌéòÏù¥ÏßÄ Í∞ÄÏãúÏÑ± API ÌôúÏö©
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    // ÌéòÏù¥ÏßÄÍ∞Ä Ïà®Í≤®Ï°åÏùÑ Îïå Î∂àÌïÑÏöîÌïú ÏûëÏóÖ Ï§ëÎã®
                    clearInterval(renderDebounceTimer);
                } else {
                    // ÌéòÏù¥ÏßÄÍ∞Ä Îã§Ïãú Î≥¥Ïùº Îïå Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®
                    renderMemberList();
                    renderWeeklyDashboard();
                    renderMonthlyReport();
                }
            });
            
            // ÎÑ§Ìä∏ÏõåÌÅ¨ ÏÉÅÌÉú Î™®ÎãàÌÑ∞ÎßÅ
            if ('connection' in navigator) {
                const connection = navigator.connection;
                
                function updateNetworkStatus() {
                    if (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g') {
                        // ÎäêÎ¶∞ ÎÑ§Ìä∏ÏõåÌÅ¨ÏóêÏÑúÎäî ÏóÖÎç∞Ïù¥Ìä∏ ÎπàÎèÑ Ï§ÑÏù¥Í∏∞
                        console.log('ÎäêÎ¶∞ ÎÑ§Ìä∏ÏõåÌÅ¨ Í∞êÏßÄ: ÏÑ±Îä• Î™®Îìú ÌôúÏÑ±Ìôî');
                    }
                }
                
                connection.addEventListener('change', updateNetworkStatus);
                updateNetworkStatus();
            }
            
            // Î©îÎ™®Î¶¨ ÏÇ¨Ïö©Îüâ Î™®ÎãàÌÑ∞ÎßÅ (ÏßÄÏõêÎêòÎäî Î∏åÎùºÏö∞Ï†ÄÏóêÏÑúÎßå)
            if ('memory' in performance) {
                const checkMemory = () => {
                    const memory = performance.memory;
                    const usedPercent = (memory.usedJSHeapSize / memory.jsHeapSizeLimit) * 100;
                    
                    if (usedPercent > 80) {
                        console.warn('Î©îÎ™®Î¶¨ ÏÇ¨Ïö©ÎüâÏù¥ ÎÜíÏäµÎãàÎã§:', usedPercent.toFixed(2) + '%');
                        cleanupMemory();
                    }
                };
                
                setInterval(checkMemory, 60000); // 1Î∂ÑÎßàÎã§ Ï≤¥ÌÅ¨
            }
            
            // Ïù¥ÎØ∏ÏßÄ ÏµúÏ†ÅÌôî (WebP ÏßÄÏõê Ï≤¥ÌÅ¨)
            const supportsWebP = (() => {
                const canvas = document.createElement('canvas');
                canvas.width = 1;
                canvas.height = 1;
                return canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;
            })();
            
            if (supportsWebP) {
                console.log('WebP Ïù¥ÎØ∏ÏßÄ ÌòïÏãù ÏßÄÏõêÎê®');
            }
        }

        // ÏÑ±Îä• ÏµúÏ†ÅÌôî Í¥ÄÎ†® Ìï®ÏàòÎì§
        let performanceCache = new Map();
        let renderDebounceTimer = null;
        
        // Î°úÎî© ÏÉÅÌÉú Í¥ÄÎ¶¨
        function showLoading(message = 'Î°úÎî© Ï§ë...') {
            const loadingScreen = document.getElementById('loadingScreen');
            const loadingStatus = document.getElementById('loadingStatus');
            if (loadingScreen && loadingStatus) {
                loadingStatus.textContent = message;
                loadingScreen.classList.remove('hidden');
            }
        }
        
        function hideLoading() {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.classList.add('hidden');
            }
        }
        
        // ÎîîÎ∞îÏö¥Ïä§ Ìï®Ïàò (ÎπàÎ≤àÌïú Ìò∏Ï∂ú Î∞©ÏßÄ)
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Ïä§Î°úÌãÄ Ìï®Ïàò (ÏùºÏ†ï Í∞ÑÍ≤©ÏúºÎ°úÎßå Ïã§Ìñâ)
        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }
        
        // Ï∫êÏãú Í¥ÄÎ¶¨
        function getCachedData(key) {
            const cached = performanceCache.get(key);
            if (cached && Date.now() - cached.timestamp < 300000) { // 5Î∂Ñ Ï∫êÏãú
                return cached.data;
            }
            return null;
        }
        
        function setCachedData(key, data) {
            performanceCache.set(key, {
                data: data,
                timestamp: Date.now()
            });
        }
        
        // Í∞ÄÏÉÅ Ïä§ÌÅ¨Î°§ÎßÅ (ÎåÄÏö©Îüâ Î¶¨Ïä§Ìä∏ ÏµúÏ†ÅÌôî)
        function setupVirtualScrolling(containerId, itemHeight = 80) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            let visibleItems = Math.ceil(container.clientHeight / itemHeight) + 2;
            let scrollTop = 0;
            
            const updateVisibleItems = throttle(() => {
                scrollTop = container.scrollTop;
                const startIndex = Math.floor(scrollTop / itemHeight);
                const endIndex = Math.min(startIndex + visibleItems, members.length);
                
                // Ïã§Ï†ú Î†åÎçîÎßÅÏùÄ Î≥¥Ïù¥Îäî Î∂ÄÎ∂ÑÎßå
                renderVisibleMembers(startIndex, endIndex);
            }, 16); // 60fps
            
            container.addEventListener('scroll', updateVisibleItems);
            return updateVisibleItems;
        }
        
        // Î≥¥Ïù¥Îäî Î©§Î≤ÑÎßå Î†åÎçîÎßÅ (ÏÑ±Îä• ÏµúÏ†ÅÌôî)
        function renderVisibleMembers(startIndex, endIndex) {
            const memberList = document.getElementById('memberList');
            if (!memberList) return;
            
            // Ï∫êÏãúÎêú ÌïÑÌÑ∞ÎßÅ Í≤∞Í≥º ÏÇ¨Ïö©
            const cacheKey = `filtered_members_${JSON.stringify(getFilterState())}`;
            let filteredMembers = getCachedData(cacheKey);
            
            if (!filteredMembers) {
                filteredMembers = applyAdvancedFilters([...members]);
                setCachedData(cacheKey, filteredMembers);
            }
            
            const visibleMembers = filteredMembers.slice(startIndex, endIndex);
            
            // DOM Ï°∞Ïûë ÏµúÏÜåÌôî
            const fragment = document.createDocumentFragment();
            
            visibleMembers.forEach(member => {
                const memberElement = createMemberElement(member);
                fragment.appendChild(memberElement);
            });
            
            memberList.innerHTML = '';
            memberList.appendChild(fragment);
            
            updateFilterResults(members.length, filteredMembers.length);
        }
        
        // Î©§Î≤Ñ ÏóòÎ¶¨Î®ºÌä∏ ÏÉùÏÑ± (Ïû¨ÏÇ¨Ïö© Í∞ÄÎä•)
        function createMemberElement(member) {
            const memberElement = document.createElement('div');
            const status = getMemberStatus(member);
            const statusText = getStatusText(status);
            const roleIcon = getRoleIcon(member.role);
            const newMemberText = getNewMemberText(member);
            
            memberElement.className = `card-gradient p-4 rounded-xl cursor-pointer hover:shadow-soft transition-all duration-300 hover:scale-[1.02] ${member.isActive === false ? 'opacity-60' : ''}`;
            
            memberElement.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <div class="flex items-center space-x-2 mb-1">
                            <span class="text-lg">${roleIcon}</span>
                            <span class="font-semibold text-primary-800">${member.nickname || member.name}</span>
                            ${newMemberText ? `<span class="bg-gradient-to-r from-pastel-mint to-pastel-green text-primary-700 text-xs px-2 py-1 rounded-lg font-medium">${newMemberText}</span>` : ''}
                        </div>
                        <div class="text-sm text-primary-600 font-medium">${member.name}</div>
                        <div class="text-xs text-primary-500">${member.phone || 'Ïó∞ÎùΩÏ≤ò ÏóÜÏùå'}</div>
                    </div>
                    <div class="status-tag status-${status} ml-2">${statusText}</div>
                </div>
            `;
            
            memberElement.addEventListener('click', () => openMemberModal(member));
            return memberElement;
        }
        
        // ÌòÑÏû¨ ÌïÑÌÑ∞ ÏÉÅÌÉú Í∞ÄÏ†∏Ïò§Í∏∞
        function getFilterState() {
            return {
                search: document.getElementById('memberSearch')?.value || '',
                status: document.getElementById('statusFilter')?.value || 'all',
                role: document.getElementById('roleFilter')?.value || 'all',
                sort: document.getElementById('sortFilter')?.value || 'default',
                period: document.getElementById('periodFilter')?.value || 'all'
            };
        }
        
        // ÏßÄÏó∞ Î°úÎî© (Ïù¥ÎØ∏ÏßÄÎÇò Î¨¥Í±∞Ïö¥ Ïª®ÌÖêÏ∏†)
        function setupLazyLoading() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const element = entry.target;
                        if (element.dataset.src) {
                            element.src = element.dataset.src;
                            element.removeAttribute('data-src');
                        }
                        observer.unobserve(element);
                    }
                });
            });
            
            document.querySelectorAll('[data-src]').forEach(img => {
                observer.observe(img);
            });
        }
        
        // Î©îÎ™®Î¶¨ Ï†ïÎ¶¨
        function cleanupMemory() {
            // Ïò§ÎûòÎêú Ï∫êÏãú Ï†ïÎ¶¨
            const now = Date.now();
            for (const [key, value] of performanceCache.entries()) {
                if (now - value.timestamp > 600000) { // 10Î∂Ñ Ïù¥ÏÉÅÎêú Ï∫êÏãú ÏÇ≠Ï†ú
                    performanceCache.delete(key);
                }
            }
            
            // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†ïÎ¶¨ (ÌïÑÏöîÏãú)
            if (window.gc && typeof window.gc === 'function') {
                window.gc(); // Í∞úÎ∞ú ÌôòÍ≤ΩÏóêÏÑúÎßå ÏÇ¨Ïö© Í∞ÄÎä•
            }
        }
        
        // ÏÑ±Îä• Î™®ÎãàÌÑ∞ÎßÅ
        function measurePerformance(name, func) {
            const start = performance.now();
            const result = func();
            const end = performance.now();
            console.log(`${name} Ïã§Ìñâ ÏãúÍ∞Ñ: ${(end - start).toFixed(2)}ms`);
            return result;
        }

        // Ïú†Ìã∏Î¶¨Ìã∞ Ìï®ÏàòÎì§
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Í¥ÄÎ†® Ìï®ÏàòÎì§
        function openChangePasswordModal() {
            const modal = document.getElementById('changePasswordModal');
            
            // Ìèº Ï¥àÍ∏∞Ìôî
            document.getElementById('changePasswordForm').reset();
            document.getElementById('passwordChangeError').classList.add('hidden');
            resetPasswordStrength();
            
            modal.classList.add('active');
        }

        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.remove('active');
        }

        // ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥¥Í∏∞/Ïà®Í∏∞Í∏∞ ÌÜ†Í∏Ä
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const button = document.getElementById(`toggle${inputId.charAt(0).toUpperCase() + inputId.slice(1)}`);
            
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'üôà';
            } else {
                input.type = 'password';
                button.textContent = 'üëÅÔ∏è';
            }
        }

        // ÎπÑÎ∞ÄÎ≤àÌò∏ Í∞ïÎèÑ Ï≤¥ÌÅ¨
        function checkPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            const strengthBars = [
                document.getElementById('strength1'),
                document.getElementById('strength2'),
                document.getElementById('strength3'),
                document.getElementById('strength4')
            ];
            const strengthText = document.getElementById('strengthText');
            
            // Í∞ïÎèÑ Í≥ÑÏÇ∞
            let strength = 0;
            if (password.length >= 4) strength++;
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password) && /[a-z]/.test(password)) strength++;
            if (/\d/.test(password) && /[!@#$%^&*(),.?":{}|<>]/.test(password)) strength++;
            
            // Î∞î ÏÉâÏÉÅ ÏóÖÎç∞Ïù¥Ìä∏
            strengthBars.forEach((bar, index) => {
                if (index < strength) {
                    const colors = ['bg-red-400', 'bg-yellow-400', 'bg-blue-400', 'bg-green-400'];
                    bar.className = `flex-1 h-2 rounded ${colors[strength - 1]}`;
                } else {
                    bar.className = 'flex-1 h-2 bg-gray-200 rounded';
                }
            });
            
            // ÌÖçÏä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            const texts = ['Îß§Ïö∞ ÏïΩÌï®', 'ÏïΩÌï®', 'Î≥¥ÌÜµ', 'Í∞ïÌï®'];
            strengthText.textContent = password.length === 0 ? 'ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî' : texts[strength - 1] || 'Îß§Ïö∞ ÏïΩÌï®';
            
            // ÎπÑÎ∞ÄÎ≤àÌò∏ ÏùºÏπò ÌôïÏù∏ÎèÑ Îã§Ïãú Ï≤¥ÌÅ¨
            checkPasswordMatch();
        }

        // ÎπÑÎ∞ÄÎ≤àÌò∏ ÏùºÏπò ÌôïÏù∏
        function checkPasswordMatch() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const confirmInput = document.getElementById('confirmPassword');
            
            if (confirmPassword.length === 0) {
                confirmInput.style.borderColor = '';
                return;
            }
            
            if (newPassword === confirmPassword) {
                confirmInput.style.borderColor = '#10b981'; // ÎÖπÏÉâ
            } else {
                confirmInput.style.borderColor = '#ef4444'; // Îπ®Í∞ÑÏÉâ
            }
        }

        // ÎπÑÎ∞ÄÎ≤àÌò∏ Í∞ïÎèÑ Ï¥àÍ∏∞Ìôî
        function resetPasswordStrength() {
            const strengthBars = [
                document.getElementById('strength1'),
                document.getElementById('strength2'),
                document.getElementById('strength3'),
                document.getElementById('strength4')
            ];
            
            strengthBars.forEach(bar => {
                bar.className = 'flex-1 h-2 bg-gray-200 rounded';
            });
            
            document.getElementById('strengthText').textContent = 'ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî';
        }

        // ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Ï≤òÎ¶¨
        async function handlePasswordChange(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const errorDiv = document.getElementById('passwordChangeError');
            
            // Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
            if (newPassword !== confirmPassword) {
                showPasswordError('ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
                return;
            }
            
            if (newPassword.length < 4) {
                showPasswordError('ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏Îäî ÏµúÏÜå 4Ïûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§.');
                return;
            }
            
            if (currentPassword === newPassword) {
                showPasswordError('ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏Îäî ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏ÏôÄ Îã¨ÎùºÏïº Ìï©ÎãàÎã§.');
                return;
            }
            
            try {
                // ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏
                const isCurrentPasswordValid = await verifyCurrentPassword(currentPassword);
                
                if (!isCurrentPasswordValid) {
                    showPasswordError('ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
                    return;
                }
                
                // ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏ Ï†ÄÏû•
                await updatePassword(newPassword);
                
                // ÏÑ±Í≥µ Î©îÏãúÏßÄ
                showMessage('üîê ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§!', 'success');
                closeChangePasswordModal();
                
                // ÏûêÎèô Î°úÍ∑∏ÏïÑÏõÉ (Î≥¥ÏïàÏÉÅ Ïû¨Î°úÍ∑∏Ïù∏ ÌïÑÏöî)
                setTimeout(() => {
                    if (confirm('Î≥¥ÏïàÏùÑ ÏúÑÌï¥ Îã§Ïãú Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî. Î°úÍ∑∏ÏïÑÏõÉÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                        handleLogout();
                    }
                }, 2000);
                
            } catch (error) {
                console.error('ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Ïò§Î•ò:', error);
                showPasswordError('ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // ÌòÑÏû¨ ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏
        async function verifyCurrentPassword(password) {
            // Í∏∞Î≥∏ Í≥ÑÏ†ï ÌôïÏù∏
            const defaultAccounts = {
                'ÏÑúÏïÑ': '1234',
                'admin': 'admin123'
            };
            
            if (defaultAccounts[currentUser.id] && defaultAccounts[currentUser.id] === password) {
                return true;
            }
            
            // Î∂ÄÎ∞©Ïû• Í≥ÑÏ†ïÏù∏ Í≤ΩÏö∞ Î°úÏª¨ members Î∞∞Ïó¥ÏóêÏÑú ÌôïÏù∏
            if (currentUser.role === 'admin' && currentUser.loginId) {
                const memberByLoginId = members.find(m => m.loginId === currentUser.loginId);
                if (memberByLoginId && memberByLoginId.password === password) {
                    return true;
                }
            }
            
            // memberIdÍ∞Ä ÏûàÎäî Í≤ΩÏö∞ (Î∂ÄÎ∞©Ïû• Í≥ÑÏ†ï)
            if (currentUser.memberId) {
                const memberById = members.find(m => m.id === currentUser.memberId);
                if (memberById && memberById.password === password) {
                    return true;
                }
            }
            
            // FirebaseÏóêÏÑú ÌôïÏù∏ (Ïó∞Í≤∞Îêú Í≤ΩÏö∞)
            if (db) {
                try {
                    let userDoc;
                    
                    // Î∂ÄÎ∞©Ïû• Í≥ÑÏ†ïÏù∏ Í≤ΩÏö∞ memberIdÎ°ú ÌôïÏù∏
                    if (currentUser.memberId) {
                        userDoc = await db.collection('v2_members').doc(currentUser.memberId).get();
                    } else {
                        userDoc = await db.collection('v2_members').doc(currentUser.id).get();
                    }
                    
                    if (userDoc && userDoc.exists) {
                        const userData = userDoc.data();
                        return userData.password === password;
                    }
                } catch (error) {
                    console.error('Firebase ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏ Ïò§Î•ò:', error);
                }
            }
            
            // ÌòÑÏû¨ Ï†ÄÏû•Îêú ÎπÑÎ∞ÄÎ≤àÌò∏ÏôÄ ÎπÑÍµê (Î°úÏª¨ Î™®Îìú)
            const savedUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            if (savedUser.password && savedUser.password === password) {
                return true;
            }
            
            return false;
        }

        // ÎπÑÎ∞ÄÎ≤àÌò∏ ÏóÖÎç∞Ïù¥Ìä∏
        async function updatePassword(newPassword) {
            // ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            currentUser.password = newPassword;
            
            // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Firebase ÏóÖÎç∞Ïù¥Ìä∏ (Ïó∞Í≤∞Îêú Í≤ΩÏö∞)
            if (db) {
                try {
                    // Î∂ÄÎ∞©Ïû• Í≥ÑÏ†ïÏù∏ Í≤ΩÏö∞ memberIdÎ°ú ÏóÖÎç∞Ïù¥Ìä∏
                    if (currentUser.memberId) {
                        await db.collection('v2_members').doc(currentUser.memberId).update({
                            password: newPassword,
                            passwordUpdatedAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        });
                    } else {
                        // Í∏∞Î≥∏ Í≥ÑÏ†ïÏù∏ Í≤ΩÏö∞ currentUser.idÎ°ú ÏóÖÎç∞Ïù¥Ìä∏
                        await db.collection('v2_members').doc(currentUser.id).update({
                            password: newPassword,
                            passwordUpdatedAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        });
                    }
                    console.log('Firebase ÎπÑÎ∞ÄÎ≤àÌò∏ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
                } catch (error) {
                    console.error('Firebase ÎπÑÎ∞ÄÎ≤àÌò∏ ÏóÖÎç∞Ïù¥Ìä∏ Ïò§Î•ò:', error);
                    // Firebase Ïã§Ìå®Ìï¥ÎèÑ Î°úÏª¨ÏùÄ ÏÑ±Í≥µÏúºÎ°ú Ï≤òÎ¶¨
                }
            }
            
            // Î°úÏª¨ members Î∞∞Ïó¥ÏóêÏÑúÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            let memberToUpdate = null;
            
            // Î∂ÄÎ∞©Ïû• Í≥ÑÏ†ïÏù∏ Í≤ΩÏö∞ memberIdÎ°ú Ï∞æÍ∏∞
            if (currentUser.memberId) {
                memberToUpdate = members.find(m => m.id === currentUser.memberId);
            } else {
                // Í∏∞Î≥∏ Í≥ÑÏ†ïÏù∏ Í≤ΩÏö∞ idÎ°ú Ï∞æÍ∏∞
                memberToUpdate = members.find(m => m.id === currentUser.id);
            }
            
            if (memberToUpdate) {
                memberToUpdate.password = newPassword;
                memberToUpdate.passwordUpdatedAt = new Date().toISOString();
                memberToUpdate.updatedAt = new Date().toISOString();
                localStorage.setItem('localMembers', JSON.stringify(members));
                console.log('Î°úÏª¨ Î©§Î≤Ñ Î∞∞Ïó¥ ÎπÑÎ∞ÄÎ≤àÌò∏ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
            }
            
            // Î∂ÄÎ∞©Ïû• Í≥ÑÏ†ïÏùò Í≤ΩÏö∞ loginIdÎ°úÎèÑ ÌôïÏù∏
            if (currentUser.role === 'admin' && currentUser.loginId) {
                const memberByLoginId = members.find(m => m.loginId === currentUser.loginId);
                if (memberByLoginId) {
                    memberByLoginId.password = newPassword;
                    memberByLoginId.passwordUpdatedAt = new Date().toISOString();
                    memberByLoginId.updatedAt = new Date().toISOString();
                    localStorage.setItem('localMembers', JSON.stringify(members));
                    console.log('Î∂ÄÎ∞©Ïû• Í≥ÑÏ†ï ÎπÑÎ∞ÄÎ≤àÌò∏ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
                }
            }
        }

        // ÎπÑÎ∞ÄÎ≤àÌò∏ ÏóêÎü¨ ÌëúÏãú
        function showPasswordError(message) {
            const errorDiv = document.getElementById('passwordChangeError');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }

        // Î∂ÄÎ∞©Ïû• Í≥ÑÏ†ï ÏÉùÏÑ± Í¥ÄÎ†® Ìï®ÏàòÎì§
        async function createSubAdminAccount(nickname, name) {
            // Î°úÍ∑∏Ïù∏ ID ÏÉùÏÑ± (ÎãâÎÑ§ÏûÑ Í∏∞Î∞ò, Ï§ëÎ≥µ Î∞©ÏßÄ)
            let loginId = nickname.toLowerCase().replace(/\s+/g, '');
            
            // Í∏∞Ï°¥ IDÏôÄ Ï§ëÎ≥µ ÌôïÏù∏
            let counter = 1;
            let originalLoginId = loginId;
            while (await isLoginIdExists(loginId)) {
                loginId = `${originalLoginId}${counter}`;
                counter++;
            }
            
            // Í∏∞Î≥∏ ÎπÑÎ∞ÄÎ≤àÌò∏ ÏÉùÏÑ± (ÏïàÏ†ÑÌïú ÏûÑÏãú ÎπÑÎ∞ÄÎ≤àÌò∏)
            const tempPassword = generateTempPassword();
            
            return {
                loginId: loginId,
                password: tempPassword
            };
        }

        // Î°úÍ∑∏Ïù∏ ID Ï§ëÎ≥µ ÌôïÏù∏
        async function isLoginIdExists(loginId) {
            // Í∏∞Î≥∏ Í≥ÑÏ†ï ÌôïÏù∏
            const defaultAccounts = ['ÏÑúÏïÑ', 'admin'];
            if (defaultAccounts.includes(loginId)) {
                return true;
            }
            
            // Í∏∞Ï°¥ Î©§Î≤ÑÎì§Ïùò loginId ÌôïÏù∏
            const existingIds = members
                .filter(m => m.loginId)
                .map(m => m.loginId);
            
            return existingIds.includes(loginId);
        }

        // ÏûÑÏãú ÎπÑÎ∞ÄÎ≤àÌò∏ ÏÉùÏÑ±
        function generateTempPassword() {
            // ÏïàÏ†ÑÌïòÎ©¥ÏÑúÎèÑ Í∏∞ÏñµÌïòÍ∏∞ Ïâ¨Ïö¥ ÌòïÌÉúÏùò ÏûÑÏãú ÎπÑÎ∞ÄÎ≤àÌò∏
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // Í≥ÑÏ†ï ÏÉùÏÑ± ÏïåÎ¶º Î™®Îã¨
        function showAccountCreatedNotification(loginId, password, name) {
            // Ïª§Ïä§ÌÖÄ ÏïåÎ¶º Î™®Îã¨ ÏÉùÏÑ±
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="card-gradient rounded-2xl shadow-soft-lg p-8 w-full max-w-md mx-4">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-gradient-to-br from-pastel-green to-pastel-mint rounded-xl mx-auto mb-4 flex items-center justify-center">
                            <span class="text-2xl">üéâ</span>
                        </div>
                        <h3 class="text-xl font-bold text-primary-800">Î∂ÄÎ∞©Ïû• Í≥ÑÏ†ï ÏÉùÏÑ± ÏôÑÎ£å!</h3>
                        <p class="text-primary-600 text-sm mt-2">${name}ÎãòÏùò Î°úÍ∑∏Ïù∏ Í≥ÑÏ†ïÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§</p>
                    </div>
                    
                    <div class="bg-gradient-to-r from-pastel-blue to-pastel-purple p-4 rounded-xl mb-6">
                        <h4 class="font-bold text-primary-800 mb-3 text-center">üìã Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥</h4>
                        <div class="space-y-3">
                            <div class="bg-white/50 p-3 rounded-lg">
                                <div class="text-xs text-primary-600 mb-1">ÏïÑÏù¥Îîî</div>
                                <div class="font-bold text-primary-800 flex items-center justify-between">
                                    <span id="newLoginId">${loginId}</span>
                                    <button onclick="copyToClipboard('${loginId}')" class="text-xs bg-pastel-mint px-2 py-1 rounded hover:bg-pastel-green transition-colors">Î≥µÏÇ¨</button>
                                </div>
                            </div>
                            <div class="bg-white/50 p-3 rounded-lg">
                                <div class="text-xs text-primary-600 mb-1">ÏûÑÏãú ÎπÑÎ∞ÄÎ≤àÌò∏</div>
                                <div class="font-bold text-primary-800 flex items-center justify-between">
                                    <span id="newPassword">${password}</span>
                                    <button onclick="copyToClipboard('${password}')" class="text-xs bg-pastel-mint px-2 py-1 rounded hover:bg-pastel-green transition-colors">Î≥µÏÇ¨</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-pastel-yellow p-3 rounded-xl mb-6">
                        <div class="text-xs text-primary-700">
                            <strong>‚ö†Ô∏è Ï§ëÏöî ÏïàÎÇ¥:</strong><br>
                            ‚Ä¢ ÏûÑÏãú ÎπÑÎ∞ÄÎ≤àÌò∏Îäî Î≥¥ÏïàÏùÑ ÏúÑÌï¥ Ï≤´ Î°úÍ∑∏Ïù∏ ÌõÑ Ï¶âÏãú Î≥ÄÍ≤ΩÌï¥Ï£ºÏÑ∏Ïöî<br>
                            ‚Ä¢ Ïù¥ Ï†ïÎ≥¥Î•º ÏïàÏ†ÑÌïú Í≥≥Ïóê Î≥¥Í¥ÄÌïòÏÑ∏Ïöî<br>
                            ‚Ä¢ Î°úÍ∑∏Ïù∏ ÌõÑ üîê ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Î©îÎâ¥Î•º Ïù¥Ïö©ÌïòÏÑ∏Ïöî
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="sendAccountInfo('${loginId}', '${password}', '${name}')" class="flex-1 bg-gradient-to-r from-pastel-coral to-pastel-pink text-primary-800 py-3 rounded-xl font-medium hover:shadow-soft transition-all">
                            üì± Ï†ïÎ≥¥ Ï†ÑÏÜ°
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 btn-primary text-white py-3 rounded-xl font-medium">
                            ‚úÖ ÌôïÏù∏
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // 5Ï¥à ÌõÑ ÏûêÎèôÏúºÎ°ú Îã´Í∏∞ ÏïàÎÇ¥
            setTimeout(() => {
                const autoCloseText = modal.querySelector('.card-gradient');
                if (autoCloseText && modal.parentNode) {
                    const notice = document.createElement('div');
                    notice.className = 'text-xs text-primary-500 text-center mt-2';
                    notice.textContent = '5Ï¥à ÌõÑ ÏûêÎèôÏúºÎ°ú Îã´ÌûôÎãàÎã§...';
                    autoCloseText.appendChild(notice);
                    
                    setTimeout(() => {
                        if (modal.parentNode) {
                            modal.remove();
                        }
                    }, 5000);
                }
            }, 3000);
        }

        // ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Ìï®Ïàò (Promise Î∞òÌôò)
        function copyToClipboard(text) {
            return new Promise((resolve, reject) => {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    // ÏµúÏã† Clipboard API ÏÇ¨Ïö©
                    navigator.clipboard.writeText(text)
                        .then(() => {
                            resolve();
                        })
                        .catch(() => {
                            // fallback ÏãúÎèÑ
                            try {
                                const textArea = document.createElement('textarea');
                                textArea.value = text;
                                textArea.style.position = 'fixed';
                                textArea.style.opacity = '0';
                                document.body.appendChild(textArea);
                                textArea.select();
                                textArea.setSelectionRange(0, 99999); // Î™®Î∞îÏùº ÏßÄÏõê
                                const successful = document.execCommand('copy');
                                document.body.removeChild(textArea);
                                
                                if (successful) {
                                    resolve();
                                } else {
                                    reject(new Error('Î≥µÏÇ¨ Ïã§Ìå®'));
                                }
                            } catch (err) {
                                reject(err);
                            }
                        });
                } else {
                    // Íµ¨Ìòï Î∏åÎùºÏö∞Ï†Ä fallback
                    try {
                        const textArea = document.createElement('textarea');
                        textArea.value = text;
                        textArea.style.position = 'fixed';
                        textArea.style.opacity = '0';
                        document.body.appendChild(textArea);
                        textArea.select();
                        textArea.setSelectionRange(0, 99999);
                        const successful = document.execCommand('copy');
                        document.body.removeChild(textArea);
                        
                        if (successful) {
                            resolve();
                        } else {
                            reject(new Error('Î≥µÏÇ¨ Ïã§Ìå®'));
                        }
                    } catch (err) {
                        reject(err);
                    }
                }
            });
        }

        // Í≥ÑÏ†ï Ï†ïÎ≥¥ ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨
        function sendAccountInfo(loginId, password, name) {
            const message = `üéâ [Ïö¥Îèô Î∞© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú] Î∂ÄÎ∞©Ïû• Í≥ÑÏ†ï ÏÉùÏÑ± ÏôÑÎ£å!

üë§ Ïù¥Î¶Ñ: ${name}Îãò
üÜî ÏïÑÏù¥Îîî: ${loginId}
üîê ÏûÑÏãú ÎπÑÎ∞ÄÎ≤àÌò∏: ${password}

‚ö†Ô∏è Ï§ëÏöî ÏïàÎÇ¥:
‚Ä¢ Ï≤´ Î°úÍ∑∏Ïù∏ ÌõÑ Î∞òÎìúÏãú ÎπÑÎ∞ÄÎ≤àÌò∏Î•º Î≥ÄÍ≤ΩÌï¥Ï£ºÏÑ∏Ïöî
‚Ä¢ Î°úÍ∑∏Ïù∏ ‚Üí üîê ÎπÑÎ∞ÄÎ≤àÌò∏ Î≥ÄÍ≤Ω Î©îÎâ¥ Ïù¥Ïö©
‚Ä¢ Í≥ÑÏ†ï Ï†ïÎ≥¥Îäî ÏïàÏ†ÑÌïòÍ≤å Î≥¥Í¥ÄÌï¥Ï£ºÏÑ∏Ïöî

üîó Ï†ëÏÜç Ï£ºÏÜå: https://gym-management1.netlify.app/

üí™ Ìï®Íªò Í±¥Í∞ïÌïú Ïö¥Îèô ÏäµÍ¥ÄÏùÑ ÎßåÎì§Ïñ¥Í∞ÄÏöî!`;
            
            // ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨
            copyToClipboard(message).then(() => {
                showMessage('üìã Í≥ÑÏ†ï Ï†ïÎ≥¥Í∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!\nÏπ¥Ïπ¥Ïò§ÌÜ°Ïù¥ÎÇò Î¨∏ÏûêÎ°ú Ï†ÑÎã¨Ìï¥Ï£ºÏÑ∏Ïöî! üí¨', 'success');
                console.log('Î≥µÏÇ¨Îêú Î©îÏãúÏßÄ:', message);
            }).catch(() => {
                // ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Ïã§Ìå® Ïãú ÏΩòÏÜîÏóê ÌëúÏãú
                console.log('üìã Î≥µÏÇ¨Ìï† Î©îÏãúÏßÄ:', message);
                showMessage('üìã Î©îÏãúÏßÄÎ•º ÏΩòÏÜîÏóêÏÑú ÌôïÏù∏ÌïòÏó¨ Î≥µÏÇ¨Ìï¥Ï£ºÏÑ∏Ïöî!', 'info');
            });
        }

        // Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Í¥ÄÎ†® Ìï®ÏàòÎì§
        function openExportModal() {
            const modal = document.getElementById('exportModal');
            setupReportMonthOptions();
            modal.classList.add('active');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('active');
        }

        function setupReportMonthOptions() {
            const select = document.getElementById('reportMonth');
            select.innerHTML = '';
            
            const now = new Date();
            for (let i = 0; i < 12; i++) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const option = document.createElement('option');
                option.value = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                option.textContent = `${date.getFullYear()}ÎÖÑ ${date.getMonth() + 1}Ïõî`;
                select.appendChild(option);
            }
        }

        // CSV ÌòïÌÉúÎ°ú Îç∞Ïù¥ÌÑ∞Î•º Î≥ÄÌôòÌïòÎäî Ìï®Ïàò
        function arrayToCSV(data) {
            if (!data || data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => 
                    headers.map(header => {
                        const value = row[header] || '';
                        // CSVÏóêÏÑú ÏâºÌëúÎÇò Îî∞Ïò¥ÌëúÍ∞Ä Ìè¨Ìï®Îêú Í∞íÏùÄ Îî∞Ïò¥ÌëúÎ°ú Í∞êÏã∏Í∏∞
                        return typeof value === 'string' && (value.includes(',') || value.includes('"')) 
                            ? `"${value.replace(/"/g, '""')}"` 
                            : value;
                    }).join(',')
                )
            ].join('\\n');
            
            return csvContent;
        }

        // ÌååÏùº Îã§Ïö¥Î°úÎìú Ìï®Ïàò
        function downloadFile(content, filename, type = 'text/csv') {
            const blob = new Blob([content], { type: type + ';charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ìï®Ïàò
        function exportToExcel(type) {
            let data = [];
            let filename = '';
            
            switch (type) {
                case 'members':
                    data = members.map(member => ({
                        'ÎãâÎÑ§ÏûÑ': member.nickname || member.name,
                        'Ïã§Î™Ö': member.name,
                        'Ïó∞ÎùΩÏ≤ò': member.phone || '',
                        'Ïó≠Ìï†': member.role === 'super_admin' ? 'Î∞©Ïû•' : member.role === 'admin' ? 'Î∂ÄÎ∞©Ïû•' : 'ÏùºÎ∞òÎ©§Î≤Ñ',
                        'Í∞ÄÏûÖÏùº': member.joinDate ? new Date(member.joinDate).toLocaleDateString('ko-KR') : '',
                        'ÏÉÅÌÉú': member.isActive === false ? 'ÎπÑÌôúÏÑ±' : 'ÌôúÏÑ±',
                        'ÌòÑÏû¨ÏÉÅÌÉú': getStatusText(getMemberStatus(member))
                    }));
                    filename = `Î©§Î≤ÑÎ™©Î°ù_${new Date().toISOString().split('T')[0]}.csv`;
                    break;
                    
                case 'activities':
                    data = [];
                    Object.keys(activities).forEach(dateStr => {
                        const activity = activities[dateStr];
                        if (activity.workout) {
                            activity.workout.forEach(memberId => {
                                const member = members.find(m => m.id === memberId);
                                data.push({
                                    'ÎÇ†Ïßú': dateStr,
                                    'ÌôúÎèô': 'Ïö¥Îèô',
                                    'Î©§Î≤ÑID': memberId,
                                    'ÎãâÎÑ§ÏûÑ': member ? (member.nickname || member.name) : memberId,
                                    'Ïã§Î™Ö': member ? member.name : '',
                                    'Í∏∞Î°ùÏãúÍ∞Ñ': activity.updatedAt ? new Date(activity.updatedAt).toLocaleString('ko-KR') : '',
                                    'Í∏∞Î°ùÏûê': activity.updatedBy || ''
                                });
                            });
                        }
                        if (activity.meeting) {
                            activity.meeting.forEach(memberId => {
                                const member = members.find(m => m.id === memberId);
                                data.push({
                                    'ÎÇ†Ïßú': dateStr,
                                    'ÌôúÎèô': 'Î≤ô',
                                    'Î©§Î≤ÑID': memberId,
                                    'ÎãâÎÑ§ÏûÑ': member ? (member.nickname || member.name) : memberId,
                                    'Ïã§Î™Ö': member ? member.name : '',
                                    'Í∏∞Î°ùÏãúÍ∞Ñ': activity.updatedAt ? new Date(activity.updatedAt).toLocaleString('ko-KR') : '',
                                    'Í∏∞Î°ùÏûê': activity.updatedBy || ''
                                });
                            });
                        }
                    });
                    filename = `ÌôúÎèôÍ∏∞Î°ù_${new Date().toISOString().split('T')[0]}.csv`;
                    break;
                    
                case 'all':
                    // Î©§Î≤ÑÎ≥Ñ ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞
                    data = members.map(member => {
                        const workoutCount = countMemberActivity(member.id, new Date(2024, 0, 1), new Date(), 'workout');
                        const meetingCount = countMemberActivity(member.id, new Date(2024, 0, 1), new Date(), 'meeting');
                        
                        return {
                            'ÎãâÎÑ§ÏûÑ': member.nickname || member.name,
                            'Ïã§Î™Ö': member.name,
                            'Ïó∞ÎùΩÏ≤ò': member.phone || '',
                            'Ïó≠Ìï†': member.role === 'super_admin' ? 'Î∞©Ïû•' : member.role === 'admin' ? 'Î∂ÄÎ∞©Ïû•' : 'ÏùºÎ∞òÎ©§Î≤Ñ',
                            'Í∞ÄÏûÖÏùº': member.joinDate ? new Date(member.joinDate).toLocaleDateString('ko-KR') : '',
                            'ÏÉÅÌÉú': member.isActive === false ? 'ÎπÑÌôúÏÑ±' : 'ÌôúÏÑ±',
                            'ÌòÑÏû¨ÏÉÅÌÉú': getStatusText(getMemberStatus(member)),
                            'Ï¥ùÏö¥ÎèôÌöüÏàò': workoutCount,
                            'Ï¥ùÎ≤ôÏ∞∏Ïó¨ÌöüÏàò': meetingCount,
                            'ÎßàÏßÄÎßâÌôúÎèôÏùº': getLastActivityDate(member.id)
                        };
                    });
                    filename = `Ï†ÑÏ≤¥Îç∞Ïù¥ÌÑ∞_${new Date().toISOString().split('T')[0]}.csv`;
                    break;
            }
            
            if (data.length === 0) {
                alert('ÎÇ¥Î≥¥ÎÇº Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            const csvContent = arrayToCSV(data);
            downloadFile('\\ufeff' + csvContent, filename); // BOM Ï∂îÍ∞ÄÎ°ú ÌïúÍ∏Ä Íπ®Ïßê Î∞©ÏßÄ
            
            // ÏÑ±Í≥µ Î©îÏãúÏßÄ
            const button = document.querySelector(`#export${type.charAt(0).toUpperCase() + type.slice(1)}Excel`);
            if (button) {
                const originalText = button.textContent;
                button.textContent = '‚úÖ Îã§Ïö¥Î°úÎìú ÏôÑÎ£å!';
                button.style.background = 'linear-gradient(to right, #10b981, #059669)';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
            }
        }

        // Î©§Î≤ÑÏùò ÎßàÏßÄÎßâ ÌôúÎèôÏùº Ï°∞Ìöå
        function getLastActivityDate(memberId) {
            let lastDate = '';
            
            Object.keys(activities).forEach(dateStr => {
                const activity = activities[dateStr];
                if ((activity.workout && activity.workout.includes(memberId)) ||
                    (activity.meeting && activity.meeting.includes(memberId))) {
                    if (dateStr > lastDate) {
                        lastDate = dateStr;
                    }
                }
            });
            
            return lastDate || 'ÌôúÎèôÏóÜÏùå';
        }

        // Ï†ÑÏ≤¥ Î∞±ÏóÖ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
        function exportBackup() {
            const backupData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                members: members,
                activities: activities,
                notice: {
                    category: document.getElementById('noticeCategory')?.value || 'Í≥µÏßÄ',
                    text: document.getElementById('noticeText')?.value || ''
                }
            };
            
            const jsonContent = JSON.stringify(backupData, null, 2);
            const filename = `Ïö¥ÎèôÎ∞©Î∞±ÏóÖ_${new Date().toISOString().split('T')[0]}.json`;
            
            downloadFile(jsonContent, filename, 'application/json');
            
            // ÏÑ±Í≥µ Î©îÏãúÏßÄ
            const button = document.getElementById('exportBackup');
            const originalText = button.textContent;
            button.textContent = '‚úÖ Î∞±ÏóÖ ÏôÑÎ£å!';
            button.style.background = 'linear-gradient(to right, #10b981, #059669)';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '';
            }, 2000);
        }

        // Î∞±ÏóÖ Î≥µÏõêÌïòÍ∏∞
        function importBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (!backupData.members || !backupData.activities) {
                        alert('Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏùÄ Î∞±ÏóÖ ÌååÏùºÏûÖÎãàÎã§.');
                        return;
                    }
                    
                    if (confirm('Î∞±ÏóÖÏùÑ Î≥µÏõêÌïòÏãúÍ≤†ÏäµÎãàÍπå? ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞Îäî ÎçÆÏñ¥Ïì∞Ïó¨ÏßëÎãàÎã§.')) {
                        // Îç∞Ïù¥ÌÑ∞ Î≥µÏõê
                        members.length = 0;
                        members.push(...backupData.members);
                        
                        Object.keys(activities).forEach(key => delete activities[key]);
                        Object.assign(activities, backupData.activities);
                        
                        // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
                        localStorage.setItem('localMembers', JSON.stringify(members));
                        localStorage.setItem('localActivities', JSON.stringify(activities));
                        
                        // ÌôîÎ©¥ ÏÉàÎ°úÍ≥†Ïπ®
                        renderMemberList();
                        renderCalendar();
                        renderWeeklyDashboard();
                        renderMonthlyReport();
                        
                        alert('Î∞±ÏóÖÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î≥µÏõêÎêòÏóàÏäµÎãàÎã§.');
                        closeExportModal();
                    }
                } catch (error) {
                    console.error('Î∞±ÏóÖ Î≥µÏõê Ïò§Î•ò:', error);
                    alert('Î∞±ÏóÖ ÌååÏùºÏùÑ ÏùΩÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            };
            
            reader.readAsText(file);
            event.target.value = ''; // ÌååÏùº ÏûÖÎ†• Ï¥àÍ∏∞Ìôî
        }

        // ÏõîÍ∞Ñ Î¶¨Ìè¨Ìä∏ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
        function exportMonthlyReport() {
            const selectedMonth = document.getElementById('reportMonth').value;
            const [year, month] = selectedMonth.split('-');
            
            const startDate = new Date(parseInt(year), parseInt(month) - 1, 1);
            const endDate = new Date(parseInt(year), parseInt(month), 0);
            
            const reportData = [];
            
            // Ìï¥Îãπ ÏõîÏùò Î™®Îì† ÌôúÎèô Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            members.forEach(member => {
                if (member.isActive === false) return;
                
                const workoutCount = countMemberActivity(member.id, startDate, endDate, 'workout');
                const meetingCount = countMemberActivity(member.id, startDate, endDate, 'meeting');
                
                reportData.push({
                    'ÎãâÎÑ§ÏûÑ': member.nickname || member.name,
                    'Ïã§Î™Ö': member.name,
                    'Ïö¥ÎèôÌöüÏàò': workoutCount,
                    'Î≤ôÏ∞∏Ïó¨ÌöüÏàò': meetingCount,
                    'Ïö¥ÎèôÎ™©ÌëúÎã¨ÏÑ±': workoutCount >= 8 ? 'O' : 'X',
                    'Î≤ôÎ™©ÌëúÎã¨ÏÑ±': meetingCount >= 1 ? 'O' : 'X',
                    'Ï¢ÖÌï©ÌèâÍ∞Ä': (workoutCount >= 8 && meetingCount >= 1) ? 'Ïö∞Ïàò' : 
                               (workoutCount >= 4 || meetingCount >= 1) ? 'Î≥¥ÌÜµ' : 'ÎØ∏Ìù°'
                });
            });
            
            const csvContent = arrayToCSV(reportData);
            const filename = `ÏõîÍ∞ÑÎ¶¨Ìè¨Ìä∏_${year}ÎÖÑ${month}Ïõî.csv`;
            
            downloadFile('\\ufeff' + csvContent, filename);
            
            // ÏÑ±Í≥µ Î©îÏãúÏßÄ
            const button = document.getElementById('exportMonthlyReport');
            const originalText = button.textContent;
            button.textContent = '‚úÖ ÏôÑÎ£å!';
            button.style.background = 'linear-gradient(to right, #10b981, #059669)';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '';
            }, 2000);
        }
    </script>
</body>
</html>
